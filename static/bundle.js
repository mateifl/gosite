!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=44)}([function(e,t,n){!function(){"use strict";function t(e,t){var n,i,r,o,s=A;for(o=arguments.length;o-- >2;)P.push(arguments[o]);for(t&&null!=t.children&&(P.length||P.push(t.children),delete t.children);P.length;)if((i=P.pop())&&void 0!==i.pop)for(o=i.length;o--;)P.push(i[o]);else"boolean"==typeof i&&(i=null),(r="function"!=typeof e)&&(null==i?i="":"number"==typeof i?i+="":"string"!=typeof i&&(r=!1)),r&&n?s[s.length-1]+=i:s===A?s=[i]:s.push(i),n=r;var a=new M;return a.nodeName=e,a.children=s,a.attributes=null==t?void 0:t,a.key=null==t?void 0:t.key,void 0!==T.vnode&&T.vnode(a),a}function n(e,t){for(var n in t)e[n]=t[n];return e}function i(e,t){null!=e&&("function"==typeof e?e(t):e.current=t)}function r(e){!e.__d&&(e.__d=!0)&&1==E.push(e)&&(T.debounceRendering||D)(o)}function o(){for(var e;e=E.pop();)e.__d&&k(e)}function s(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&a(e,t.nodeName):n||e._componentConstructor===t.nodeName}function a(e,t){return e.__n===t||e.nodeName.toLowerCase()===t.toLowerCase()}function l(e){var t=n({},e.attributes);t.children=e.children;var i=e.nodeName.defaultProps;if(void 0!==i)for(var r in i)void 0===t[r]&&(t[r]=i[r]);return t}function u(e){var t=e.parentNode;t&&t.removeChild(e)}function h(e,t,n,r,o){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)i(n,null),i(r,e);else if("class"!==t||o)if("style"===t){if(r&&"string"!=typeof r&&"string"!=typeof n||(e.style.cssText=r||""),r&&"object"==typeof r){if("string"!=typeof n)for(var s in n)s in r||(e.style[s]="");for(var s in r)e.style[s]="number"==typeof r[s]&&!1===I.test(s)?r[s]+"px":r[s]}}else if("dangerouslySetInnerHTML"===t)r&&(e.innerHTML=r.__html||"");else if("o"==t[0]&&"n"==t[1]){var a=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),r?n||e.addEventListener(t,c,a):e.removeEventListener(t,c,a),(e.__l||(e.__l={}))[t]=r}else if("list"!==t&&"type"!==t&&!o&&t in e){try{e[t]=null==r?"":r}catch(e){}null!=r&&!1!==r||"spellcheck"==t||e.removeAttribute(t)}else{var l=o&&t!==(t=t.replace(/^xlink:?/,""));null==r||!1===r?l?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof r&&(l?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):e.setAttribute(t,r))}else e.className=r||""}function c(e){return this.__l[e.type](T.event&&T.event(e)||e)}function d(){for(var e;e=N.shift();)T.afterMount&&T.afterMount(e),e.componentDidMount&&e.componentDidMount()}function p(e,t,n,i,r,o){B++||(O=null!=r&&void 0!==r.ownerSVGElement,L=null!=e&&!("__preactattr_"in e));var s=f(e,t,n,i,o);return r&&s.parentNode!==r&&r.appendChild(s),--B||(L=!1,o||d()),s}function f(e,t,n,i,r){var o=e,s=O;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(o=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(o,e),g(e,!0))),o.__preactattr_=!0,o;var l=t.nodeName;if("function"==typeof l)return C(e,t,n,i);if(O="svg"===l||"foreignObject"!==l&&O,l+="",(!e||!a(e,l))&&(o=function(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.__n=e,n}(l,O),e)){for(;e.firstChild;)o.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(o,e),g(e,!0)}var u=o.firstChild,h=o.__preactattr_,c=t.children;if(null==h){h=o.__preactattr_={};for(var d=o.attributes,p=d.length;p--;)h[d[p].name]=d[p].value}return!L&&c&&1===c.length&&"string"==typeof c[0]&&null!=u&&void 0!==u.splitText&&null==u.nextSibling?u.nodeValue!=c[0]&&(u.nodeValue=c[0]):(c&&c.length||null!=u)&&m(o,c,n,i,L||null!=h.dangerouslySetInnerHTML),v(o,t.attributes,h),O=s,o}function m(e,t,n,i,r){var o,a,l,h,c,d=e.childNodes,p=[],m={},y=0,v=0,b=d.length,w=0,x=t?t.length:0;if(0!==b)for(var k=0;k<b;k++){var C=d[k],_=C.__preactattr_;null!=(S=x&&_?C._component?C._component.__k:_.key:null)?(y++,m[S]=C):(_||(void 0!==C.splitText?!r||C.nodeValue.trim():r))&&(p[w++]=C)}if(0!==x)for(k=0;k<x;k++){var S;if(c=null,null!=(S=(h=t[k]).key))y&&void 0!==m[S]&&(c=m[S],m[S]=void 0,y--);else if(v<w)for(o=v;o<w;o++)if(void 0!==p[o]&&s(a=p[o],h,r)){c=a,p[o]=void 0,o===w-1&&w--,o===v&&v++;break}c=f(c,h,n,i),l=d[k],c&&c!==e&&c!==l&&(null==l?e.appendChild(c):c===l.nextSibling?u(l):e.insertBefore(c,l))}if(y)for(var k in m)void 0!==m[k]&&g(m[k],!1);for(;v<=w;)void 0!==(c=p[w--])&&g(c,!1)}function g(e,t){var n=e._component;n?_(n):(null!=e.__preactattr_&&i(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||u(e),y(e))}function y(e){for(e=e.lastChild;e;){var t=e.previousSibling;g(e,!0),e=t}}function v(e,t,n){var i;for(i in n)t&&null!=t[i]||null==n[i]||h(e,i,n[i],n[i]=void 0,O);for(i in t)"children"===i||"innerHTML"===i||i in n&&t[i]===("value"===i||"checked"===i?e[i]:n[i])||h(e,i,n[i],n[i]=t[i],O)}function b(e,t,n){var i,r=R.length;for(e.prototype&&e.prototype.render?(i=new e(t,n),S.call(i,t,n)):((i=new S(t,n)).constructor=e,i.render=w);r--;)if(R[r].constructor===e)return i.__b=R[r].__b,R.splice(r,1),i;return i}function w(e,t,n){return this.constructor(e,n)}function x(e,t,n,o,s){e.__x||(e.__x=!0,e.__r=t.ref,e.__k=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||s?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,o)),o&&o!==e.context&&(e.__c||(e.__c=e.context),e.context=o),e.__p||(e.__p=e.props),e.props=t,e.__x=!1,0!==n&&(1!==n&&!1===T.syncComponentUpdates&&e.base?r(e):k(e,1,s)),i(e.__r,e))}function k(e,t,i,r){if(!e.__x){var o,s,a,u=e.props,h=e.state,c=e.context,f=e.__p||u,m=e.__s||h,y=e.__c||c,v=e.base,w=e.__b,C=v||w,S=e._component,M=!1,P=y;if(e.constructor.getDerivedStateFromProps&&(h=n(n({},h),e.constructor.getDerivedStateFromProps(u,h)),e.state=h),v&&(e.props=f,e.state=m,e.context=y,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(u,h,c)?M=!0:e.componentWillUpdate&&e.componentWillUpdate(u,h,c),e.props=u,e.state=h,e.context=c),e.__p=e.__s=e.__c=e.__b=null,e.__d=!1,!M){o=e.render(u,h,c),e.getChildContext&&(c=n(n({},c),e.getChildContext())),v&&e.getSnapshotBeforeUpdate&&(P=e.getSnapshotBeforeUpdate(f,m));var A,D,I=o&&o.nodeName;if("function"==typeof I){var E=l(o);(s=S)&&s.constructor===I&&E.key==s.__k?x(s,E,1,c,!1):(A=s,e._component=s=b(I,E,c),s.__b=s.__b||w,s.__u=e,x(s,E,0,c,!1),k(s,1,i,!0)),D=s.base}else a=C,(A=S)&&(a=e._component=null),(C||1===t)&&(a&&(a._component=null),D=p(a,o,c,i||!v,C&&C.parentNode,!0));if(C&&D!==C&&s!==S){var O=C.parentNode;O&&D!==O&&(O.replaceChild(D,C),A||(C._component=null,g(C,!1)))}if(A&&_(A),e.base=D,D&&!r){for(var L=e,R=e;R=R.__u;)(L=R).base=D;D._component=L,D._componentConstructor=L.constructor}}for(!v||i?N.push(e):M||(e.componentDidUpdate&&e.componentDidUpdate(f,m,P),T.afterUpdate&&T.afterUpdate(e));e.__h.length;)e.__h.pop().call(e);B||r||d()}}function C(e,t,n,i){for(var r=e&&e._component,o=r,s=e,a=r&&e._componentConstructor===t.nodeName,u=a,h=l(t);r&&!u&&(r=r.__u);)u=r.constructor===t.nodeName;return r&&u&&(!i||r._component)?(x(r,h,3,n,i),e=r.base):(o&&!a&&(_(o),e=s=null),r=b(t.nodeName,h,n),e&&!r.__b&&(r.__b=e,s=null),x(r,h,1,n,i),e=r.base,s&&e!==s&&(s._component=null,g(s,!1))),e}function _(e){T.beforeUnmount&&T.beforeUnmount(e);var t=e.base;e.__x=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?_(n):t&&(null!=t.__preactattr_&&i(t.__preactattr_.ref,null),e.__b=t,u(t),R.push(e),y(t)),i(e.__r,null)}function S(e,t){this.__d=!0,this.context=t,this.props=e,this.state=this.state||{},this.__h=[]}var M=function(){},T={},P=[],A=[],D="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,I=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,E=[],N=[],B=0,O=!1,L=!1,R=[];n(S.prototype,{setState:function(e,t){this.__s||(this.__s=this.state),this.state=n(n({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this.__h.push(t),r(this)},forceUpdate:function(e){e&&this.__h.push(e),k(this,2)},render:function(){}});var z={h:t,createElement:t,cloneElement:function(e,i){return t(e.nodeName,n(n({},e.attributes),i),arguments.length>2?[].slice.call(arguments,2):e.children)},createRef:function(){return{}},Component:S,render:function(e,t,n){return p(n,e,{},!1,t,!1)},rerender:o,options:T};e.exports=z}()},function(e,t,n){(function(e){const i=n(10);let r=0;t.linebreak="win32"===e.platform?"\r\n":"\n",t.noop=(()=>{}),t.getId=function(){return++r},t.hash=function(e){let t,n=0;if(0==e.length)return n;for(let i=0;i<e.length;i++)n=(n<<5)-n+(t=e.charCodeAt(i)),n&=n;return n},t.equals=function(e,n){if(e===n)return!0;if(null==e||null==n)return e==n;let i=Object.prototype.toString.call(e);if(i!==Object.prototype.toString.call(n))return!1;let r="[object Object]"===i;if("[object Array]"===i){if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(!t.equals(e[i],n[i]))return!1;return!0}if(r){let i=Object.keys(e);if(i.length!==Object.keys(n).length)return!1;for(let r=0;r<i.length;r++){let o=i[r];if(!(o in n))return!1;if(!t.equals(e[o],n[o]))return!1}return!0}return!1},t.shallowEquals=function(e,t){return null==e||null==t?e===t:e===t||e.length===t.length&&e.every((e,n)=>e==t[n])},t.vertexEquals=function([e,t],[n,i]){return e===n&&t===i},t.lexicalCompare=function(e,n){return e.length&&n.length?e[0]<n[0]?-1:e[0]>n[0]?1:t.lexicalCompare(e.slice(1),n.slice(1)):e.length-n.length},t.typographer=function(e){return e.replace(/\.{3}/g,"…").replace(/(\S)'/g,"$1’").replace(/(\S)"/g,"$1”").replace(/'(\S)/g,"‘$1").replace(/"(\S)/g,"“$1").replace(/(\s)-(\s)/g,"$1–$2")},t.normalizeEndings=function(e){return e.replace(/\r\n|\n\r|\r/g,"\n")},t.isTextLikeElement=function(e){return["textarea","select"].includes(e.tagName.toLowerCase())||"input"===e.tagName.toLowerCase()&&!["submit","reset","button","checkbox","radio","color","file"].includes(e.type)},t.popupMenu=function(e,t,i){let{remote:r}=n(4),o=+r.require("./setting").get("app.zoom_factor");r.Menu.buildFromTemplate(e).popup({x:Math.round(t*o),y:Math.round(i*o)})},t.wait=function(e){return new Promise(t=>setTimeout(t,e))},t.isWritableDirectory=function(e){if(null==e)return!1;let t=null;try{t=i.statSync(e)}catch(e){}if(null!=t){if(t.isDirectory())try{return i.accessSync(e,i.W_OK),!0}catch(e){}return!1}return!1}}).call(this,n(14))},function(e,t,n){var i;
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
!function(){"use strict";var n={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var i=arguments[t];if(i){var o=typeof i;if("string"===o||"number"===o)e.push(i);else if(Array.isArray(i)&&i.length){var s=r.apply(null,i);s&&e.push(s)}else if("object"===o)for(var a in i)n.call(i,a)&&i[a]&&e.push(a)}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(i=function(){return r}.apply(t,[]))||(e.exports=i)}()},function(e,t,n){const i=n(64).load({}),r=n(1);e.exports={t:i.t,context:i.context,loadStrings:r.noop,loadFile:r.noop,loadLang:r.noop,serialize:i.serialize}},function(e,t,n){const i=n(45),{h:r,render:o}=n(0),{noop:s}=n(1);let a={opacity:0,pointerEvents:"none"},l={getName:()=>"Sabaki",getVersion:()=>"web",getPath:()=>""};e.exports={app:l,ipcRenderer:{on:s,send:s},clipboard:{readText:()=>prompt("Please paste contents here:"),writeText:e=>{let t=o(r("a",{href:"#",style:a,onClick:t=>{t.preventDefault(),i(e)}}),document.body);t.click(),t.remove()}},shell:{openExternal:e=>{let t=o(r("a",{href:e,target:"_blank",style:a}),document.body);t.click(),t.remove()}},remote:{app:l,require:e=>"./setting"===e?n(46):{},getCurrentWindow:()=>({show:s,close:s,on:s,isMaximized:s,isMinimized:s,isFullScreen:s,setFullScreen:s,setMenuBarVisibility:s,setAutoHideMenuBar:s,setProgressBar:s,setContentSize:s,getContentSize:()=>[0,0],webContents:{setAudioMuted:s}}),Menu:n(47)}}},function(e,t,n){"use strict";e.exports=function(e){return r.test("number"==typeof e?i(e):e.charAt(0))};var i=String.fromCharCode,r=/\s/},function(e,t,n){const i=n(31),r=n(8),o=n(17),s=n(1);let a={};function l(e,t){return null!=t.B&&null!=e.data.B&&t.B[0]===e.data.B[0]||null!=t.W&&null!=e.data.W&&t.W[0]===e.data.W[0]?Object.assign({},t,e.data):null}t.new=function(e={}){return new i(Object.assign({getId:s.getId,merger:l},e))},t.getRootProperty=function(e,t,n=null){let i="";return t in e.root.data&&(i=e.root.data[t][0]),""===i?n:i},t.getMatrixDict=function(e){let t=[...Array(e.getHeight()+1)].map(e=>[]),n=(t,i,r,o,s)=>{let a=[...e.getSequence(t.id)],l=!0;for(;l;){l=!1;for(let e=0;e<=a.length;e++)if(!(o>=i[s+e].length-(e===a.length))){l=!0,o++;break}}for(let e=0;e<a.length;e++)i[s+e][o]=a[e].id,r[a[e].id]=[o,s+e];let u=a.slice(-1)[0];for(let e=0;e<u.children.length;e++){let t=u.children[e];n(t,i,r,o+e,s+a.length)}return[i,r]};return n(e.root,t,{},0,0)},t.getMatrixWidth=function(e,t){let n=[...Array(10)].map((t,n)=>n+e-4).filter(e=>e>=0&&e<t.length),i=Math.min(...n.map(e=>{for(let n=0;n<t[e].length;n++)if(null!=t[e][n])return n;return 0}));return[Math.max(...n.map(e=>t[e].length))-i,i]},t.getBoard=function(e,n,i=null){let s=e.get(n),l=e.get(s.parentId);if(null==s)return null;let u=null,h=null;if(!i){let n=e.get(s.parentId);if(n)i=a[n.id]||t.getBoard(e,n.id);else{let e=[19,19];if(null!=s.data.SZ){let t=s.data.SZ[0];e=(e=t.includes(":")?t.split(":"):[t,t]).map(e=>isNaN(e)?19:+e)}i=new o(...e)}}let c={B:1,W:-1};for(let e in c)if(null!=s.data[e]){u=r.parseVertex(s.data[e][0]),(h=i.makeMove(c[e],u)).currentVertex=u;break}h||(h=i.clone()),c={AW:-1,AE:0,AB:1};for(let e in c)if(null!=s.data[e])for(let t of s.data[e])for(let n of r.parseCompressedVertices(t))h.hasVertex(n)&&h.set(n,c[e]);if(h.markers=h.arrangement.map(e=>e.map(e=>null)),null!=u&&h.hasVertex(u)){let[e,t]=u;h.markers[t][e]={type:"point"}}c={CR:"circle",MA:"cross",SQ:"square",TR:"triangle"};for(let e in c)if(null!=s.data[e])for(let t of s.data[e])for(let[n,i]of r.parseCompressedVertices(t))null!=h.markers[i]&&(h.markers[i][n]={type:c[e]});if(null!=s.data.LB)for(let e of s.data.LB){let t=e.indexOf(":"),n=e.slice(0,t),i=e.slice(t+1),[o,s]=r.parseVertex(n);null!=h.markers[s]&&(h.markers[s][o]={type:"label",label:i})}if(null!=s.data.L)for(let e=0;e<s.data.L.length;e++){let t=s.data.L[e],n="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[e];if(null==n)return;let[i,o]=r.parseVertex(t);null!=h.markers[o]&&(h.markers[o][i]={type:"label",label:n})}for(let e of["AR","LN"])if(null!=s.data[e])for(let t of s.data[e]){let n=t.indexOf(":"),[i,o]=[t.slice(0,n),t.slice(n+1)].map(r.parseVertex);h.lines.push({v1:i,v2:o,type:"AR"===e?"arrow":"line"})}let d=(e,t)=>{let n,i;if(null!=e.data.B)n=r.parseVertex(e.data.B[0]),i=1;else{if(null==e.data.W)return;n=r.parseVertex(e.data.W[0]),i=-1}if(!h.hasVertex(n))return;let o=null;null!=e.data.BM?o="bad":null!=e.data.DO?o="doubtful":null!=e.data.IT?o="interesting":null!=e.data.TE&&(o="good"),t[n]={sign:i,type:o}};for(let e of s.children)d(e,h.childrenInfo);if(null!=l)for(let e of l.children)d(e,h.siblingsInfo);return a[n]=h,h},t.clearBoardCache=function(){a={}},t.getHash=function(e){return s.hash(JSON.stringify(e))}},function(e,t){e.exports=(e=>{})},function(e,t,n){const{tokenizeIter:i,tokenizeBufferIter:r,tokenize:o,tokenizeBuffer:s}=n(29),{parse:a,parseTokens:l,parseBuffer:u,parseFile:h}=n(52),{stringify:c}=n(54),d=n(15);Object.assign(t,{tokenizeIter:i,tokenizeBufferIter:r,tokenize:o,tokenizeBuffer:s,parse:a,parseTokens:l,parseBuffer:u,parseFile:h,stringify:c},d)},function(e,t){e.exports=function(){for(var e={},t=0;t<arguments.length;t++){var i=arguments[t];for(var r in i)n.call(i,r)&&(e[r]=i[r])}return e};var n=Object.prototype.hasOwnProperty},function(e,t,n){const{noop:i}=n(1);e.exports={readFile:(e,t=i)=>{let n=new FileReader;n.onload=(e=>t(null,e.target.result)),n.readAsText(e)},readFileSync:e=>"",writeFileSync:i,mkdirSync:i,accessSync:i}},function(e,t,n){(function(e){function n(e,t){for(var n=0,i=e.length-1;i>=0;i--){var r=e[i];"."===r?e.splice(i,1):".."===r?(e.splice(i,1),n++):n&&(e.splice(i,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,r=function(e){return i.exec(e).slice(1)};function o(e,t){if(e.filter)return e.filter(t);for(var n=[],i=0;i<e.length;i++)t(e[i],i,e)&&n.push(e[i]);return n}t.resolve=function(){for(var t="",i=!1,r=arguments.length-1;r>=-1&&!i;r--){var s=r>=0?arguments[r]:e.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(t=s+"/"+t,i="/"===s.charAt(0))}return(i?"/":"")+(t=n(o(t.split("/"),function(e){return!!e}),!i).join("/"))||"."},t.normalize=function(e){var i=t.isAbsolute(e),r="/"===s(e,-1);return(e=n(o(e.split("/"),function(e){return!!e}),!i).join("/"))||i||(e="."),e&&r&&(e+="/"),(i?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(o(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},t.relative=function(e,n){function i(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var r=i(e.split("/")),o=i(n.split("/")),s=Math.min(r.length,o.length),a=s,l=0;l<s;l++)if(r[l]!==o[l]){a=l;break}var u=[];for(l=a;l<r.length;l++)u.push("..");return(u=u.concat(o.slice(a))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){var t=r(e),n=t[0],i=t[1];return n||i?(i&&(i=i.substr(0,i.length-1)),n+i):"."},t.basename=function(e,t){var n=r(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){return r(e)[3]};var s="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,n(14))},function(e,t){(t=e.exports=function(e){return e.replace(/^\s*|\s*$/g,"")}).left=function(e){return e.replace(/^\s*/,"")},t.right=function(e){return e.replace(/\s*$/,"")}},function(e,t){e.exports=[]},function(e,t){var n,i,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var l,u=[],h=!1,c=-1;function d(){h&&l&&(h=!1,l.length?u=l.concat(u):c=-1,u.length&&p())}function p(){if(!h){var e=a(d);h=!0;for(var t=u.length;t;){for(l=u,u=[];++c<t;)l&&l[c].run();c=-1,t=u.length}l=null,h=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||h||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t){const n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";t.escapeString=function(e){return e.toString().replace(/\\/g,"\\\\").replace(/\]/g,"\\]")},t.unescapeString=function(e){let t=[],n=!1;e=e.replace(/\r/g,"");for(let i=0;i<e.length;i++)n?("\n"!==e[i]&&t.push(e[i]),n=!1):"\\"!==e[i]?t.push(e[i]):"\\"===e[i]&&(n=!0);return t.join("")},t.parseDates=function(e){if(!e.match(/^(\d{4}(-\d{1,2}(-\d{1,2})?)?(\s*,\s*(\d{4}|(\d{4}-)?\d{1,2}(-\d{1,2})?))*)?$/))return null;if(""===e.trim())return[];let t=e.split(",").map(e=>e.trim().split("-"));for(let e=1;e<t.length;e++){let n=t[e],i=t[e-1];4!==n[0].length&&(1===n.length&&3===i.length&&n.unshift(i[1]),n.unshift(i[0]))}return t.map(e=>e.map(e=>+e))},t.stringifyDates=function(e){if(0===e.length)return"";let t=[e[0].slice()];for(let n=1;n<e.length;n++){let i=e[n],r=e[n-1],o=0;for(let e=0;e<i.length&&(i[e]===r[e]&&o===e);e++)o++;t.push(i.slice(o))}return t.map(e=>e.map(e=>e>9?""+e:"0"+e).join("-")).join(",")},t.parseVertex=function(e){return 2!==e.length?[-1,-1]:e.split("").map(e=>n.indexOf(e))},t.stringifyVertex=function([e,t]){return Math.min(e,t)<0||Math.max(e,t)>=n.length?"":n[e]+n[t]},t.parseCompressedVertices=function(e){let n=e.indexOf(":");if(n<0)return[t.parseVertex(e)];let i=t.parseVertex(e.slice(0,n)),r=t.parseVertex(e.slice(n+1)),o=[];for(let e=Math.min(i[0],r[0]);e<=Math.max(i[0],r[0]);e++)for(let t=Math.min(i[1],r[1]);t<=Math.max(i[1],r[1]);t++)o.push([e,t]);return o}},function(e,t){t.alpha="ABCDEFGHJKLMNOPQRSTUVWXYZ",t.vertexEvents=["Click","MouseDown","MouseUp","MouseMove","MouseEnter","MouseLeave"],t.range=(e=>[...Array(e)].map((e,t)=>t)),t.random=(e=>Math.floor(Math.random()*(e+1))),t.neighborhood=(([e,t])=>[[e,t],[e-1,t],[e+1,t],[e,t-1],[e,t+1]]),t.vertexEquals=(([e,t],[n,i])=>e===n&&t===i),t.lineEquals=(([e,n],[i,r])=>t.vertexEquals(e,i)&&t.vertexEquals(n,r)),t.getHoshis=function(e,t){if(Math.min(e,t)<6)return[];let[n,i]=[e,t].map(e=>e>=13?3:2),[r,o]=[e-n-1,t-i-1],[s,a]=[e,t].map(e=>(e-1)/2),l=[[n,o],[r,i],[r,o],[n,i]];return e%2!=0&&t%2!=0&&l.push([s,a]),e%2!=0&&l.push([s,i],[s,o]),t%2!=0&&l.push([n,a],[r,a]),l},t.readjustShifts=function(e,n=null){if(null==n)for(let n=0;n<e.length;n++)for(let i=0;i<e[0].length;i++)t.readjustShifts(e,[i,n]);else{let[t,i]=n,r=e[i][t],o=[[[1,5,8],[t-1,i],[3,7,6]],[[2,5,6],[t,i-1],[4,7,8]],[[3,7,6],[t+1,i],[1,5,8]],[[4,7,8],[t,i+1],[2,5,6]]];for(let[t,[n,i],s]of o)t.includes(r)&&e[i]&&s.includes(e[i][n])&&(e[i][n]=0)}return e},t.diffSignMap=function(e,t){if(e===t||0===e.length||e.length!==t.length||e[0].length!==t[0].length)return[];let n=[];for(let i=0;i<e.length;i++)for(let r=0;r<e[0].length;r++)0===e[i][r]&&null!=t[i]&&t[i][r]&&n.push([r,i]);return n}},function(e,t,n){const i=n(1),r="ABCDEFGHJKLMNOPQRSTUVWXYZ";class o{constructor(e=19,t=19,n=[],i=null){this.width=e,this.height=t,this.captures=i?i.slice():[0,0],this.arrangement=[],this.markers=null,this.lines=[],this.childrenInfo={},this.siblingsInfo={};for(let e=0;e<this.height;e++)this.arrangement[e]=e in n?[...n[e]]:Array(this.width).fill(0);this.markers=this.arrangement.map(e=>e.map(e=>null))}get([e,t]){return this.arrangement[t]?this.arrangement[t][e]:void 0}set([e,t],n){return this.arrangement[t][e]=n,this}clone(){return new o(this.width,this.height,this.arrangement,this.captures)}diff(e){if(e.width!==this.width||e.height!==this.height)return null;let t=[];for(let n=0;n<this.width;n++)for(let i=0;i<this.height;i++){let r=e.get([n,i]);this.get([n,i])!==r&&t.push([n,i])}return t}hasVertex([e,t]){return 0<=e&&e<this.width&&0<=t&&t<this.height}clear(){this.arrangement=this.arrangement.map(e=>e.map(e=>0))}isSquare(){return this.width===this.height}isEmpty(){return this.arrangement.every(e=>e.every(e=>0===e))}getDistance(e,t){return Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])}getNeighbors(e,t=!1){if(!t&&!this.hasVertex(e))return[];let[n,i]=e,r=[[n-1,i],[n+1,i],[n,i-1],[n,i+1]];return t?r:r.filter(e=>this.hasVertex(e))}getConnectedComponent(e,t,n=null){if(t instanceof Array){let e=t;t=(t=>e.includes(this.get(t)))}else if("number"==typeof t){let e=t;t=(t=>this.get(t)===e)}if(!this.hasVertex(e))return[];n||(n=[e]);for(let r of this.getNeighbors(e))t(r)&&(n.some(e=>i.vertexEquals(r,e))||(n.push(r),this.getConnectedComponent(r,t,n)));return n}getChain(e){return this.getConnectedComponent(e,this.get(e))}hasLiberties(e,t={}){let n=this.get(e);if(!this.hasVertex(e)||0===n)return!1;if(e in t)return!1;let i=this.getNeighbors(e);return!!i.some(e=>0===this.get(e))||(t[e]=!0,i.filter(e=>this.get(e)===n).some(e=>this.hasLiberties(e,t)))}getLiberties(e){if(!this.hasVertex(e)||0===this.get(e))return[];let t=this.getChain(e),n=[],i={};for(let e of t){let t=this.getNeighbors(e).filter(e=>0===this.get(e));n.push(...t.filter(e=>!(e in i))),t.forEach(e=>i[e]=!0)}return n}getRelatedChains(e){if(!this.hasVertex(e)||0===this.get(e))return[];return this.getConnectedComponent(e,[this.get(e),0]).filter(t=>this.get(t)===this.get(e))}getScore(e,{komi:t=0,handicap:n=0}={}){let i={area:[0,0],territory:[0,0],captures:this.captures};for(let t=0;t<this.width;t++)for(let n=0;n<this.height;n++){let r=e[n][t];if(0===r)continue;let o=r>0?0:1;i.area[o]++,0===this.get([t,n])&&i.territory[o]++}return i.areaScore=i.area[0]-i.area[1]-t-n,i.territoryScore=i.territory[0]-i.territory[1]+i.captures[0]-i.captures[1]-t,i}vertex2coord(e){return this.hasVertex(e)?r[e[0]]+(this.height-e[1]):null}coord2vertex(e){return[r.indexOf(e[0].toUpperCase()),this.height-+e.slice(1)]}isValid(){let e={};for(let t=0;t<this.width;t++)for(let n=0;n<this.height;n++){let i=[t,n];if(!(0===this.get(i)||i in e)){if(!this.hasLiberties(i))return!1;this.getChain(i).forEach(t=>e[t]=!0)}}return!0}makeMove(e,t){let n=this.clone();if(0===e||!this.hasVertex(t))return n;e=e>0?1:-1,n.set(t,e);let i=n.getNeighbors(t).filter(t=>n.get(t)===-e&&!n.hasLiberties(t));for(let t of i)if(0!==n.get(t))for(let i of n.getChain(t))n.set(i,0),n.captures[(1-e)/2]++;if(n.set(t,e),0===i.length&&!n.hasLiberties(t))for(let i of n.getChain(t))n.set(i,0),n.captures[(e+1)/2]++;return n}getHandicapPlacement(e,t=!1){if(Math.min(this.width,this.height)<6||e<2)return[];let n,i=this.width>=13?3:2,r=this.height>=13?3:2,o=this.width-i-1,s=this.height-r-1,a=(this.width-1)/2,l=(this.height-1)/2;return n=t?[[i,s],[o,r],[i,r],[o,s]]:[[i,s],[o,r],[o,s],[i,r]],this.width%2!=0&&this.height%2!=0?(5===e&&n.push([a,l]),n.push([i,l],[o,l]),7===e&&n.push([a,l]),n.push([a,r],[a,s],[a,l])):this.width%2!=0?n.push([a,r],[a,s]):this.height%2!=0&&n.push([i,l],[o,l]),n.slice(0,e)}generateAscii(){let e=[],t=i.linebreak,n=([e,t])=>{let n=4+2*this.width;return n+n*t+1+2*e+1};e.push("+");for(let t=0;t<this.width;t++)e.push("-","-");e.push("-","+",t);for(let n=0;n<this.height;n++){e.push("|");for(let t=0;t<this.width;t++)e.push(" ",".");e.push(" ","|",t)}e.push("+");for(let t=0;t<this.width;t++)e.push("-","-");e.push("-","+",t),this.getHandicapPlacement(9).forEach(t=>e[n(t)]=",");let r={plain:["O",null,"X"],circle:["W","C","B"],square:["@","S","#"],triangle:["Q","T","Y"],cross:["P","M","Z"],label:["O",null,"X"]};for(let t=0;t<this.width;t++)for(let i=0;i<this.height;i++){let o=[t,i],s=n(o),a=this.get(o);if(this.markers[i][t]&&this.markers[i][t].type in r){let{type:n,label:o}=this.markers[i][t];"label"!==n||0!==a?e[s]=r[n][a+1]:0===a&&1===o.length&&isNaN(parseFloat(o))&&(e[s]=o.toLowerCase())}else 0!==a&&(e[s]=r.plain[a+1])}e=e.join("");for(let{v1:n,v2:i,type:r}of this.lines)e+=`{${"arrow"===r?"AR":"LN"} ${this.vertex2coord(n)} ${this.vertex2coord(i)}}${t}`;return(t+e.trim()).split(t).map(e=>`$$ ${e}`).join(t)}getPositionHash(){return i.hash(JSON.stringify(this.arrangement))}getHash(){return i.hash(JSON.stringify([this.arrangement,this.captures,this.markers,this.lines]))}}e.exports=o},function(e,t,n){"use strict";e.exports=function(e){var t="string"==typeof e?e.charCodeAt(0):e;return t>=48&&t<=57}},function(e,t,n){"use strict";e.exports=a;var i=n(107),r=i.CONTINUE,o=i.SKIP,s=i.EXIT;function a(e,t,n,r){"function"==typeof t&&"function"!=typeof n&&(r=n,n=t,t=null),i(e,t,function(e,t){var i=t[t.length-1],r=i?i.children.indexOf(e):null;return n(e,r,i)},r)}a.CONTINUE=r,a.SKIP=o,a.EXIT=s},function(e,t,n){const{h:i,Component:r}=n(0),o=n(2);e.exports=class extends r{constructor(e){super(e),this.state={hidecontent:e.type!==e.mode},this.componentWillReceiveProps(e),this.onCloseButtonClick=(()=>sabaki.setMode("play"))}componentWillReceiveProps(e){e.type===e.mode?(clearTimeout(this.hidecontentId),this.state.hidecontent&&this.setState({hidecontent:!1})):this.state.hidecontent||(this.hidecontentId=setTimeout(()=>this.setState({hidecontent:!0}),500))}shouldComponentUpdate(e){return e.mode!==this.props.mode||e.mode===e.type}render({children:e,type:t,mode:n,class:r=""},{hidecontent:s}){return i("section",{id:t,class:o(r,{bar:!0,current:t===n,hidecontent:s})},e,i("a",{class:"close",href:"#",onClick:this.onCloseButtonClick}))}}},function(e,t,n){"use strict";var i=n(13),r=n(13),o=n(18),s=n(98),a=n(99),l=n(100);e.exports=function(e,t){var n,o,s={};t||(t={});for(o in d)n=t[o],s[o]=null==n?d[o]:n;(s.position.indent||s.position.start)&&(s.indent=s.position.indent||[],s.position=s.position.start);return function(e,t){var n,o,s,d,T,P,A,D,I,E,N,B,O,L,R,z,V,j,W,F=t.additional,H=t.nonTerminated,$=t.text,G=t.reference,U=t.warning,q=t.textContext,Y=t.referenceContext,K=t.warningContext,Z=t.position,X=t.indent||[],J=e.length,Q=0,ee=-1,te=Z.column||1,ne=Z.line||1,ie="",re=[];z=se(),D=U?function(e,t){var n=se();n.column+=t,n.offset+=t,U.call(K,S[e],n,e)}:c,Q--,J++;for(;++Q<J;)if("\n"===T&&(te=X[ee]||1),"&"!==(T=ae(Q)))"\n"===T&&(ne++,ee++,te=0),T?(ie+=T,te++):le();else{if("\t"===(A=ae(Q+1))||"\n"===A||"\f"===A||" "===A||"<"===A||"&"===A||""===A||F&&A===F){ie+=T,te++;continue}for(B=O=Q+1,W=O,"#"!==A?L=p:(W=++B,"x"===(A=ae(W))||"X"===A?(L=f,W=++B):L=m),n="",N="",d="",R=y[L],W--;++W<J&&(A=ae(W),R(A));)d+=A,L===p&&u.call(i,d)&&(n=d,N=i[d]);(s=";"===ae(W))&&(W++,(o=L===p&&l(d))&&(n=d,N=o)),j=1+W-O,(s||H)&&(d?L===p?(s&&!N?D(k,1):(n!==d&&(W=B+n.length,j=1+W-B,s=!1),s||(I=n?v:w,t.attribute?"="===(A=ae(W))?(D(I,j),N=null):a(A)?N=null:D(I,j):D(I,j))),P=N):(s||D(b,j),P=parseInt(d,g[L]),(oe=P)>=55296&&oe<=57343||oe>1114111?(D(_,j),P="�"):P in r?(D(C,j),P=r[P]):(E="",M(P)&&D(C,j),P>65535&&(E+=h((P-=65536)>>>10|55296),P=56320|1023&P),P=E+h(P))):L!==p&&D(x,j)),P?(le(),z=se(),Q=W-1,te+=W-O+1,re.push(P),(V=se()).offset++,G&&G.call(Y,P,{start:z,end:V},e.slice(O-1,W)),z=V):(d=e.slice(O-1,W),ie+=d,te+=d.length,Q=W-1)}var oe;return re.join("");function se(){return{line:ne,column:te,offset:Q+(Z.offset||0)}}function ae(t){return e.charAt(t)}function le(){ie&&(re.push(ie),$&&$.call(q,ie,{start:z,end:se()}),ie="")}}(e,s)};var u={}.hasOwnProperty,h=String.fromCharCode,c=Function.prototype,d={warning:null,reference:null,text:null,warningContext:null,referenceContext:null,textContext:null,position:{},additional:null,attribute:!1,nonTerminated:!0},p="named",f="hexadecimal",m="decimal",g={};g[f]=16,g[m]=10;var y={};y[p]=a,y[m]=o,y[f]=s;var v=1,b=2,w=3,x=4,k=5,C=6,_=7,S={};function M(e){return e>=1&&e<=8||11===e||e>=13&&e<=31||e>=127&&e<=159||e>=64976&&e<=65007||65535==(65535&e)||65534==(65535&e)}S[v]="Named character references must be terminated by a semicolon",S[b]="Numeric character references must be terminated by a semicolon",S[w]="Named character references cannot be empty",S[x]="Numeric character references cannot be empty",S[k]="Named character references must be known",S[C]="Numeric character references cannot be disallowed",S[_]="Numeric character references cannot be outside the permissible Unicode range"},function(e,t,n){"use strict";
/*!
 * repeat-string <https://github.com/jonschlinkert/repeat-string>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var i,r="";e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("expected a string");if(1===t)return e;if(2===t)return e+e;var n=e.length*t;if(i!==e||void 0===i)i=e,r="";else if(r.length>=n)return r.substr(0,n);for(;n>r.length&&t>1;)1&t&&(r+=e),t>>=1,e+=e;return r=(r+=e).substr(0,n)}},function(e,t,n){"use strict";e.exports=function(e){var t=String(e),n=t.length;for(;t.charAt(--n)===i;);return t.slice(0,n+1)};var i="\n"},function(e,t,n){"use strict";e.exports=function(e,t,n,i){var r,o,s,a,l,u,h=["pedantic","commonmark"],c=h.length,d=e.length,p=-1;for(;++p<d;){for(r=e[p],o=r[1]||{},s=r[0],a=-1,u=!1;++a<c;)if(void 0!==o[l=h[a]]&&o[l]!==n.options[l]){u=!0;break}if(!u&&t[s].apply(n,i))return!0}return!1}},function(e,t,n){"use strict";var i=n(120);e.exports=function(e){return i(e).toLowerCase()}},function(e,t,n){const{h:i,Component:r}=n(0),o=n(2);e.exports=class extends r{constructor(e){super(e),this.state={hidecontent:e.show},this.componentWillReceiveProps(e)}componentWillReceiveProps(e){e.show?(clearTimeout(this.hidecontentId),this.state.hidecontent&&this.setState({hidecontent:!1})):this.state.hidecontent||(this.hidecontentId=setTimeout(()=>this.setState({hidecontent:!0}),500))}render({type:e,show:t,children:n},{hidecontent:r}){return i("section",{id:e,class:o({drawer:!0,hidecontent:r,show:t})},n)}}},function(e,t){t.getNeighbors=(([e,t])=>[[e-1,t],[e+1,t],[e,t-1],[e,t+1]]),t.getChain=function(e,n,i=[],r={},o=null){null==o&&(o=e[n[1]][n[0]]);let s=t.getNeighbors(n);i.push(n),r[n]=!0;for(let n of s)!e[n[1]]||e[n[1]][n[0]]!==o||n in r||t.getChain(e,n,i,r,o);return i}},function(e,t,n){"use strict";var i,r="object"==typeof Reflect?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};i=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var l=10;function u(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function h(e,t,n,i){var r,o,s,a;if("function"!=typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n);if(void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),(r=u(e))>0&&s.length>r&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=s.length,a=l,console&&console.warn&&console.warn(a)}return e}function c(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,e))}.bind(i);return r.listener=n,i.wrapFn=r,r}function d(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):f(r,r.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=r[e];if(void 0===l)return!1;if("function"==typeof l)o(l,this,t);else{var u=l.length,h=f(l,u);for(n=0;n<u;++n)o(h[n],this,t)}return!0},a.prototype.addListener=function(e,t){return h(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return h(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,c(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,c(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,i,r,o,s;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},a.prototype.listeners=function(e){return d(this,e,!0)},a.prototype.rawListeners=function(e){return d(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},function(e,t,n){const i=n(50),r=n(51),{unescapeString:o}=n(15);t.tokenizeIter=function*(e){let t=e.length,n=0,[i,r]=[0,0],o={newline:/^\n/,whitespace:/^[^\S\n]+/,parenthesis:/^(\(|\))/,semicolon:/^;/,prop_ident:/^[A-Za-z]+/,c_value_type:/^\[([^\\\]]|\\[^])*\]/};for(;e.length>0;){let s=null;for(let a in o){if(null==(s=o[a].exec(e)))continue;let l=s[0];["newline","whitespace"].includes(a)||(yield{type:a,value:l,row:i,col:r,pos:n,progress:n/(t-1)}),"newline"===a?(i++,r=0):r+=l.length,n+=l.length,e=e.slice(l.length);break}if(null==s)throw new Error(`Unexpected token at ${i+1}:${r+1}`)}},t.tokenizeBufferIter=function*(e,{encoding:n=null}={}){if(null!=n)return void(yield*t.tokenizeIter(i.decode(e,n)));let s=r.detect(e.slice(0,100)).encoding,a=i.decode(e,s),l=t.tokenizeIter(a),u=[],h=!1,c=s;for(;;){let e=l.next();if(e.done)break;let{type:t,value:n}=e.value,i=u.length;if(u.push(e.value),"semicolon"===t){if(h)break;h=!0}else if("c_value_type"===t&&i>0&&"prop_ident"===u[i-1].type&&"CA"===u[i-1].value){c=o(n.slice(1,-1));break}}s!==c&&i.encodingExists(c)?yield*t.tokenizeIter(i.decode(e,c)):(yield*u,yield*l)},t.tokenize=(e=>[...t.tokenizeIter(e)]),t.tokenizeBuffer=((e,n)=>[...t.tokenizeBufferIter(e,n)])},function(e,t,n){const{createElement:i,Component:r}=n(0),o=n(2),s=n(16),{CoordX:a,CoordY:l}=n(56),u=n(57),h=n(58),c=n(59);class d extends r{constructor(e){super(e)}componentDidUpdate(){if(this.props.animateStonePlacement&&!this.state.clearAnimatedVerticesHandler&&this.state.animatedVertices.length>0){for(let[e,t]of this.state.animatedVertices)this.state.shiftMap[t][e]=s.random(7)+1,s.readjustShifts(this.state.shiftMap,[e,t]);this.setState({shiftMap:this.state.shiftMap}),this.setState({clearAnimatedVerticesHandler:setTimeout(()=>{this.setState({animatedVertices:[],clearAnimatedVerticesHandler:null})},this.props.animationDuration||200)})}}render(){let{width:e,height:t,rangeX:n,rangeY:r,xs:d,ys:p,hoshis:f,shiftMap:m,randomMap:g}=this.state,{innerProps:y={},vertexSize:v=24,coordX:b,coordY:w,busy:x,signMap:k,paintMap:C,heatMap:_,markerMap:S,ghostStoneMap:M,fuzzyStonePlacement:T=!1,showCoordinates:P=!1,lines:A=[],selectedVertices:D=[],dimmedVertices:I=[]}=this.props,E=[].concat(...this.state.animatedVertices.map(s.neighborhood));return i("div",Object.assign({},y,{id:this.props.id,className:o("shudan-goban","shudan-goban-image",{"shudan-busy":x,"shudan-coordinates":P})+" "+(this.props.class||this.props.className||""),style:Object.assign({display:"inline-grid",gridTemplateRows:P?"1em 1fr 1em":"1fr",gridTemplateColumns:P?"1em 1fr 1em":"1fr",fontSize:v,lineHeight:"1em"},this.props.style||{})}),P&&i(a,{xs:d,style:{gridRow:"1",gridColumn:"2"},coordX:b}),P&&i(l,{height:t,ys:p,style:{gridRow:"2",gridColumn:"1"},coordY:w}),i("div",{className:"shudan-content",style:{position:"relative",width:`${d.length}em`,height:`${p.length}em`,gridRow:P?"2":"1",gridColumn:P?"2":"1"}},i(u,{vertexSize:v,width:e,height:t,xs:d,ys:p,hoshis:f}),i("div",{className:"shudan-vertices",style:{display:"grid",gridTemplateColumns:`repeat(${d.length}, 1em)`,gridTemplateRows:`repeat(${p.length}, 1em)`,position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:1}},p.map(e=>d.map(t=>{let n=n=>s.vertexEquals(n,[t,e]);return i(h,Object.assign({key:[t,e].join("-"),position:[t,e],shift:T?m&&m[e]&&m[e][t]:0,random:g&&g[e]&&g[e][t],sign:k&&k[e]&&k[e][t],heat:_&&_[e]&&_[e][t],paint:C&&C[e]&&C[e][t],marker:S&&S[e]&&S[e][t],ghostStone:M&&M[e]&&M[e][t],dimmed:I.some(n),selected:D.some(n),animate:E.some(n)},...s.vertexEvents.map(e=>({[`on${e}`]:this.props[`onVertex${e}`]}))))}))),i("div",{className:"shudan-lines",style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",pointerEvents:"none",zIndex:2}},i("div",{style:{position:"absolute",top:`-${r[0]}em`,left:`-${n[0]}em`,width:`${e}em`,height:`${t}em`}},A.map(({v1:e,v2:t,type:n},r)=>i(c,{key:r,v1:e,v2:t,type:n,vertexSize:v}))))),P&&i(l,{height:t,ys:p,style:{gridRow:"2",gridColumn:"3"},coordY:w}),P&&i(a,{xs:d,style:{gridRow:"3",gridColumn:"2"},coordX:b}))}}d.getDerivedStateFromProps=function(e,t){let{signMap:n=[],rangeX:i=[0,1/0],rangeY:r=[0,1/0]}=e,o=0===n.length?0:n[0].length,a=n.length;if(t&&t.width===o&&t.height===a){let l=t.animatedVertices;e.animateStonePlacement&&e.fuzzyStonePlacement&&null==t.clearAnimatedVerticesHandler&&(l=s.diffSignMap(t.signMap,n));let u={signMap:n,animatedVertices:l};return s.vertexEquals(t.rangeX,i)&&s.vertexEquals(t.rangeY,r)||Object.assign(u,{rangeX:i,rangeY:r,xs:s.range(o).slice(i[0],i[1]+1),ys:s.range(a).slice(r[0],r[1]+1)}),u}return{signMap:n,width:o,height:a,rangeX:i,rangeY:r,animatedVertices:[],clearAnimatedVerticesHandler:null,xs:s.range(o).slice(i[0],i[1]+1),ys:s.range(a).slice(r[0],r[1]+1),hoshis:s.getHoshis(o,a),shiftMap:s.readjustShifts(n.map(e=>e.map(e=>s.random(8)))),randomMap:n.map(e=>e.map(e=>s.random(4)))}},e.exports=d},function(e,t,n){e.exports=n(61)},function(e,t,n){"use strict";e.exports=function(e){var t="string"==typeof e?e.charCodeAt(0):e;return t>=97&&t<=122||t>=65&&t<=90}},function(e,t,n){"use strict";e.exports={position:!0,gfm:!0,commonmark:!1,footnotes:!1,pedantic:!1,blocks:n(104)}},function(e,t,n){"use strict";e.exports=function(e){var t,n=0,r=0,o=e.charAt(n),s={};for(;o in i;)t=i[o],r+=t,t>1&&(r=Math.floor(r/t)*t),s[r]=n,o=e.charAt(++n);return{indent:r,stops:s}};var i={" ":1,"\t":4}},function(e,t,n){"use strict";var i="<[A-Za-z][A-Za-z0-9\\-]*(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*(?:[^\"'=<>`\\u0000-\\u0020]+|'[^']*'|\"[^\"]*\"))?)*\\s*\\/?>",r="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>";t.openCloseTag=new RegExp("^(?:"+i+"|"+r+")"),t.tag=new RegExp("^(?:"+i+"|"+r+"|\x3c!----\x3e|\x3c!--(?:-?[^>-])(?:-?[^-])*--\x3e|<[?].*?[?]>|<![A-Za-z]+\\s+[^>]*>|<!\\[CDATA\\[[\\s\\S]*?\\]\\]>)")},function(e,t,n){"use strict";e.exports=function(e,t){return e.indexOf("<",t)}},function(e,t,n){"use strict";e.exports=function(e,t){var n=e.indexOf("[",t),i=e.indexOf("![",t);if(-1===i)return n;return n<i?n:i}},function(e,t,n){const{h:i,render:r}=n(0),o=n(1),s=n(3).context("dialog");let a={opacity:0,pointerEvents:"none"},l=r(i("input",{type:"file",style:a}),document.body);t.showMessageBox=function(e,t="info",n=[s("OK")],i=0){return n.length<=1?(alert(e),0):confirm(e)?0:i},t.showOpenDialog=function(e,t){let n=l.cloneNode();l.parentNode.replaceChild(n,l),(l=n).multiple=e.properties.includes("multiSelections"),l.value="",l.addEventListener("change",e=>{t({result:e.currentTarget.files})}),l.click()},t.showSaveDialog=function(e,t){let{type:n,name:o,content:s}=e,l=`data:${n};charset=utf-8,${encodeURIComponent(s)}`,u=r(i("a",{href:l,style:a,download:o}),document.body);u.click(),u.remove()},t.showInputBox=function(e,t=o.noop,n=o.noop){sabaki.setState({inputBoxText:e,showInputBox:!0,onInputBoxSubmit:t,onInputBoxCancel:n})},t.closeInputBox=function(){let{onInputBoxCancel:e=o.noop}=sabaki.state;sabaki.setState({showInputBox:!1}),e()}},function(e,t,n){const i=n(10),{extname:r}=n(11),o=n(3).context("fileformats");let s=n(161),a=n(162),l=n(163),u={sgf:s,ngf:a,gib:l};t=e.exports=Object.assign({},u);let h=Object.keys(u).map(e=>u[e].meta),c=[].concat(...h.map(e=>e.extensions));t.meta=[{name:o("Game Records"),extensions:c},...h],t.getModuleByExtension=function(e){return u[Object.keys(u).find(t=>u[t].meta.extensions.includes(e.toLowerCase()))]||s},t.parseFile=function(e,n,o){let s=r(e.name).slice(1),a=t.getModuleByExtension(s);i.readFile(e,(e,t)=>{o({trees:a.parse(t,n)})})}},function(e,t){e.exports={from:e=>e}},function(e,t,n){const{getNeighbors:i,getChain:r}=n(27);e.exports=function(e){let t=e.length,n=0===t?0:e[0].length,o=[...Array(t)].map(e=>Array(n).fill(null));for(let s=0;s<n;s++)for(let n=0;n<t;n++){let t=[s,n];if(null!==o[n][s])continue;if(0!==e[n][s]){o[n][s]=e[n][s];continue}let a=r(e,t),l=0,u=1;for(let t of a){if(0===u)break;for(let n of i(t)){let[t,i]=n;if(e[i]&&null!=e[i][t]&&0!==e[i][t])if(0===l)l=e[i][t];else if(l!==e[i][t]){u=0;break}}}for(let[e,t]of a)o[t][e]=l*u}return o}},function(e,t){e.exports=function(e,t){let n=e.length,i=0===n?0:e[0].length,r=[...Array(n)].map(e=>Array(i).fill(1/0)),o=1/0,s=(n,i)=>{e[i][n]===t?o=0:o++,r[i][n]=o=Math.min(o,r[i][n])};for(let e=0;e<n;e++){o=1/0;for(let t=0;t<i;t++){let i=1/0;s(t,e),i=o;for(let i=e+1;i<n;i++)s(t,i);o=i;for(let n=e-1;n>=0;n--)s(t,n);o=i}}for(let e=n-1;e>=0;e--){o=1/0;for(let t=i-1;t>=0;t--){let i=1/0;s(t,e),i=o;for(let i=e+1;i<n;i++)s(t,i);o=i;for(let n=e-1;n>=0;n--)s(t,n);o=i}}return r}},function(e,t,n){const{getNeighbors:i,getChain:r}=n(27);e.exports=function(e,t,{p1:n=6,p2:o=1.5,p3:s=2}={}){let a=e.length,l=0===a?0:e[0].length,u=[...Array(a)].map(e=>Array(l).fill(0)),h=[l,a],c={},d=e=>e[0]>=0&&e[0]<l&&e[1]>=0&&e[1]<a?e:e.map((e,t)=>e<0?-e-1:e>=h[t]?2*h[t]-e-1:e),p=r=>{let a=r.map(e=>[e,0]),l={};for(;a.length>0;){let[r,h]=a.shift(),c=d(r);u[c[1]][c[0]]+=c!==r?s:o/(h/n*6+1);for(let o of i(r))h>=n||e[o[1]]&&null==e[o[1]][o[0]]&&e[o[1]][o[0]]===-t||o in l||(l[o]=!0,a.push([o,h+1]))}};for(let n=0;n<l;n++)for(let i=0;i<a;i++){let o=[n,i];if(e[i][n]!==t||o in c)continue;let s=r(e,o);s.forEach(e=>c[e]=!0),p(s)}return u}},function(e,t,n){(function(e){const t=n(10),i=n(28),{ipcRenderer:r,remote:o}=n(4),{app:s}=o,{h:a,render:l,Component:u}=n(0),h=n(2),c=n(7),d=n(48),p=n(7),f=n(68),m=n(155),g=n(166),y=n(167),v=n(168),b=n(169),w=(n(13),n(8)),x=n(171);b.useFetch("/static/node_modules/@sabaki/deadstones/wasm/deadstones_bg.wasm");const k=n(3),C=n(17),_=n(13),S=n(38),M=n(39),T=n(6),P=n(173),A=n(1),D=n(174),I=o.require("./setting"),E=n(175);l(a(class extends u{constructor(){super(),window.sabaki=this;let e=T.new();this.state={mode:"play",openDrawer:null,busy:0,fullScreen:!1,showMenuBar:null,zoomFactor:null,representedFilename:null,gameIndex:0,gameTrees:[e],gameCurrents:[{}],treePosition:e.root.id,selectedTool:"stone_1",scoringMethod:null,findText:"",findVertex:null,deadStones:[],blockedGuesses:[],highlightVertices:[],playVariation:null,showCoordinates:null,showMoveColorization:null,showMoveNumbers:null,showNextMoves:null,showSiblings:null,fuzzyStonePlacement:null,animateStonePlacement:null,consoleLog:[],showConsole:I.get("view.show_leftsidebar"),leftSidebarWidth:I.get("view.leftsidebar_width"),showGameGraph:I.get("view.show_graph"),showCommentBox:I.get("view.show_comments"),sidebarWidth:I.get("view.sidebar_width"),graphGridSize:null,graphNodeSize:null,engines:null,attachedEngines:[null,null],engineBusy:[!1,!1],engineCommands:[[],[]],generatingMoves:!1,analysisTreePosition:null,analysis:null,preferencesTab:"general",showInputBox:!1,inputBoxText:"",onInputBoxSubmit:A.noop,onInputBoxCancel:A.noop,infoOverlayText:"",showInfoOverlay:!1},this.events=new i,this.appName=s.getName(),this.version=s.getVersion(),this.window=o.getCurrentWindow(),this.treeHash=this.generateTreeHash(),this.attachedEngineSyncers=[null,null],this.historyPointer=0,this.history=[],this.recordHistory(),this.modules={Board:C,EngineSyncer:_,dialog:S,fileformats:M,gametree:T,helper:A,i18n:k,setting:I,sound:E},I.events.on("change",({key:e})=>this.updateSettingState(e)),this.updateSettingState()}componentDidMount(){window.addEventListener("contextmenu",e=>{e.preventDefault()}),window.addEventListener("load",()=>{this.events.emit("ready")}),r.on("load-file",(e,...t)=>{setTimeout(()=>this.loadFile(...t),I.get("app.loadgame_delay"))}),this.window.on("focus",()=>{I.get("file.show_reload_warning")&&this.askForReload(),this.buildMenu()}),this.window.on("resize",()=>{clearTimeout(this.resizeId),this.resizeId=setTimeout(()=>{if(!this.window.isMaximized()&&!this.window.isMinimized()&&!this.window.isFullScreen()){let[e,t]=this.window.getContentSize();I.set("window.width",e).set("window.height",t)}},1e3)});for(let e of document.querySelectorAll("#main main, #graph, #winrategraph"))e.addEventListener("wheel",e=>{e.preventDefault(),null==this.residueDeltaY&&(this.residueDeltaY=0),this.residueDeltaY+=e.deltaY,Math.abs(this.residueDeltaY)>=I.get("game.navigation_sensitivity")&&(this.goStep(Math.sign(this.residueDeltaY)),this.residueDeltaY=0)});document.body.addEventListener("dragover",e=>e.preventDefault()),document.body.addEventListener("drop",e=>{e.preventDefault(),0!==e.dataTransfer.files.length&&this.loadFile(e.dataTransfer.files[0])}),document.addEventListener("keydown",e=>{if("Escape"===e.key)this.state.generatingMoves?this.stopGeneratingMoves():null!=this.state.openDrawer?this.closeDrawer():"play"!==this.state.mode?this.setMode("play"):this.state.fullScreen&&this.setState({fullScreen:!1});else if(e.ctrlKey||e.metaKey||!["ArrowUp","ArrowDown"].includes(e.key)){if((e.ctrlKey||e.metaKey)&&["z","y"].includes(e.key.toLowerCase())){if(this.state.busy>0)return;let t="z"===e.key.toLowerCase()?-1:1;e.shiftKey&&(t=-t);let n=t<0?"undo":"redo";if(null!=n){if(A.isTextLikeElement(document.activeElement))return;e.preventDefault(),this[n]()}}}else{if(this.state.busy>0||A.isTextLikeElement(document.activeElement))return;e.preventDefault();let t="ArrowUp"===e.key?-1:1;this.startAutoscrolling(t)}}),document.addEventListener("keyup",e=>{null!=this.autoscrollId&&["ArrowUp","ArrowDown"].includes(e.key)&&this.stopAutoscrolling()}),document.addEventListener("keydown",e=>{["input","textarea"].indexOf(document.activeElement.tagName.toLowerCase())>=0||("Home"===e.key?this.goToBeginning():"End"===e.key?this.goToEnd():"ArrowLeft"===e.key?this.goToSiblingVariation(-1):"ArrowRight"===e.key&&this.goToSiblingVariation(1))}),window.addEventListener("beforeunload",e=>{e.returnValue=" "}),this.newFile()}componentDidUpdate(t,i={}){let{basename:r}=n(11),o=this.appName,{representedFilename:s,gameIndex:a,gameTrees:l}=this.state,u=k.context("app");if(s&&(o=r(s)),l.length>1&&(o+=" — "+u(e=>`Game ${e.gameNumber}`,{gameNumber:a+1})),s&&"darwin"!=e.platform&&(o+=" — "+this.appName),document.title!==o&&(document.title=o),i.fullScreen!==this.state.fullScreen&&(this.state.fullScreen&&this.flashInfoOverlay(u("Press Esc to exit full screen mode")),this.window.setFullScreen(this.state.fullScreen)),i.showMenuBar!==this.state.showMenuBar&&(this.state.showMenuBar||this.flashInfoOverlay(u("Press Alt to show menu bar")),this.window.setMenuBarVisibility(this.state.showMenuBar),this.window.setAutoHideMenuBar(!this.state.showMenuBar)),i.showLeftSidebar!==this.state.showLeftSidebar||i.showSidebar!==this.state.showSidebar){let[e,t]=this.window.getContentSize(),n=0;i.showSidebar!==this.state.showSidebar&&(n+=this.state.sidebarWidth*(this.state.showSidebar?1:-1)),i.showLeftSidebar!==this.state.showLeftSidebar&&(n+=this.state.leftSidebarWidth*(this.state.showLeftSidebar?1:-1)),this.window.isMaximized()||this.window.isMinimized()||this.window.isFullScreen()||this.window.setContentSize(e+n,t),window.dispatchEvent(new Event("resize"))}i.zoomFactor!==this.state.zoomFactor&&this.window.webContents.setZoomFactor(this.state.zoomFactor)}updateSettingState(e=null){let t={"app.zoom_factor":"zoomFactor","view.show_menubar":"showMenuBar","view.show_coordinates":"showCoordinates","view.show_move_colorization":"showMoveColorization","view.show_move_numbers":"showMoveNumbers","view.show_next_moves":"showNextMoves","view.show_siblings":"showSiblings","view.fuzzy_stone_placement":"fuzzyStonePlacement","view.animated_stone_placement":"animateStonePlacement","graph.grid_size":"graphGridSize","graph.node_size":"graphNodeSize","engines.list":"engines","scoring.method":"scoringMethod"};if(null!=e)e in t&&(this.buildMenu(),this.setState({[t[e]]:I.get(e)}));else for(let e in t)this.updateSettingState(e)}waitForRender(){return new Promise(e=>this.setState({},e))}buildMenu(e=!1){e&&o.require("./menu").buildMenu(),r.send("build-menu",this.state.busy>0)}setSidebarWidth(e){this.setState({sidebarWidth:e},()=>window.dispatchEvent(new Event("resize")))}setLeftSidebarWidth(e){this.setState({leftSidebarWidth:e},()=>window.dispatchEvent(new Event("resize")))}setMode(e){let t={mode:e};if(["scoring","estimator"].includes(e)){let{gameIndex:t,gameTrees:n,treePosition:i}=this.state,r=I.get("score.estimator_iterations"),o=n[t];b.guess(T.getBoard(o,i).arrangement,{finished:"scoring"===e,iterations:r}).then(e=>{this.setState({deadStones:e})})}else"edit"===e&&this.waitForRender().then(()=>{let e=document.querySelector("#properties .edit textarea");e.selectionStart=e.selectionEnd=0,e.focus()});this.setState(t),this.events.emit("modeChange")}openDrawer(e){this.setState({openDrawer:e})}closeDrawer(){this.openDrawer(null)}setBusy(e){let t=e?1:-1;this.setState(e=>({busy:Math.max(e.busy+t,0)}))}showInfoOverlay(e){this.setState({infoOverlayText:e,showInfoOverlay:!0})}hideInfoOverlay(){this.setState({showInfoOverlay:!1})}flashInfoOverlay(e,t=null){null==t&&(t=I.get("infooverlay.duration")),this.showInfoOverlay(e),clearTimeout(this.hideInfoOverlayId),this.hideInfoOverlayId=setTimeout(()=>this.hideInfoOverlay(),t)}clearConsole(){this.setState({consoleLog:[]})}recordHistory({prevGameIndex:e,prevTreePosition:t}={}){let n=this.history[this.historyPointer],i={gameIndex:this.state.gameIndex,gameTrees:this.state.gameTrees,treePosition:this.state.treePosition,timestamp:Date.now()};null!=n&&A.shallowEquals(n.gameTrees,i.gameTrees)||(this.history=this.history.slice(-I.get("edit.max_history_count"),this.historyPointer+1),null!=n&&i.timestamp-n.timestamp<I.get("edit.history_batch_interval")?this.history[this.historyPointer]=i:(null!=n&&null!=e&&null!=t&&(n.gameIndex=e,n.treePosition=t),this.history.push(i),this.historyPointer=this.history.length-1))}clearHistory(){this.history=[],this.recordHistory()}checkoutHistory(e){let t=this.history[e];if(null==t)return;let n=t.gameTrees[t.gameIndex];this.historyPointer=e,this.setState({gameIndex:t.gameIndex,gameTrees:t.gameTrees,gameCurrents:t.gameTrees.map(e=>({}))}),this.setCurrentTreePosition(n,t.treePosition,{clearCache:!0})}undo(){this.checkoutHistory(this.historyPointer-1)}redo(){this.checkoutHistory(this.historyPointer+1)}getEmptyGameTree(){let e=I.get("game.default_handicap"),t=I.get("game.default_board_size").toString().split(":").map(e=>+e),[n,i]=[t[0],t.slice(-1)[0]],r=new C(n,i).getHandicapPlacement(e).map(w.stringifyVertex),o=n===i?n.toString():`${n}:${i}`,s=new Date,a=w.stringifyDates([[s.getFullYear(),s.getMonth()+1,s.getDate()]]);return T.new().mutate(t=>{let n={GM:["1"],FF:["4"],CA:["UTF-8"],AP:[`${this.appName}:${this.version}`],KM:[I.get("game.default_komi")],SZ:[o],DT:[a]};r.length>0&&Object.assign(n,{HA:[e.toString()],AB:r});for(let e in n)t.updateProperty(t.root.id,e,n[e])})}async newFile({playSound:e=!1,showInfo:t=!1,suppressAskForSave:n=!1}={}){if(!n&&!this.askForSave())return;let i=this.getEmptyGameTree();await this.loadGameTrees([i],{suppressAskForSave:!0}),t&&this.openDrawer("info"),e&&E.playNewGame()}async loadFile(e=null,{suppressAskForSave:i=!1,clearHistory:r=!0}={}){if(!i&&!this.askForSave())return;let o=k.context("app.file");if(!e)return void S.showOpenDialog({properties:["openFile"],filters:[...M.meta,{name:o("All Files"),extensions:["*"]}]},({result:t})=>{t&&(e=t[0]),e&&this.loadFile(e,{suppressAskForSave:!0,clearHistory:r})});this.setBusy(!0);let{extname:s}=n(11),a=s(e.name).slice(1),l=await new Promise((n,i)=>t.readFile(e,(e,t)=>e?i(e):n(t))),u=[],h=!0,c=-1;try{if(0==(u=M.getModuleByExtension(a).parse(l,e=>{e.progress-c<.1||(this.window.setProgressBar(e.progress),c=e.progress)},!0)).length)throw!0}catch(e){S.showMessageBox(o("This file is unreadable."),"warning"),h=!1}h&&(await this.loadGameTrees(u,{suppressAskForSave:!0,clearHistory:r}),this.setState({representedFilename:e.name}),this.fileHash=this.generateFileHash(),I.get("game.goto_end_after_loading")&&this.goToEnd()),this.setBusy(!1)}async loadContent(e,t,n={}){this.setBusy(!0);let i=k.context("app.file"),r=[],o=!0,s=-1;try{if(0==(r=M.getModuleByExtension(t).parse(e,e=>{e.progress-s<.1||(this.window.setProgressBar(e.progress),s=e.progress)})).length)throw!0}catch(e){S.showMessageBox(i("This file is unreadable."),"warning"),o=!1}o&&await this.loadGameTrees(r,n),this.setBusy(!1)}async loadGameTrees(e,{suppressAskForSave:t=!1,clearHistory:n=!0}={}){if(P.rotate(),t||this.askForSave()){if(this.setBusy(!0),"gamechooser"!==this.state.openDrawer&&this.closeDrawer(),this.setMode("play"),await A.wait(I.get("app.loadgame_delay")),e.length>0){this.detachEngines(),this.clearConsole(),this.setState({representedFilename:null,gameIndex:0,gameTrees:e,gameCurrents:e.map(e=>({}))});let[t]=e;this.setCurrentTreePosition(t,t.root.id,{clearCache:!0}),this.treeHash=this.generateTreeHash(),this.fileHash=this.generateFileHash(),n&&this.clearHistory()}this.setBusy(!1),this.window.setProgressBar(-1),this.events.emit("fileLoad"),e.length>1&&(await A.wait(I.get("gamechooser.show_delay")),this.openDrawer("gamechooser"))}}saveFile(e=null){return S.showSaveDialog({type:"application/x-go-sgf",name:this.state.representedFilename||"game.sgf",content:this.getSGF()}),this.treeHash=this.generateTreeHash(),this.fileHash=this.generateFileHash(),!0}getSGF(){let{gameTrees:e}=this.state;return e=e.map(e=>e.mutate(e=>{e.updateProperty(e.root.id,"AP",[`${this.appName}:${this.version}`]),e.updateProperty(e.root.id,"CA",["UTF-8"])})),this.setState({gameTrees:e}),this.recordHistory(),w.stringify(e.map(e=>e.root),{linebreak:I.get("sgf.format_code")?A.linebreak:""})}generateTreeHash(){return this.state.gameTrees.map(e=>T.getHash(e)).join("-")}generateFileHash(){}askForSave(){let e=k.context("app.file");if(this.generateTreeHash()!==this.treeHash){let t=S.showMessageBox(e("Your changes will be lost if you close this file without saving. Do you want to continue?"),"warning",[e("Save"),e("Don’t Save"),e("Cancel")],2);if(0===t)return!0;if(2===t)return!1}return!0}askForReload(){}clickVertex(e,{button:t=0,ctrlKey:n=!1,x:i=0,y:r=0}={}){this.closeDrawer();let o=k.context("app.play"),{gameTrees:s,gameIndex:a,gameCurrents:l,treePosition:u}=this.state,h=s[a],c=T.getBoard(h,u),d=h.get(u);"string"==typeof e&&(e=c.coord2vertex(e));let[p,f]=e;if(["play","autoplay"].includes(this.state.mode)){if(0===t)if(0===c.get(e)){let t=I.get("gtp.auto_genmove");this.makeMove(e,{sendToEngine:t})}else null!=c.markers[f][p]&&"point"===c.markers[f][p].type&&I.get("edit.click_currentvertex_to_remove")&&this.removeNode(h,u);else if(2===t)if(null!=c.markers[f][p]&&"point"===c.markers[f][p].type)this.openCommentMenu(h,u,{x:i,y:r});else if(null!=this.state.analysis){let t=this.state.analysis.find(t=>A.vertexEquals(t.vertex,e));if(null!=t){let e=Math.max(...this.state.analysis.map(e=>e.visits*e.win)),n=Math.round(t.visits*t.win*8/e)+1,o=n>=8?"TE":n>=5?"IT":n>=3?"DO":"BM",s={BM:"1",DO:"",IT:"",TE:"1"},a=Math.round(100*(t.sign>0?t.win:100-t.win))/100;this.openVariationMenu(t.sign,t.variation,{x:i,y:r,startNodeProperties:{[o]:[s[o]],SBKV:[a.toString()]}})}}}else if("edit"===this.state.mode){if(n){let t=c.vertex2coord(e),n=d.data.C?d.data.C[0]:"",i=h.mutate(e=>{e.updateProperty(d.id,"C",""!==n?[n.trim()+" "+t]:[t])});return void this.setCurrentTreePosition(i,d.id)}let s=this.state.selectedTool;if(2===t)if(["stone_1","stone_-1"].includes(s))s="stone_1"===s?"stone_-1":"stone_1";else if(["number","label"].includes(s)){let t=()=>S.showInputBox(o("Enter label text"),({value:t})=>{this.useTool("label",e,t)}),n=[{label:o("&Edit Label"),click:t}];return void A.popupMenu(n,i,r)}["line","arrow"].includes(s)?this.editVertexData&&this.editVertexData[0]===s?(this.useTool(s,this.editVertexData[1],e),this.editVertexData=null):(this.useTool(s,e),this.editVertexData=[s,e]):(this.useTool(s,e),this.editVertexData=null)}else if(["scoring","estimator"].includes(this.state.mode)){if(0!==t||0===c.get(e))return;let{mode:n,deadStones:i}=this.state,r=i.some(t=>A.vertexEquals(t,e)),o="estimator"===n?c.getChain(e):c.getRelatedChains(e);i=r?i.filter(e=>!o.some(t=>A.vertexEquals(e,t))):[...i,...o],this.setState({deadStones:i})}else if("find"===this.state.mode){if(0!==t)return;A.vertexEquals(this.state.findVertex||[-1,-1],e)?this.setState({findVertex:null}):(this.setState({findVertex:e}),this.findMove(1,{vertex:e,text:this.state.findText}))}else if("guess"===this.state.mode){if(0!==t)return;let n=h.navigate(u,1,l[a]);if(null==n||null==n.data.B&&null==n.data.W)return this.setMode("play");let i=w.parseVertex(n.data[null!=n.data.B?"B":"W"][0]),r=T.getBoard(h,u);if(!r.hasVertex(i))return this.setMode("play");if(A.vertexEquals(e,i))this.makeMove(e,{player:null!=n.data.B?1:-1});else{if(0!==r.get(e)||this.state.blockedGuesses.some(t=>A.vertexEquals(t,e)))return;let t=[],[,n]=e.map((e,t)=>Math.abs(e-i[t])).reduce(([e,t],n,i)=>n>e?[n,i]:[e,t],[-1/0,-1]);for(let o=0;o<r.width;o++)for(let s=0;s<r.height;s++){let r=0===n?o:s;Math.abs(r-e[n])<Math.abs(r-i[n])&&t.push([o,s])}let{blockedGuesses:o}=this.state;o.push(...t),this.setState({blockedGuesses:o})}}this.events.emit("vertexClick")}makeMove(e,{player:t=null,sendToEngine:n=!1}={}){["play","autoplay","guess"].includes(this.state.mode)||(this.closeDrawer(),this.setMode("play"));let i=k.context("app.play"),{gameTrees:r,gameIndex:o,treePosition:s}=this.state,a=r[o],l=a.get(s),u=T.getBoard(a,s);"string"==typeof e&&(e=u.coord2vertex(e));let h=!u.hasVertex(e);if(!h&&0!==u.get(e))return;let c=a.get(l.parentId);t||(t=this.inferredState.currentPlayer);let d,p=t>0?"B":"W",f=!1,m=!1,g=!1,y={[p]:[w.stringifyVertex(e)]};if(!h){if(null!=c&&I.get("game.show_ko_warning")){let n=u.makeMove(t,e).getPositionHash();if((g=T.getBoard(a,c.id).getPositionHash()===n)&&0!=S.showMessageBox(i(["You are about to play a move which repeats a previous board position.","This is invalid in some rulesets. Do you want to play anyway?"].join("\n")),"info",[i("Play Anyway"),i("Don’t Play")],1))return}let n=u.getNeighbors(e);if((m=!(f=n.some(e=>u.get(e)==-t&&1==u.getLiberties(e).length))&&n.filter(e=>u.get(e)==t).every(e=>1==u.getLiberties(e).length)&&0==n.filter(e=>0==u.get(e)).length)&&I.get("game.show_suicide_warning")&&0!=S.showMessageBox(i(["You are about to play a suicide move.","This is invalid in some rulesets. Do you want to play anyway?"].join("\n")),"info",[i("Play Anyway"),i("Don’t Play")],1))return}let v=a.mutate(e=>{d=e.appendNode(s,y)}),b=null==a.get(d);if(this.setCurrentTreePosition(v,d),h)E.playPass();else{let e=I.get("sound.capture_delay_min");e+=Math.floor(Math.random()*(I.get("sound.capture_delay_max")-e)),(f||m)&&E.playCapture(e),E.playPachi()}let x=!1;if(h&&b&&null!=c){let e="B"===p?"W":"B";null!=l.data[e]&&""===l.data[e][0]&&(x=!0,this.setMode("scoring"))}if(this.events.emit("moveMake",{pass:h,capture:f,suicide:m,ko:g,enterScoring:x}),n&&this.attachedEngineSyncers.some(e=>null!=e)){let e=h?t:null;setTimeout(()=>this.generateMove({passPlayer:e}),I.get("gtp.move_delay"))}}makeResign({player:e=null}={}){let{gameTrees:t,gameIndex:n,treePosition:i}=this.state,{currentPlayer:r}=this.inferredState;null==e&&(e=r);let o=e>0?"W":"B",s=t[n].mutate(e=>{e.updateProperty(e.root.id,"RE",[`${o}+Resign`])});this.makeMainVariation(s,i),this.makeMove([-1,-1],{player:e}),this.events.emit("resign",{player:e})}useTool(e,t,n=null){let{gameTrees:i,gameIndex:r,treePosition:o}=this.state,{currentPlayer:s}=this.inferredState,a=i[r],l=T.getBoard(a,o),u=a.get(o);"string"==typeof t&&(t=l.coord2vertex(t));let h={cross:"MA",triangle:"TR",circle:"CR",square:"SQ",number:"LB",label:"LB"},c=a.mutate(i=>{if(["stone_-1","stone_1"].includes(e)){if(null!=u.data.B||null!=u.data.W||u.children.length>0){let e=i.appendNode(o,{PL:s>0?["B"]:["W"]});u=i.get(e)}let n="stone_1"===e?1:-1,r=l.get(t),a=["AW","AE","AB"],h=w.stringifyVertex(t);for(let e of a)null!=u.data[e]&&(u.data[e].some(e=>e.includes(":"))&&i.updateProperty(u.id,e,u.data[e].map(e=>w.parseCompressedVertices(e).map(w.stringifyVertex)).reduce((e,t)=>[...e,t])),i.removeFromProperty(u.id,e,h));let c=r!==n?a[n+1]:"AE";i.addToProperty(u.id,c,h)}else if(["line","arrow"].includes(e)){let r=n;if(!r||A.vertexEquals(t,r))return;let o=l.lines.findIndex(e=>A.equals([e.v1,e.v2],[t,r]));-1===o&&(o=l.lines.findIndex(e=>A.equals([e.v1,e.v2],[r,t])))>=0&&"line"!==e&&"arrow"===l.lines[o].type&&(o=-1),o>=0?l.lines.splice(o,1):l.lines.push({v1:t,v2:r,type:e}),i.removeProperty(u.id,"AR"),i.removeProperty(u.id,"LN");for(let{v1:e,v2:t,type:n}of l.lines){let[r,o]=[e,t].map(w.stringifyVertex);r!==o&&i.addToProperty(u.id,"arrow"===n?"AR":"LN",[r,o].join(":"))}}else{let[r,o]=t;if("number"===e)if(null!=l.markers[o][r]&&"label"===l.markers[o][r].type)l.markers[o][r]=null;else{let t=null==u.data.LB?1:u.data.LB.map(e=>parseFloat(e.slice(3))).filter(e=>!isNaN(e)).sort((e,t)=>e-t).filter((e,t,n)=>0===t||e!==n[t-1]).concat([null]).findIndex((e,t)=>t+1!==e)+1;n=t.toString(),l.markers[o][r]={type:e,label:t.toString()}}else if("label"===e){let t=n;if(null!=t&&""===t.trim()||null==t&&null!=l.markers[o][r]&&"label"===l.markers[o][r].type)l.markers[o][r]=null;else{if(null==t){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ",i=Math.max(null==u.data.LB?0:u.data.LB.filter(e=>4===e.length).map(t=>e.indexOf(t[3])).filter(e=>e>=0).sort((e,t)=>e-t).filter((e,t,n)=>0===t||e!==n[t-1]).concat([null]).findIndex((e,t)=>t!==e),null==u.data.L?0:u.data.L.length);t=e[Math.min(i,e.length-1)],n=t}l.markers[o][r]={type:e,label:t}}}else null!=l.markers[o][r]&&l.markers[o][r].type===e?l.markers[o][r]=null:l.markers[o][r]={type:e};i.removeProperty(u.id,"L");for(let e in h)i.removeProperty(u.id,h[e]);for(let e=0;e<l.width;e++)for(let t=0;t<l.height;t++){let n=[e,t];if(null==l.markers[t][e])continue;let r=h[l.markers[t][e].type],o=w.stringifyVertex(n);"LB"===r&&(o+=":"+l.markers[t][e].label),i.addToProperty(u.id,r,o)}}});this.setCurrentTreePosition(c,u.id),this.events.emit("toolUse",{tool:e,vertex:t,argument:n})}setCurrentTreePosition(e,t,{clearCache:n=!1}={}){n&&T.clearBoardCache(),["scoring","estimator"].includes(this.state.mode)&&this.setState({mode:"play"});let{gameTrees:i,gameCurrents:r}=this.state,o=i.findIndex(t=>t.root.id===e.root.id),s=r[o],a=e.get(t);for(;null!=a.parentId;)s[a.parentId]=a.id,a=e.get(a.parentId);null!=this.state.analysisTreePosition&&t!==this.state.analysisTreePosition&&(clearTimeout(this.navigateAnalysisId),this.stopAnalysis({removeAnalysisData:!1}),this.navigateAnalysisId=setTimeout(()=>{this.startAnalysis({showWarning:!1})},I.get("game.navigation_analysis_delay")));let l=this.state.gameIndex,u=this.state.treePosition;this.setState({playVariation:null,blockedGuesses:[],highlightVertices:[],gameTrees:i.map((t,n)=>n!==o?t:e),gameIndex:o,treePosition:t}),this.recordHistory({prevGameIndex:l,prevTreePosition:u}),this.events.emit("navigate")}goStep(e){let{gameTrees:t,gameIndex:n,gameCurrents:i,treePosition:r}=this.state,o=t[n],s=o.navigate(r,e,i[n]);null!=s&&this.setCurrentTreePosition(o,s.id)}goToMoveNumber(e){if(e=+e,isNaN(e))return;e<0&&(e=0);let{gameTrees:t,gameIndex:n,gameCurrents:i}=this.state,r=t[n],o=r.navigate(r.root.id,Math.round(e),i[n]);null!=o?this.setCurrentTreePosition(r,o.id):this.goToEnd()}goToNextFork(){let{gameTrees:e,gameIndex:t,gameCurrents:n,treePosition:i}=this.state,r=e[t],o=r.navigate(i,1,n[t]);if(null==o)return;let s=[...r.getSequence(o.id)];this.setCurrentTreePosition(r,s.slice(-1)[0].id)}goToPreviousFork(){let{gameTrees:e,gameIndex:t,gameCurrents:n,treePosition:i}=this.state,r=e[t],o=r.get(i),s=r.get(o.parentId);if(null==s)return;let a=r.root.id;for(let e of r.listNodesVertically(s.id,-1,n[t]))if(e.children.length>1){a=e.id;break}this.setCurrentTreePosition(r,a)}goToComment(e){let{gameTrees:t,gameIndex:n,gameCurrents:i,treePosition:r}=this.state,o=t[n],s=I.get("sgf.comment_properties"),a=null;for(let t of o.listNodesVertically(r,e,i[n]))if(t.id!==r&&s.some(e=>null!=t.data[e])){a=t.id;break}null!=a&&this.setCurrentTreePosition(o,a)}goToBeginning(){let{gameTrees:e,gameIndex:t}=this.state,n=e[t];this.setCurrentTreePosition(n,n.root.id)}goToEnd(){let{gameTrees:e,gameIndex:t,gameCurrents:n}=this.state,i=e[t],[r]=[...i.listCurrentNodes(n[t])].slice(-1);this.setCurrentTreePosition(i,r.id)}goToSiblingVariation(e){let{gameTrees:t,gameIndex:n,treePosition:i}=this.state,r=t[n],o=[...r.getSection(r.getLevel(i))],s=((e+o.findIndex(e=>e.id===i))%o.length+o.length)%o.length;this.setCurrentTreePosition(r,o[s].id)}goToMainVariation(){let{gameTrees:e,gameIndex:t,gameCurrents:n,treePosition:i}=this.state,r=e[t];if(n[t]={},this.setState({gameCurrents:n}),r.onMainLine(i))this.setCurrentTreePosition(r,i);else{let e=i;for(;!r.onMainLine(e);)e=r.get(e).parentId;this.setCurrentTreePosition(r,e)}}goToSiblingGame(e){let{gameTrees:t,gameIndex:n}=this.state,i=Math.max(0,Math.min(t.length-1,n+e));this.setCurrentTreePosition(t[i],t[i].root.id)}startAutoscrolling(e){if(null!=this.autoscrollId)return;let t=!0,n=I.get("autoscroll.max_interval"),i=I.get("autoscroll.min_interval"),r=I.get("autoscroll.diff"),o=(s=null)=>{this.goStep(e),clearTimeout(this.autoscrollId),this.autoscrollId=setTimeout(()=>{o(t?n:Math.max(i,s-r)),t=!1},s)};o(400)}stopAutoscrolling(){clearTimeout(this.autoscrollId),this.autoscrollId=null}async findPosition(e,t){e=isNaN(e)?1:e>=0?1:-1,this.setBusy(!0),await A.wait(I.get("find.delay"));let{gameTrees:n,gameIndex:i,treePosition:r}=this.state,o=n[i],s=o.get(r);for(s of function*(){let t=o.listNodesHorizontally(r,e);t.next(),yield*t;let n=e>0?o.root:[...o.getSection(o.getHeight()-1)].slice(-1)[0];yield*o.listNodesHorizontally(n.id,e)}())if(s.id===r||t(s))break;this.setCurrentTreePosition(o,s.id),this.setBusy(!1)}async findHotspot(e){await this.findPosition(e,e=>null!=e.data.HO)}async findMove(e,{vertex:t=null,text:n=""}){if(null==t&&""===n.trim())return;let i=t?w.stringifyVertex(t):null;await this.findPosition(e,e=>{let t=(t,n)=>null!=e.data[t]&&e.data[t][0].toLowerCase().includes(n.toLowerCase());return(!i||["B","W"].some(e=>t(e,i)))&&(!n||t("C",n)||t("N",n))})}getGameInfo(e){let t=T.getRootProperty(e,"KM");t=null==t||isNaN(t)?null:+t;let n=T.getRootProperty(e,"SZ");if(null==n)n=[19,19];else{let e=n.toString().split(":");n=[+e[0],+e[e.length-1]]}let i=T.getRootProperty(e,"HA",0);1===(i=Math.max(1,Math.min(9,Math.round(i))))&&(i=0);let r=["B","W"].map(t=>T.getRootProperty(e,`P${t}`)||T.getRootProperty(e,`${t}T`)),o=["BR","WR"].map(t=>T.getRootProperty(e,t));return{playerNames:r,playerRanks:o,blackName:r[0],blackRank:o[0],whiteName:r[1],whiteRank:o[1],gameName:T.getRootProperty(e,"GN"),eventName:T.getRootProperty(e,"EV"),date:T.getRootProperty(e,"DT"),result:T.getRootProperty(e,"RE"),komi:t,handicap:i,size:n}}setGameInfo(e,t){let n=e.mutate(n=>{if("size"in t)if(t.size){let e=t.size;e=(e=e.map(e=>isNaN(e)||!e?19:Math.min(25,Math.max(2,e))))[0]===e[1]?e[0].toString():e.join(":"),I.set("game.default_board_size",e),n.updateProperty(n.root.id,"SZ",[e])}else n.removeProperty(n.root.id,"SZ");let i={blackName:"PB",blackRank:"BR",whiteName:"PW",whiteRank:"WR",gameName:"GN",eventName:"EV",date:"DT",result:"RE",komi:"KM",handicap:"HA"};for(let r in i){if(!(r in t))continue;let o=t[r];if(o&&""!==o.toString()){if("komi"===r)isNaN(o)&&(o=0),I.set("game.default_komi",o);else if("handicap"===r){let t=T.getBoard(e,e.root.id).getHandicapPlacement(+o);if(o=t.length,I.set("game.default_handicap",o),o<=1){n.removeProperty(n.root.id,i[r]),n.removeProperty(n.root.id,"AB");continue}n.updateProperty(n.root.id,"AB",t.map(w.stringifyVertex))}n.updateProperty(n.root.id,i[r],[o.toString()])}else n.removeProperty(n.root.id,i[r])}});this.setCurrentTreePosition(n,this.state.treePosition)}getPlayer(e,t){let{data:n}=e.get(t);return null!=n.PL?"W"===n.PL[0]?-1:1:null!=n.B||null!=n.HA&&+n.HA[0]>=1?-1:1}setPlayer(e,t,n){let i=e.mutate(e=>{let i=e.get(t);(null!=i.data.B||null!=i.data.HA&&+i.data.HA[0]>=1?-1:+(null!=i.data.W))===n||0===n?e.removeProperty(t,"PL"):e.updateProperty(t,"PL",[n>0?"B":"W"])});this.setCurrentTreePosition(i,t)}getComment(e,t){let{data:n}=e.get(t);return{title:null!=n.N?n.N[0].trim():null,comment:null!=n.C?n.C[0]:null,hotspot:null!=n.HO,moveAnnotation:null!=n.BM?"BM":null!=n.TE?"TE":null!=n.DO?"DO":null!=n.IT?"IT":null,positionAnnotation:null!=n.UC?"UC":null!=n.GW?"GW":null!=n.DM?"DM":null!=n.GB?"GB":null}}setComment(e,t,n){let i=e.mutate(e=>{for(let[i,r]of[["title","N"],["comment","C"]])i in n&&(n[i]&&""!==n[i].trim()?e.updateProperty(t,r,[n[i]]):e.removeProperty(t,r));"hotspot"in n&&(n.hotspot?e.updateProperty(t,"HO",["1"]):e.removeProperty(t,"HO"));let i=n=>n.forEach(n=>e.removeProperty(t,n));if("moveAnnotation"in n){let r={BM:"1",DO:"",IT:"",TE:"1"};i(Object.keys(r)),null!=n.moveAnnotation&&e.updateProperty(t,n.moveAnnotation,[r[n.moveAnnotation]])}if("positionAnnotation"in n){let r={UC:"1",GW:"1",GB:"1",DM:"1"};i(Object.keys(r)),null!=n.positionAnnotation&&e.updateProperty(t,n.positionAnnotation,[r[n.positionAnnotation]])}});this.setCurrentTreePosition(i,t)}rotateBoard(e){let{treePosition:t,gameTrees:n,gameIndex:i}=this.state,r=n[i],{size:o}=this.getGameInfo(r),s=D.rotateTree(r,o[0],o[1],e);this.setCurrentTreePosition(s,t,{clearCache:!0})}flipBoard(e){let{treePosition:t,gameTrees:n,gameIndex:i}=this.state,r=n[i],{size:o}=this.getGameInfo(r),s=D.flipTree(r,o[0],o[1],e);this.setCurrentTreePosition(s,t,{clearCache:!0})}invertColors(){let{treePosition:e,gameTrees:t,gameIndex:n}=this.state,i=t[n],r=D.invertTreeColors(i);this.setCurrentTreePosition(r,e,{clearCache:!0})}copyVariation(e,t){let n=e.get(t),i={id:n.id,data:Object.assign({},n.data),parentId:null,children:n.children},r=I.get("edit.copy_variation_strip_props");for(let e of r)delete i.data[e];this.copyVariationData=i}cutVariation(e,t){this.copyVariation(e,t),this.removeNode(e,t,{suppressConfirmation:!0})}pasteVariation(e,t){if(null==this.copyVariationData)return;let n;this.closeDrawer(),this.setMode("play");let i=this.copyVariationData,r=e.mutate(e=>{let r=(t,n)=>{let i=[];for(let o of n){let n=e.appendNode(t,o.data);i.push(n),r(n,o.children)}return i};n=r(t,[i])[0]});this.setCurrentTreePosition(r,n)}flattenVariation(e,t){this.closeDrawer(),this.setMode("play");let{gameTrees:n}=this.state,i=n.findIndex(t=>t.root.id===e.root.id);if(i<0)return;let r=T.getBoard(e,t),o=I.get("edit.flatten_inherit_root_props"),s=e.mutate(n=>{n.makeRoot(t);for(let e of["AB","AW","AE","B","W"])n.removeProperty(t,e);for(let i of o)n.updateProperty(t,i,e.root.data[i]);for(let e=0;e<r.width;e++)for(let i=0;i<r.height;i++){let o=r.get([e,i]);0!=o&&n.addToProperty(t,o>0?"AB":"AW",w.stringifyVertex([e,i]))}});this.setState({gameTrees:n.map((e,t)=>t===i?s:e)}),this.setCurrentTreePosition(s,s.root.id)}makeMainVariation(e,t){this.closeDrawer(),this.setMode("play");let{gameCurrents:n,gameTrees:i}=this.state,r=i.findIndex(t=>t.root.id===e.root.id);if(r<0)return;let o=e.mutate(e=>{let n=t;for(;null!=n;)e.shiftNode(n,"main"),n=e.get(n).parentId});n[r]={},this.setState({gameCurrents:n}),this.setCurrentTreePosition(o,t)}shiftVariation(e,t,n){this.closeDrawer(),this.setMode("play");let i=null;for(let n of e.listNodesVertically(t,-1,{}))if(e.get(n.parentId).children.length>=2){i=n;break}if(null==i)return;let r=e.mutate(e=>{e.shiftNode(i.id,n>=0?"right":"left")});this.setCurrentTreePosition(r,t)}removeNode(e,t,{suppressConfirmation:n=!1}={}){let i=k.context("app.node"),r=e.get(t);if(null==r.parentId)return void S.showMessageBox(i("The root node cannot be removed."),"warning");if(!0!==n&&I.get("edit.show_removenode_warning")&&1===S.showMessageBox(i("Do you really want to remove this node?"),"warning",[i("Remove Node"),i("Cancel")],1))return;this.closeDrawer(),this.setMode("play");let o=e.mutate(e=>{e.removeNode(t)});this.setState(({gameCurrents:e,gameIndex:t})=>(e[t][r.parentId]===r.id&&delete e[t][r.parentId],{gameCurrents:e})),this.setCurrentTreePosition(o,r.parentId)}removeOtherVariations(e,t,{suppressConfirmation:n=!1}={}){let i=k.context("app.node");if(!0!==n&&I.get("edit.show_removeothervariations_warning")&&1==S.showMessageBox(i("Do you really want to remove all other variations?"),"warning",[i("Remove Variations"),i("Cancel")],1))return;this.closeDrawer(),this.setMode("play");let{gameCurrents:r,gameTrees:o}=this.state,s=o.findIndex(t=>t.root.id===e.root.id);if(s<0)return;let a=e.mutate(n=>{for(let i of e.listNodesVertically(t,1,r[s])){if(i.children.length<=1)continue;let t=e.navigate(i.id,1,r[s]);for(let e of i.children)e.id!==t.id&&n.removeNode(e.id)}let i=t;for(let o of e.listNodesVertically(t,-1,{})){if(o.id!==i&&o.children.length>1){r[s][o.id]=i;for(let e of o.children)e.id!==i&&n.removeNode(e.id)}i=o.id}});this.setState({gameCurrents:r}),this.setCurrentTreePosition(a,t)}openNodeMenu(e,t,{x:n,y:i}={}){if("scoring"===this.state.mode)return;let r=k.context("menu.edit"),o=[{label:r("&Copy Variation"),click:()=>this.copyVariation(e,t)},{label:r("Cu&t Variation"),click:()=>this.cutVariation(e,t)},{label:r("&Paste Variation"),click:()=>this.pasteVariation(e,t)},{type:"separator"},{label:r("Make Main &Variation"),click:()=>this.makeMainVariation(e,t)},{label:r("Shift &Left"),click:()=>this.shiftVariation(e,t,-1)},{label:r("Shift Ri&ght"),click:()=>this.shiftVariation(e,t,1)},{type:"separator"},{label:r("&Flatten"),click:()=>this.flattenVariation(e,t)},{label:r("&Remove Node"),click:()=>this.removeNode(e,t)},{label:r("Remove &Other Variations"),click:()=>this.removeOtherVariations(e,t)}];A.popupMenu(o,n,i)}openCommentMenu(e,t,{x:n,y:i}={}){let r=k.context("menu.comment"),o=e.get(t),s=[{label:r("&Clear Annotations"),click:()=>{this.setComment(e,t,{positionAnnotation:null,moveAnnotation:null})}},{type:"separator"},{label:r("Good for &Black"),type:"checkbox",data:{positionAnnotation:"GB"}},{label:r("&Unclear Position"),type:"checkbox",data:{positionAnnotation:"UC"}},{label:r("&Even Position"),type:"checkbox",data:{positionAnnotation:"DM"}},{label:r("Good for &White"),type:"checkbox",data:{positionAnnotation:"GW"}}];null==o.data.B&&null==o.data.W||s.push({type:"separator"},{label:r("&Good Move"),type:"checkbox",data:{moveAnnotation:"TE"}},{label:r("&Interesting Move"),type:"checkbox",data:{moveAnnotation:"IT"}},{label:r("&Doubtful Move"),type:"checkbox",data:{moveAnnotation:"DO"}},{label:r("B&ad Move"),type:"checkbox",data:{moveAnnotation:"BM"}}),s.push({type:"separator"},{label:r("&Hotspot"),type:"checkbox",data:{hotspot:!0}});for(let n of s){if(!("data"in n))continue;let[i]=Object.keys(n.data),r="hotspot"===i?"HO":n.data[i];n.checked=null!=o.data[r],n.checked&&(n.data[i]=null),n.click=(()=>this.setComment(e,t,n.data))}A.popupMenu(s,n,i)}openVariationMenu(e,t,{x:n,y:i,appendSibling:r=!1,startNodeProperties:o={}}={}){let s=k.context("menu.variation"),{gameTrees:a,gameIndex:l,treePosition:u}=this.state,h=a[l];A.popupMenu([{label:s("&Add Variation"),click:()=>{let n=null==h.get(u).parentId;if(r&&n)return void S.showMessageBox(s("The root node cannot have sibling nodes."),"warning");let[i,a]=e>0?["B","W"]:["W","B"],l=h.mutate(e=>{let n=r?h.get(u).parentId:u,s=t.map((e,t)=>Object.assign({[t%2==0?i:a]:[w.stringifyVertex(e)]},0===t?o:{}));for(let t of s)n=e.appendNode(n,t)});this.setCurrentTreePosition(l,u)}}],n,i)}attachEngines(...e){}detachEngines(){}suspendEngines(){}handleCommandSent({syncer:e,command:t,subscribe:n,getResponse:i}){}async syncEngines({passPlayer:e=null}={}){}async startAnalysis({showWarning:e=!0}={}){}stopAnalysis(){}async generateMove({passPlayer:e=null,firstMove:t=!0,followUp:n=!1}={}){}stopGeneratingMoves(){}render(e,t){let n,i,{gameTrees:r,gameIndex:o,treePosition:s}=t,l=r[o];if(["scoring","estimator"].includes(t.mode)){n=T.getBoard(l,t.treePosition).clone();for(let e of t.deadStones){let t=n.get(e);0!==t&&(n.captures[t>0?1:0]++,n.set(e,0))}i="estimator"===t.mode?x.map(n.arrangement,{discrete:!0}):x.areaMap(n.arrangement)}return this.inferredState={gameTree:l,showSidebar:t.showGameGraph||t.showCommentBox,showLeftSidebar:t.showConsole,gameInfo:this.getGameInfo(l),currentPlayer:this.getPlayer(l,s),scoreBoard:n,areaMap:i},t=Object.assign(t,this.inferredState),a("section",{class:h({leftsidebar:t.showLeftSidebar,sidebar:t.showSidebar,[t.mode]:!0})},a(c),a(d,t),a(p,t),a(f,t),a(m,t),a(g,{text:t.inputBoxText,show:t.showInputBox,onSubmit:t.onInputBoxSubmit,onCancel:t.onInputBoxCancel}),a(y,{show:t.busy>0}),a(v,{text:t.infoOverlayText,show:t.showInfoOverlay}))}}),document.body)}).call(this,n(14))},function(e,t,n){"use strict";e.exports=(e=>{const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.contain="strict",t.style.position="absolute",t.style.left="-9999px",t.style.fontSize="12pt";const n=document.getSelection();let i=!1;n.rangeCount>0&&(i=n.getRangeAt(0)),document.body.appendChild(t),t.select(),t.selectionStart=0,t.selectionEnd=e.length;let r=!1;try{r=document.execCommand("copy")}catch(e){}return document.body.removeChild(t),i&&(n.removeAllRanges(),n.addRange(i)),r})},function(e,t,n){const i=n(28);let r={},o={"app.always_show_result":!1,"app.enable_hardware_acceleration":!0,"app.hide_busy_delay":200,"app.lang":"default","app.loadgame_delay":100,"app.startup_check_updates":!0,"app.startup_check_updates_delay":3e3,"app.zoom_factor":1,"autoplay.max_sec_per_move":99,"autoplay.sec_per_move":1,"autoscroll.delay":400,"autoscroll.diff":10,"autoscroll.max_interval":200,"autoscroll.min_interval":50,"board.analysis_interval":100,"board.variation_instant_replay":!1,"board.variation_replay_interval":500,"cleanmarkup.annotations":!1,"cleanmarkup.arrow":!0,"cleanmarkup.circle":!0,"cleanmarkup.comments":!1,"cleanmarkup.cross":!0,"cleanmarkup.hotspots":!1,"cleanmarkup.label":!0,"cleanmarkup.line":!0,"cleanmarkup.square":!0,"cleanmarkup.triangle":!0,"cleanmarkup.winrate":!1,"comments.show_move_interpretation":!0,"comments.commit_delay":500,"console.max_history_count":1e3,"debug.dev_tools":!1,"edit.click_currentvertex_to_remove":!0,"edit.copy_variation_strip_props":["AP","CA","FF","GM","ST","SZ","KM","HA","AN","BR","BT","CP","DT","EV","GN","GC","ON","OT","PB","PC","PW","RE","RO","RU","SO","TM","US","WR","WT"],"edit.flatten_inherit_root_props":["BR","BT","DT","EV","GN","GC","PB","PW","RE","SO","SZ","WT","WR"],"edit.history_batch_interval":500,"edit.max_history_count":1e3,"edit.show_removenode_warning":!0,"edit.show_removeothervariations_warning":!0,"engines.list":[],"file.show_reload_warning":!0,"find.delay":100,"game.default_board_size":19,"game.default_komi":6.5,"game.default_handicap":0,"game.goto_end_after_loading":!1,"game.navigation_analysis_delay":500,"game.navigation_sensitivity":40,"game.show_ko_warning":!0,"game.show_suicide_warning":!0,"gamechooser.show_delay":100,"gamechooser.thumbnail_size":153,"graph.delay":200,"graph.grid_size":26,"graph.node_size":6,"gtp.auto_genmove":!0,"gtp.console_log_enabled":!1,"gtp.console_log_path":null,"gtp.engine_quit_timeout":3e3,"gtp.move_delay":300,"gtp.start_game_after_attach":!0,"score.estimator_iterations":100,"scoring.method":"territory","setting.overwrite.v0.16.0":["window.minheight"],"setting.overwrite.v0.17.1":["graph.collapse_tokens_count"],"setting.overwrite.v0.19.0_1":["window.minheight","graph.delay"],"setting.overwrite.v0.19.1":["app.startup_check_updates_delay"],"setting.overwrite.v0.19.3":["graph.grid_size","graph.node_size"],"setting.overwrite.v0.30.0-beta":["graph.delay","window.minheight","window.minwidth"],"setting.overwrite.v0.33.0":["console.max_history_count"],"setting.overwrite.v0.33.4":["score.estimator_iterations"],"setting.overwrite.v0.41.0":["autoscroll.max_interval"],"sgf.comment_properties":["C","N","UC","GW","DM","GB","BM","TE","DO","IT"],"sgf.format_code":!1,"sound.capture_delay_max":500,"sound.capture_delay_min":300,"sound.enable":!0,"theme.custom_whitestones":null,"theme.custom_blackstones":null,"theme.custom_board":null,"theme.custom_background":null,"theme.current":null,"view.animated_stone_placement":!0,"view.fuzzy_stone_placement":!0,"view.properties_height":50,"view.properties_minheight":20,"view.show_menubar":!0,"view.show_leftsidebar":!1,"view.show_comments":!0,"view.show_coordinates":!1,"view.show_graph":!0,"view.show_move_colorization":!0,"view.show_move_numbers":!1,"view.show_next_moves":!0,"view.show_siblings":!0,"view.leftsidebar_width":250,"view.leftsidebar_minwidth":100,"view.sidebar_width":280,"view.sidebar_minwidth":100,"view.winrategraph_height":60,"view.winrategraph_minheight":25,"view.winrategraph_invert":!1,"infooverlay.duration":2e3,"window.height":604,"window.minheight":440,"window.minwidth":526,"window.width":564};t.events=new i,t.events.setMaxListeners(100),t.load=function(){r=null!=localStorage.sabaki_settings?JSON.parse(localStorage.sabaki_settings):{};for(let e in o)e in r||(r[e]=o[e]);for(let e in r)e in o||delete r[e];for(let e in r){if(0!=e.indexOf("setting.overwrite."))continue;let t=r[e];if(t.length){for(let e=0;e<t.length;e++)r[t[e]]=o[t[e]];r[e]=[]}}return t.save()},t.loadThemes=function(){return{}},t.save=function(){let e=Object.keys(r).sort();return localStorage.sabaki_settings=JSON.stringify(e.reduce((e,t)=>(e[t]=r[t],e),{}),null,"  "),t},t.get=function(e){return e in r?r[e]:e in o?o[e]:null},t.set=function(e,n){return r[e]=n,t.save(),t.events.emit("change",{key:e,value:n}),t},t.getThemes=function(){return t.loadThemes(),null},t.load()},function(e,t,n){const{h:i,render:r}=n(0),o=n(2);t.buildFromTemplate=function(e){return{popup:({x:t,y:n})=>(function(e,t,n){let i=r(e,document.body).childNodes[0],{width:o,height:s}=i.getBoundingClientRect(),{width:a,height:l}=document.body.getBoundingClientRect();i.style.left=(t+o<=a?t:Math.max(0,t-o))+"px",i.style.top=(n+s<=l?n:Math.max(0,n-s))+"px"})(i("section",{id:"popupmenu-overlay",onClick:()=>void document.getElementById("popupmenu-overlay").remove()},i("ul",{class:"popupmenu"},e.map(e=>i("li",{class:o({checked:e.checked,[e.type]:e.type}),onClick:()=>e.click&&e.click()},e.label&&e.label.replace(/&/g,""))))),t,n)}},r(i("style",{},"\n    #popupmenu-overlay {\n        position: absolute;\n        left: 0;\n        top: 0;\n        right: 0;\n        bottom: 0;\n        z-index: 1000;\n    }\n\n    .popupmenu {\n            position: absolute;\n            padding: 3px 0;\n            max-height: calc(100% - 6px);\n            max-width: 100%;\n            overflow: auto;\n            background: rgba(0, 0, 0, .9);\n            box-shadow: 0 5px 10px rgba(0, 0, 0, .5);\n            color: white;\n            list-style: none;\n        }\n        .popupmenu li:not(.separator) {\n            position: relative;\n            display: block;\n            height: 1em;\n            padding: 7px 30px;\n            line-height: 1em;\n        }\n        .popupmenu li.checked::before {\n            content: '';\n            position: absolute;\n            width: 1em;\n            height: 1em;\n            left: 9px;\n            top: 7px;\n            background: url('/static/node_modules/octicons/build/svg/check.svg') left top/contain no-repeat;\n            filter: invert(100%);\n            -webkit-filter: invert(100%);\n        }\n        .popupmenu li.separator {\n            height: 2px;\n            margin: 3px 0;\n            background: rgba(255, 255, 255, .3);\n        }\n        .popupmenu li:not(.separator):hover {\n            background-color: #0050C0;\n        }\n        .popupmenu li:not(.separator):active {\n            background-color: #0030A0;\n    }\n"),document.body)},function(e,t,n){const{h:i,Component:r}=n(0),o=n(49),s=n(63),a=n(65),l=n(7),u=n(7),h=n(66),c=n(67),d=n(6);e.exports=class extends r{constructor(e){super(e),this.handleTogglePlayer=(()=>{let{gameTree:e,treePosition:t,currentPlayer:n}=this.props;sabaki.setPlayer(e,t,-n)}),this.handleToolButtonClick=(e=>{sabaki.setState({selectedTool:e.tool})}),this.handleFindButtonClick=(e=>sabaki.findMove(e.step,{vertex:this.props.findVertex,text:this.props.findText})),this.handleGobanVertexClick=this.handleGobanVertexClick.bind(this),this.handleGobanLineDraw=this.handleGobanLineDraw.bind(this)}componentDidMount(){document.addEventListener("keydown",e=>{"Control"===e.key&&"Meta"===e.key&&"edit"===this.props.mode&&this.setState({gobanCrosshair:!0})}),document.addEventListener("keyup",e=>{"Control"===e.key&&"Meta"===e.key&&"edit"===this.props.mode&&this.setState({gobanCrosshair:!1})})}componentWillReceiveProps(e){"edit"!==e.mode&&this.setState({gobanCrosshair:!1})}handleGobanVertexClick(e){sabaki.clickVertex(e.vertex,e)}handleGobanLineDraw(e){let{v1:t,v2:n}=e.line;sabaki.useTool(this.props.selectedTool,t,n),sabaki.editVertexData=null}render({mode:e,gameIndex:t,gameTree:n,gameCurrents:r,treePosition:p,currentPlayer:f,gameInfo:m,attachedEngines:g,engineBusy:y,analysisTreePosition:v,deadStones:b,scoringMethod:w,scoreBoard:x,playVariation:k,analysis:C,areaMap:_,blockedGuesses:S,highlightVertices:M,showCoordinates:T,showMoveColorization:P,showMoveNumbers:A,showNextMoves:D,showSiblings:I,fuzzyStonePlacement:E,animateStonePlacement:N,selectedTool:B,findText:O,findVertex:L,showLeftSidebar:R,showSidebar:z,sidebarWidth:V,leftSidebarWidth:j},{width:W,height:F,gobanCrosshair:H}){let $,G=n.get(p),U=d.getBoard(n,p),q=+d.getRootProperty(n,"KM",0),Y=+d.getRootProperty(n,"HA",0);if(["scoring","estimator"].includes(e))$=_;else if("guess"===e){$=[...Array(U.height)].map(e=>Array(U.width).fill(0));for(let[e,t]of S)$[t][e]=1}return i("section",{id:"main",style:{left:R?j:null,right:z?V:null}},i("main",{ref:e=>this.mainElement=e,style:{width:W,height:F}},i(o,{gameTree:n,treePosition:p,board:U,highlightVertices:L&&"find"===e?[L]:M,analysis:"play"===e&&null!=v&&v===p?C:null,paintMap:$,dimmedStones:["scoring","estimator"].includes(e)?b:[],crosshair:H,showCoordinates:T,showMoveColorization:P,showMoveNumbers:"edit"!==e&&A,showNextMoves:"guess"!==e&&D,showSiblings:"guess"!==e&&I,fuzzyStonePlacement:E,animateStonePlacement:N,playVariation:k,drawLineMode:"edit"===e&&["arrow","line"].includes(B)?B:null,onVertexClick:this.handleGobanVertexClick,onLineDraw:this.handleGobanLineDraw})),i("section",{id:"bar"},i(s,{mode:e,attachedEngines:g,playerBusy:y,playerNames:m.playerNames,playerRanks:m.playerRanks,playerCaptures:U.captures,currentPlayer:f,showHotspot:null!=G.data.HO,onCurrentPlayerClick:this.handleTogglePlayer}),i(a,{mode:e,selectedTool:B,onToolButtonClick:this.handleToolButtonClick}),i(l,{mode:e,treePosition:p}),i(u,{mode:e,gameTree:n,gameCurrents:r[t],treePosition:p}),i(h,{type:"scoring",mode:e,method:w,scoreBoard:x,areaMap:_,komi:q,handicap:Y}),i(h,{type:"estimator",mode:e,method:w,scoreBoard:x,areaMap:_,komi:q,handicap:Y}),i(c,{mode:e,findText:O,onButtonClick:this.handleFindButtonClick})))}}},function(e,t,n){const{h:i,Component:r}=n(0),o=n(2),s=n(8),{BoundedGoban:a}=n(55),{remote:l}=n(4),u=n(6),h=n(1),c=l.require("./setting");e.exports=class extends r{constructor(e){super(e),this.handleVertexMouseUp=this.handleVertexMouseUp.bind(this),this.handleVertexMouseDown=this.handleVertexMouseDown.bind(this),this.handleVertexMouseMove=this.handleVertexMouseMove.bind(this),this.handleVertexMouseEnter=this.handleVertexMouseEnter.bind(this),this.handleVertexMouseLeave=this.handleVertexMouseLeave.bind(this),this.componentWillReceiveProps()}componentDidMount(){document.addEventListener("mouseup",()=>{this.mouseDown=!1,this.state.temporaryLine&&this.setState({temporaryLine:null})}),window.addEventListener("resize",()=>{this.componentDidUpdate(),this.setState({})}),this.componentDidUpdate()}componentDidUpdate(){if(!this.element||!this.element.parentElement)return;let{offsetWidth:e,offsetHeight:t}=this.element.parentElement;e===this.state.maxWidth&&t===this.state.maxHeight||this.setState({maxWidth:e,maxHeight:t}),setTimeout(()=>{let{offsetWidth:n,offsetHeight:i}=this.element,r=Math.round((e-n)/2),o=Math.round((t-i)/2);r===this.state.left&&o===this.state.top||this.setState({left:r,top:o})},0)}componentWillReceiveProps(e={}){if(e.playVariation!==this.props.playVariation)if(null!=e.playVariation){let{sign:t,variation:n,sibling:i}=e.playVariation;this.stopPlayingVariation(),this.playVariation(t,n,i)}else this.stopPlayingVariation()}handleVertexMouseDown(e,t){this.mouseDown=!0,this.startVertex=t}handleVertexMouseUp(e,t){if(!this.mouseDown)return;let{onVertexClick:n=h.noop,onLineDraw:i=h.noop}=this.props;this.mouseDown=!1,e.vertex=t,e.line=this.state.temporaryLine,null==e.x&&(e.x=e.clientX),null==e.y&&(e.y=e.clientY),e.line?i(e):(this.stopPlayingVariation(),n(e)),this.setState({clicked:!0}),setTimeout(()=>this.setState({clicked:!1}),200)}handleVertexMouseMove(e,t){let{drawLineMode:n,onVertexMouseMove:i=h.noop}=this.props;if(i(Object.assign(e,{mouseDown:this.mouseDown,startVertex:this.startVertex,vertex:t})),n&&e.mouseDown&&0===e.button){let t={v1:e.startVertex,v2:e.vertex};h.equals(t,this.state.temporaryLine)||this.setState({temporaryLine:t})}}handleVertexMouseEnter(e,t){if(null==this.props.analysis)return;let{sign:n,variation:i}=this.props.analysis.find(e=>h.vertexEquals(e.vertex,t))||{};null!=i&&this.playVariation(n,i)}handleVertexMouseLeave(e,t){this.stopPlayingVariation()}playVariation(e,t,n=!1){c.get("board.variation_instant_replay")?(this.variationIntervalId=!0,this.setState({variation:t,variationSign:e,variationSibling:n,variationIndex:t.length})):(clearInterval(this.variationIntervalId),this.variationIntervalId=setInterval(()=>{this.setState(({variationIndex:i=-1})=>({variation:t,variationSign:e,variationSibling:n,variationIndex:i+1}))},c.get("board.variation_replay_interval")))}stopPlayingVariation(){null!=this.variationIntervalId&&(clearInterval(this.variationIntervalId),this.variationIntervalId=null,this.setState({variation:null,variationIndex:-1}))}render({gameTree:e,treePosition:t,board:n,paintMap:r,analysis:l,highlightVertices:c=[],dimmedStones:d=[],crosshair:p=!1,showCoordinates:f=!1,showMoveColorization:m=!0,showMoveNumbers:g=!1,showNextMoves:y=!0,showSiblings:v=!0,fuzzyStonePlacement:b=!0,animateStonePlacement:w=!0,drawLineMode:x=null},{top:k=0,left:C=0,maxWidth:_=1,maxHeight:S=1,clicked:M=!1,temporaryLine:T=null,variation:P=null,variationSign:A=1,variationSibling:D=!1,variationIndex:I=-1}){let E=n.arrangement,N=n.markers,B=!!x&&!!T,O=n.lines.filter(({v1:e,v2:t,type:n})=>!B||!h.equals([e,t],[T.v1,T.v2])&&("arrow"===n&&"line"!==x||!h.equals([t,e],[T.v1,T.v2]))||(B=!1,!1));B&&O.push({v1:T.v1,v2:T.v2,type:x});let L=null;if(y||v){if(L=n.arrangement.map(e=>e.map(e=>null)),v)for(let e in n.siblingsInfo){let[t,i]=e.split(",").map(e=>+e),{sign:r}=n.siblingsInfo[e];L[i][t]={sign:r,faint:y}}if(y)for(let e in n.childrenInfo){let[t,i]=e.split(",").map(e=>+e),{sign:r,type:o}=n.childrenInfo[e];L[i][t]={sign:r,type:m?o:null}}}if(g){N=N.map(e=>e.map(e=>null));let n=[...e.listNodesVertically(t,-1,{})].reverse();for(let e=0;e<n.length;e++){let t=n[e],i=[-1,-1];null!=t.data.B?i=s.parseVertex(t.data.B[0]):null!=t.data.W&&(i=s.parseVertex(t.data.W[0]));let[r,o]=i;null!=N[o]&&r<N[o].length&&(N[o][r]={type:"label",label:e.toString()})}}let R=!0;if(null!=P){if(N=n.markers.map(e=>[...e]),D){let i=e.navigate(t,-1,{});null!=i&&(E=(n=u.getBoard(e,i.id)).arrangement)}R=!1,E=P.slice(0,I+1).reduce((e,[t,n],i)=>(N[n][t]={type:"label",label:(i+1).toString()},e.makeMove(i%2==0?A:-A,[t,n])),n).arrangement}let z=null;if(R&&null!=l){let e=Math.max(...l.map(e=>e.visits*e.win));z=n.arrangement.map(e=>e.map(e=>null));for(let{vertex:[t,n],visits:i,win:r}of l){let o=Math.round(i*r*8/e)+1;r=o<=3?Math.round(r):Math.round(10*r)/10,z[n][t]={strength:o,text:i<10?"":[r+(Math.floor(r)===r?"%":""),i<1e3?i:Math.round(i/100)/10+"k"].join("\n")}}}return i(a,{id:"goban",class:o({crosshair:p}),style:{top:k,left:C},innerProps:{ref:e=>this.element=e},maxWidth:_,maxHeight:S,showCoordinates:f,fuzzyStonePlacement:b,animateStonePlacement:M&&w,signMap:E,markerMap:N,ghostStoneMap:L,paintMap:r,heatMap:z,lines:O,selectedVertices:c,dimmedVertices:d,onVertexMouseUp:this.handleVertexMouseUp,onVertexMouseDown:this.handleVertexMouseDown,onVertexMouseMove:this.handleVertexMouseMove,onVertexMouseEnter:this.handleVertexMouseEnter,onVertexMouseLeave:this.handleVertexMouseLeave})}}},function(e,t,n){e.exports=(()=>{try{let e=n(!function(){var e=new Error("Cannot find module 'iconv-lite'");throw e.code="MODULE_NOT_FOUND",e}());if(null==e)throw new Error;return e}catch(e){return{encodingExists:()=>!0,decode:e=>e.toString()}}})()},function(e,t,n){e.exports=(()=>{try{let e=n(!function(){var e=new Error("Cannot find module 'jschardet'");throw e.code="MODULE_NOT_FOUND",e}());if(null==e)throw new Error;return e}catch(e){return{detect:()=>({encoding:"UTF-8"})}}})()},function(e,t,n){const i=n(10),r=n(53),{tokenizeIter:o,tokenizeBufferIter:s}=n(29),{unescapeString:a}=n(15);t.parseTokens=function(e,{getId:t=((e=0)=>()=>e++)(),dictionary:n=null,onProgress:i=(()=>{}),onNodeCreated:o=(()=>{})}={}){return function e(t,n,i){let r,o,{getId:s,dictionary:l,onProgress:u,onNodeCreated:h}=i,c=null;for(;!t.peek().done;){let{type:e,value:i,row:u,col:d}=t.peek().value;if("parenthesis"===e&&"("===i)break;if("parenthesis"===e&&")"===i)return null!=r&&h({node:r}),c;if("semicolon"===e){let e=r;r={id:s(),data:{},parentId:null==e?n:e.id,children:[]},null!=l&&(l[r.id]=r),null!=e?(h({node:e}),e.children.push(r)):c=r}else if("prop_ident"===e){if(null!=r){let e=i===i.toUpperCase()?i:i.split("").filter(e=>e.toUpperCase()===e).join("");""!==e?(e in r.data||(r.data[e]=[]),o=r.data[e]):o=null}}else{if("c_value_type"!==e)throw new Error(`Unexpected token type '${e}' at ${u+1}:${d+1}`);null!=o&&o.push(a(i.slice(1,-1)))}t.next()}for(null==r?c=r={id:null,data:{},parentId:null,children:[]}:h({node:r});!t.peek().done;){let{type:n,value:o,progress:s}=t.peek().value;if("parenthesis"===n&&"("===o){t.next();let n=e(t,r.id,i);null!=n&&r.children.push(n)}else if("parenthesis"===n&&")"===o){u({progress:s});break}t.next()}return c}(new r(e),null,{getId:t,dictionary:n,onProgress:i,onNodeCreated:o}).children},t.parse=function(e,n={}){return t.parseTokens(o(e),n)},t.parseBuffer=function(e,n={}){return t.parseTokens(s(e,{encoding:n.encoding}),n)},t.parseFile=function(e,n={}){return t.parseBuffer(i.readFileSync(e),n)}},function(e,t){e.exports=class{constructor(e){this.iterator=e[Symbol.iterator](),this.peeked=null}next(){let e=null!=this.peeked?this.peeked:this.iterator.next();return this.peeked=null,e}peek(){return null==this.peeked&&(this.peeked=this.iterator.next()),this.peeked}}},function(e,t,n){const{escapeString:i}=n(15);t.stringify=function(e,{linebreak:n="\n",level:r=0}={}){if(Array.isArray(e))return t.stringify({children:e},{linebreak:n,level:r});let o=[],s=""!==n?"  ".repeat(r):"";if(null!=e.data){o.push(s,";");for(let t in e.data)t.toUpperCase()===t&&o.push(t,"[",e.data[t].map(i).join("]["),"]");o.push(n)}if(e.children.length>1||e.children.length>0&&0===r){o.push(s);for(let i of e.children)o.push("(",n,t.stringify(i,{linebreak:n,level:r+1}),s,")");o.push(n)}else 1===e.children.length&&o.push(t.stringify(e.children[0],{linebreak:n,level:r}));return o.join("")}},function(e,t,n){const i=n(30),r=n(60);e.exports={Goban:i,BoundedGoban:r}},function(e,t,n){const{createElement:i,Component:r}=n(0),{alpha:o}=n(16);e.exports={CoordX:class extends r{render(){let{style:e,xs:t,coordX:n=(e=>o[e]||o[o.length-1])}=this.props;return i("div",{className:"shudan-coordx",style:Object.assign({display:"flex",textAlign:"center"},e)},t.map(e=>i("div",{key:e,style:{width:"1em"}},i("span",{style:{display:"block"}},n(e)))))}},CoordY:class extends r{render(){let{style:e,height:t,ys:n,coordY:r=(e=>t-e)}=this.props;return i("div",{className:"shudan-coordy",style:Object.assign({textAlign:"center"},e)},n.map(e=>i("div",{key:e,style:{height:"1em"}},i("span",{style:{display:"block"}},r(e)))))}}}},function(e,t,n){const{createElement:i,Component:r}=n(0);e.exports=class extends r{shouldComponentUpdate(e){return e.vertexSize!==this.props.vertexSize||e.width!==this.props.width||e.height!==this.props.height||e.xs.length!==this.props.xs.length||e.ys.length!==this.props.ys.length||e.xs[0]!==this.props.xs[0]||e.ys[0]!==this.props.ys[0]}render(){let{vertexSize:e,width:t,height:n,xs:r,ys:o,hoshis:s}=this.props,a=e/2,l=Math.floor;return r.length>0&&o.length>0&&i("svg",{className:"shudan-grid",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:0}},o.map((n,o)=>{let s=0===r[0]?a:0;return i("rect",{key:`h${o}`,className:"shudan-gridline shudan-horizontal",x:l(s),y:l((2*o+1)*a),width:r[r.length-1]===t-1?l((2*r.length-1)*a-s):l(r.length*e-s),height:1})}),r.map((t,r)=>{let s=0===o[0]?a:0;return i("rect",{key:`v${r}`,className:"shudan-gridline shudan-vertical",x:l((2*r+1)*a),y:l(s),width:1,height:o[o.length-1]===n-1?l((2*o.length-1)*a-s):l(o.length*e-s)})}),s.map(([e,t])=>{let n=r.indexOf(e),s=o.indexOf(t);if(!(n<0||s<0))return i("circle",{key:[e,t].join("-"),className:"shudan-hoshi",cx:l((2*n+1)*a)+.5,cy:l((2*s+1)*a)+.5,r:".1em"})}))}}},function(e,t,n){const{createElement:i,Component:r}=n(0),o=n(2),{vertexEvents:s}=n(16),a=e=>({position:"absolute",zIndex:e});e.exports=class extends r{constructor(e){super(e);for(let e of s)this[`handle${e}`]=(t=>{(this.props[`on${e}`]||(()=>{}))(t,this.props.position)})}render(){let{position:e,shift:t,random:n,sign:r,selected:l,heat:u,paint:h,dimmed:c,marker:d,ghostStone:p,animate:f}=this.props,m=e=>!!d&&i("div",{key:"marker",className:"shudan-marker",title:d.label,style:a(e)});return i("div",Object.assign({"data-x":e[0],"data-y":e[1],style:{position:"relative"},className:o("shudan-vertex",`shudan-random_${n}`,`shudan-sign_${r}`,{[`shudan-shift_${t}`]:!!t,[`shudan-heat_${!!u&&u.strength}`]:!!u,[`shudan-paint_${h}`]:!!h,"shudan-dimmed":c,"shudan-selected":l,"shudan-animate":f},d&&d.type&&`shudan-marker_${d.type}`,d&&"label"===d.type&&d.label&&(d.label.includes("\n")||d.label.length>=3)&&"shudan-smalllabel",p&&`shudan-ghost_${p.sign}`,p&&p.type&&`shudan-ghost_${p.type}`,p&&p.faint&&"shudan-ghost_faint")},...s.map(e=>({[`on${e}`]:this[`handle${e}`]}))),!r&&m(0),!r&&!!p&&i("div",{key:"ghost",className:"shudan-ghost",style:a(1)}),i("div",{key:"stone",className:"shudan-stone",style:a(2)},!!r&&i("div",{key:"shadow",className:"shudan-shadow",style:a()}),!!r&&i("div",{key:"inner",className:o("shudan-inner","shudan-stone-image",`shudan-random_${n}`,`shudan-sign_${r}`),style:a()},r),!!r&&m()),!!h&&i("div",{key:"paint",className:"shudan-paint",style:a(3)}),!!l&&i("div",{key:"selection",className:"shudan-selection",style:a(4)}),i("div",{key:"heat",className:"shudan-heat",style:a(5)}),!!u&&i("div",{key:"heatlabel",className:"shudan-heatlabel",style:a(6)},u.text&&u.text.toString()))}}},function(e,t,n){const{createElement:i,Component:r}=n(0),{vertexEquals:o}=n(16);e.exports=class extends r{shouldComponentUpdate(e){let{v1:t,v2:n,type:i,vertexSize:r}=this.props;return i!==e.type||r!==e.vertexSize||!o(t,e.v1)||!o(n,e.v2)}render(){let{v1:e,v2:t,type:n="line",vertexSize:r}=this.props;if(o(e,t))return;let[s,a]=[e,t].map(e=>e.map(e=>e*r)),[l,u]=s.map((e,t)=>a[t]-e),[h,c]=s.map((e,t)=>(e+a[t]+r)/2),d=180*Math.atan2(u,l)/Math.PI,p=Math.sqrt(l*l+u*u);return i("div",{className:`shudan-${n}`,style:{position:"absolute",left:h,top:c,margin:0,width:p,transform:`translateX(${-p/2}px) rotate(${d}deg)`}})}}},function(e,t,n){const{createElement:i,Component:r}=n(0),o=n(30);e.exports=class extends r{constructor(e){super(e),this.state={vertexSize:1,visibility:"hidden"}}componentDidMount(){this.componentDidUpdate()}componentDidUpdate(e){let{showCoordinates:t,maxWidth:n,maxHeight:i,rangeX:r,rangeY:o,signMap:s,onResized:a=(()=>{})}=this.props;if("visible"!==this.state.visibility||t!==e.showCoordinates||n!==e.maxWidth||i!==e.maxHeight||JSON.stringify(r)!==JSON.stringify(e.rangeX)||JSON.stringify(o)!==JSON.stringify(e.rangeY)||s.length!==e.signMap.length||(s[0]||[]).length!==(e.signMap[0]||[]).length){let{offsetWidth:e,offsetHeight:t}=this.element,r=Math.min(n/e,i/t),o=Math.max(Math.floor(this.state.vertexSize*r),1);this.state.vertexSize!==o&&this.setState({vertexSize:o},a),"visible"!==this.state.visibility&&this.setState({visibility:"visible"})}}render(){let{innerProps:e={},style:t={}}=this.props,{ref:n=(()=>{})}=e;return i(o,Object.assign({},this.props,{innerProps:Object.assign({},e,{ref:e=>(n(e),this.element=e)}),style:Object.assign({visibility:this.state.visibility},t),vertexSize:this.state.vertexSize}))}}},function(e,t,n){const i=n(62);class r{constructor({getId:e=null,merger:t=null,root:n=null}={}){this.getId=e||(()=>{let e=0;return()=>e++})(),this.merger=t||(()=>null),this.root=n||{id:this.getId(),data:{},parentId:null,children:[]},this._nodeCache={},this._idAliases={},this._heightCache=null,this._structureHashCache=null}get(e){let t=null;if(null==e)return t;if(e in this._idAliases)return this.get(this._idAliases[e]);if(e in this._nodeCache)t=this._nodeCache[e];else{let n=t=>{if(this._nodeCache[t.id]=t,t.id===e)return t;for(let e of t.children){let t=n(e);if(null!=t)return t}return null};t=n(this.root)}if(null==t)return this._nodeCache[e]=null,null;for(let e of t.children)this._nodeCache[e.id]=e;return t}*getSequence(e){let t=this.get(e);null!=t&&(yield t,1===t.children.length&&(yield*this.getSequence(t.children[0].id)))}mutate(e){let t=new i(this);if(e(t),t.root===this.root)return this;let n=new r({getId:this.getId,merger:this.merger,root:t.root});return t._passOnNodeCache&&(n._nodeCache=t._nodeCache),n._idAliases=t._idAliases,n._structureHashCache=t._structureHashCache,n._heightCache=t._heightCache,n}navigate(e,t,n){let i=this.get(e);if(null==i)return null;if(0===t)return i;if(t<0)return this.navigate(i.parentId,t+1);let r=null!=n[i.id]?n[i.id]:i.children.length>0?i.children[0].id:null;return null==r?null:this.navigate(r,t-1,n)}*listNodes(){yield*function*e(t){yield t;for(let n of t.children)yield*e(n)}(this.root)}*listNodesHorizontally(e,t){if(1!==Math.abs(t))throw new Error("Invalid value for step, only -1 or 1 allowed");let n=this.getLevel(e),i=[...this.getSection(n)],r=i.findIndex(t=>t.id===e);for(;null!=i[r];){for(;0<=r&&r<i.length;)yield i[r],r+=t;n+=t,i=t>0?[].concat(...i.map(e=>e.children)):[...this.getSection(n)],r=t>0?0:i.length-1}}*listNodesVertically(e,t,n){if(1!==Math.abs(t))throw new Error("Invalid value for step, only -1 or 1 allowed");let i=e,r=this.get(i);for(;null!=r;)yield r,r=this.navigate(r.id,t,n)}*listCurrentNodes(e){yield*this.listNodesVertically(this.root.id,1,e)}*listMainNodes(){yield*this.listCurrentNodes({})}getLevel(e){if(e===this.root.id)return 0;let t=this.get(e);return null==t?null:this.getLevel(t.parentId)+1}*getSection(e){if(!(e<0))if(0!==e)for(let t of this.getSection(e-1))yield*t.children;else yield this.root}getCurrentHeight(e){let t=n=>{if(null==n)return 0;let i=null==e[n.id]?n.children[0]:n.children.find(t=>t.id===e[n.id]);return 1+t(i)};return t(this.root)}getHeight(){if(null==this._heightCache){let e=t=>1+Math.max(...t.children.map(e),0);this._heightCache=e(this.root)}return this._heightCache}getStructureHash(){if(null==this._structureHashCache){let e=(()=>{let e=5381;return t=>{for(let n=0;n<t.length;n++)e=33*e^t.charCodeAt(n);return e}})(),t=n=>(e("["+JSON.stringify(n.id)+","),n.children.forEach(t),e("]"));this._structureHashCache=t(this.root)}return(this._structureHashCache>>>0)+""}onCurrentLine(e,t){let n=this.get(e),{parentId:i}=n;return null==i||(n.id===t[i]||null==t[i]&&this.get(i).children[0]===n)&&this.onCurrentLine(i,t)}onMainLine(e){return this.onCurrentLine(e,{})}toJSON(){return this.root}}e.exports=r},function(e,t){e.exports=class{constructor(e){this.base=e,this.root=e.root,this._passOnNodeCache=!0,this._nodeCache={},this._idAliases=e._idAliases,this._heightCache=e._heightCache,this._structureHashCache=e._structureHashCache}get(e){if(null==e)return null;if(e in this._idAliases)return this.get(this._idAliases[e]);if(e in this._nodeCache)return this._nodeCache[e];let t=this.base.get(e);if(null==t)return this._nodeCache[e]=null,null;let n=Object.assign({},t,{data:Object.assign({},t.data),children:[...t.children]});if(null!=t.parentId){let i=this.get(t.parentId),r=i.children.findIndex(t=>t.id===e);r>=0&&(i.children[r]=n)}return this._nodeCache[e]=n,this.root.id===e&&(this.root=n),n}_getLevel(e){let t=-1,n=this.get(e);for(;null!=n;)t++,n=this.get(n.parentId);return t}appendNode(e,t){let n=this.base.getId();if(!this.UNSAFE_appendNodeWithId(e,n,t))return null;if(!(n in this._idAliases))return n;let i=this._idAliases[n];return delete this._idAliases[n],i}UNSAFE_appendNodeWithId(e,t,n){let i=this.get(e);if(null==i)return!1;let[r,o]=(()=>{for(let e of i.children){let t=this.base.merger(e,n);if(null!=t)return[e.id,t]}return[null,null]})();if(null!=r)this.get(r).data=o,t!==r&&(this._idAliases[t]=r);else{let r={id:t,data:n,parentId:e,children:[]};i.children.push(r),this._nodeCache[t]=r,this._structureHashCache=null,null!=this._heightCache&&this._getLevel(e)===this._heightCache-1&&this._heightCache++}return!0}removeNode(e){let t=this.get(e);if(null==t)return!1;let n=t.parentId;if(null==n)throw new Error("Cannot remove root node");let i=this.get(n);if(null==i)return!1;let r=i.children.findIndex(t=>t.id===e);return r>=0&&(i.children.splice(r,1),this._nodeCache[e]=null,this._structureHashCache=null,null!=this._heightCache&&this._getLevel(e)===this._heightCache-1&&(this._heightCache=null),!0)}shiftNode(e,t){if(!["left","right","main"].includes(t))throw new Error("Invalid value for direction, only 'left', 'right', or 'main' allowed");let n=this.get(e);if(null==n)return null;let{parentId:i}=n,r=this.get(i);if(null==r)return null;let o=r.children.findIndex(t=>t.id===e);if(o<0)return null;let s="left"===t?Math.max(o-1,0):"right"===t?Math.min(o+1,r.children.length):0;if(o!==s){let[e]=r.children.splice(o,1);r.children.splice(s,0,e)}return this._structureHashCache=null,s}makeRoot(e){if(e===this.root.id)return!0;let t=this.get(e);return null!=t&&(t.parentId=null,this.root=t,this._passOnNodeCache=!1,this._heightCache=null,this._structureHashCache=null,!0)}addToProperty(e,t,n){let i=this.get(e);return null!=i&&(null==i.data[t]?i.data[t]=[n]:i.data[t].includes(n)||(i.data[t]=[...i.data[t],n]),!0)}removeFromProperty(e,t,n){let i=this.get(e);return null!=i&&null!=i.data[t]&&(i.data[t]=i.data[t].filter(e=>e!==n),0===i.data[t].length&&delete i.data[t],!0)}updateProperty(e,t,n){let i=this.get(e);return null!=i&&(null==n||0===n.length?delete i.data[t]:i.data[t]=n,!0)}removeProperty(e,t){return this.updateProperty(e,t,null)}}},function(e,t,n){const{shell:i,clipboard:r}=n(4),{h:o,Component:s}=n(0),a=n(2),{remote:l}=n(4),u=n(7),h=n(3).context("PlayBar"),c=n(1),d=l.require("./setting");let p=e=>d.set(e,!d.get(e));e.exports=class extends s{constructor(){super(),this.handleCurrentPlayerClick=(()=>this.props.onCurrentPlayerClick),this.handleMenuClick=(()=>{let{left:e,top:t}=this.menuButtonElement.getBoundingClientRect();c.popupMenu([{label:h(e=>`About ${e.appName}…`,{appName:sabaki.appName}),click:()=>i.openExternal("http://sabaki.yichuanshen.de")},{type:"separator"},{label:h("New File"),click:()=>sabaki.newFile({playSound:!0,showInfo:!0})},{label:h("Open File…"),click:()=>sabaki.loadFile()},{label:h("Download SGF"),click:()=>sabaki.saveFile(sabaki.state.representedFilename)},{label:h("Load SGF from Clipboard"),click:()=>{let e=r.readText();null!=e&&sabaki.loadContent(e,"sgf",{ignoreEncoding:!0})}},{label:h("Copy SGF to Clipboard"),click:()=>r.writeText(sabaki.getSGF())},{type:"separator"},{label:h("Show &Coordinates"),checked:d.get("view.show_coordinates"),click:()=>p("view.show_coordinates")},{label:h("Show Move Colori&zation"),checked:d.get("view.show_move_colorization"),click:()=>p("view.show_move_colorization")},{label:h("Show &Next Moves"),checked:d.get("view.show_next_moves"),click:()=>p("view.show_next_moves")},{label:h("Show &Sibling Variations"),checked:d.get("view.show_siblings"),click:()=>p("view.show_siblings")},{label:h("&Manage Games…"),click:()=>sabaki.openDrawer("gamechooser")},{type:"separator"},{label:h("&Pass"),click:()=>{let e=d.get("gtp.auto_genmove");sabaki.makeMove([-1,-1],{sendToEngine:e})}},{label:h("&Resign"),click:()=>sabaki.makeResign()},{type:"separator"},{label:h("Es&timate"),click:()=>sabaki.setMode("estimator")},{label:h("&Score"),click:()=>sabaki.setMode("scoring")},{label:h("&Edit"),click:()=>sabaki.setMode("edit")},{label:h("&Find"),click:()=>sabaki.setMode("find")},{type:"separator"},{label:h("&Info"),click:()=>sabaki.openDrawer("info")}],e,t)})}shouldComponentUpdate(e){return e.mode!==this.props.mode||"play"===e.mode}render({mode:e,attachedEngines:t,playerBusy:n,playerNames:i,playerRanks:r,playerCaptures:s,currentPlayer:l,showHotspot:d,onCurrentPlayerClick:p=c.noop}){let f=e=>({opacity:0===s[e]?0:.7}),m=Array(t.length).fill(!1);return t.forEach((e,t)=>{null!=e&&(i[t]=e.name,r[t]=null,m[t]=!0)}),o("header",{class:a({hotspot:d,current:"play"===e})},o("span",{id:"player_1"},o("span",{class:"captures",style:f(0)},s[0])," ",r[0]&&o("span",{class:"rank"},h(e=>e.playerRank,{playerRank:r[0]}))," ",o("span",{class:a("name",{engine:m[0]}),title:m[0]&&h("Engine")},m[0]&&n[0]&&o(u)," ",i[0]||h("Black"))),o("span",{id:"player_-1"},o("span",{class:a("name",{engine:m[1]}),title:m[1]&&h("Engine")},i[1]||h("White")," ",m[1]&&n[1]&&o(u))," ",r[1]&&o("span",{class:"rank"},h(e=>e.playerRank,{playerRank:r[1]}))," ",o("span",{class:"captures",style:f(1)},s[1])),o("img",{src:`./img/ui/player_${l}.svg`,class:"current-player",height:22,title:h("Change Player"),onClick:p}),o("div",{class:"hotspot",title:h("Hotspot")}),o("a",{ref:e=>this.menuButtonElement=e,id:"headermenu",onClick:this.handleMenuClick},o("img",{src:"/static/node_modules/octicons/build/svg/three-bars.svg",height:21})))}}},function(e,t){t.load=(e=>{let t={},n={strings:e,usedStrings:t,load(i){n.usedStrings=t={},n.strings=e=i},t:(e,t,i={})=>n.context(e)(t,i),context:n=>(i,r={})=>{e[n]||(e[n]={}),t[n]||(t[n]={});let o="function"!=typeof i?i:i(Object.keys(r).reduce((e,t)=>(e[t]=`\${${t}}`,e),{})),s=e[n][o]||i;return t[n][o]=s,e[n][o]=e[n][o]?s:null,"function"!=typeof s?s:s(r)},serialize(n="  "){let i=0,r=0,o=(e,s=[])=>e?"function"==typeof e?(i++,e.toString()):"object"!=typeof e?(i++,JSON.stringify(`${e}`)):["{",Object.keys(e).sort().map(i=>{let r=o(e[i],[...s,i]).split("\n"),a=!(s.reduce((e,t)=>e&&e[t],t)||{})[i],l=Math.min(...r.map((e,t)=>0===t?1/0:e.match(/^\s*/)[0].length)),u=r.map((e,t)=>0===t?e:`${n}${e.slice(l)}`).join("\n");return`${n}${a?"/* unused */ ":""}${JSON.stringify(i)}: ${u},`}).join("\n"),"}"].join("\n"):(r++,"null"),s=o(e);return{translatedCount:i,untranslatedCount:r,complete:r+i===0?0:i/(r+i),js:s}}};return n})},function(e,t,n){const{h:i,Component:r}=n(0),o=n(2),s=n(20),a=n(1),l=n(3).context("EditBar");e.exports=class extends r{constructor(){super(),this.state={stoneTool:1},this.handleToolButtonClick=this.handleToolButtonClick.bind(this)}componentWillReceiveProps({selectedTool:e}){e!==this.props.selectedTool&&0===e.indexOf("stone")&&this.setState({stoneTool:+e.replace("stone_","")})}shouldComponentUpdate(e){return e.mode!==this.props.mode||"edit"===e.mode}handleToolButtonClick(e){let{selectedTool:t,onToolButtonClick:n=a.noop}=this.props;e.tool=e.currentTarget.dataset.id,0===e.tool.indexOf("stone")&&0===t.indexOf("stone")&&(e.tool=`stone_${-this.state.stoneTool}`,this.setState(({stoneTool:e})=>({stoneTool:-e}))),n(e)}renderButton(e,t,n=!1){return i("li",{class:o({selected:n})},i("a",{title:e,href:"#","data-id":t,onClick:this.handleToolButtonClick},i("img",{src:`/static/img/edit/${t}.svg`})))}render({selectedTool:e},{stoneTool:t}){return i(s,Object.assign({type:"edit"},this.props),i("ul",{},[[l("Stone Tool"),`stone_${t}`],[l("Cross Tool"),"cross"],[l("Triangle Tool"),"triangle"],[l("Square Tool"),"square"],[l("Circle Tool"),"circle"],[l("Line Tool"),"line"],[l("Arrow Tool"),"arrow"],[l("Label Tool"),"label"],[l("Number Tool"),"number"]].map(t=>this.renderButton(...t,(([,t])=>t.replace(/_-?1$/,"")===e.replace(/_-?1$/,""))(t)))))}}},function(e,t,n){const{h:i,Component:r}=n(0),o=n(20),s=n(3).context("ScoringBar");e.exports=class extends r{constructor(){super(),this.handleButtonClick=(()=>sabaki.openDrawer("score"))}render({type:e,method:t,areaMap:n,scoreBoard:r,komi:a,handicap:l}){let u=r&&r.getScore(n,{komi:a,handicap:l}),h=u&&("area"===t?u.areaScore:u.territoryScore);return i(o,Object.assign({type:e},this.props),i("div",{class:"result"},i("button",{onClick:this.handleButtonClick},s("Details")),i("strong",{},h?h>0?s(e=>`B+${e.result}`,{result:h}):h<0?s(e=>`W+${e.result}`,{result:-h}):s("Draw"):""))," ",s("scoring"===e?"Please select dead stones.":"Toggle group status."))}}},function(e,t,n){const{h:i,Component:r}=n(0),o=n(20),s=n(1),a=n(3).context("FindBar");e.exports=class extends r{constructor(){super(),this.handleChange=(e=>{sabaki.setState({findText:e.currentTarget.value})}),this.handleButtonClick=(e=>{e.preventDefault();let t=e.currentTarget.classList.contains("next")?1:-1,{onButtonClick:n=s.noop}=this.props;e.step=t,n(e)})}componentDidUpdate(e){e.mode!==this.props.mode&&("find"===this.props.mode?this.inputElement.focus():this.inputElement.blur())}render({findText:e}){return i(o,Object.assign({type:"find"},this.props),i("form",{},i("input",{ref:e=>this.inputElement=e,type:"text",placeholder:a("Find"),value:e,onInput:this.handleChange}),i("button",{class:"next",onClick:this.handleButtonClick},i("img",{src:"/static/node_modules/octicons/build/svg/chevron-down.svg",height:20,alt:a("Next")})),i("button",{class:"prev",onClick:this.handleButtonClick},i("img",{src:"/static/node_modules/octicons/build/svg/chevron-up.svg",height:20,alt:a("Previous")}))))}}},function(e,t,n){const{remote:i}=n(4),{h:r,Component:o}=n(0),s=n(2),a=i.require("./setting"),l=n(69),u=n(70),h=n(71),c=n(72);let d=a.get("view.sidebar_minwidth"),p=a.get("view.properties_minheight");e.exports=class extends o{constructor(e){super(e),this.state={sidebarSplit:a.get("view.properties_height"),sidebarSplitTransition:!0},this.handleGraphNodeClick=(({button:e,gameTree:t,treePosition:n,x:i,y:r})=>{0===e?sabaki.setCurrentTreePosition(t,n):sabaki.openNodeMenu(t,n,{x:i,y:r})}),this.handleVerticalResizerMouseDown=(({button:e,x:t,y:n})=>{0===e&&(this.oldSidebarWidth=this.props.sidebarWidth,this.oldMousePosition=[t,n],this.verticalResizerMouseDown=!0)}),this.handleHorizontalResizerMouseDown=(({button:e})=>{0===e&&(this.horizontalResizerMouseDown=!0)}),this.handleSliderChange=(({percent:e})=>{let t=Math.round((this.props.gameTree.getHeight()-1)*e);sabaki.goToMoveNumber(t)}),this.handleWinrateGraphChange=(({index:e})=>{sabaki.goToMoveNumber(e)}),this.handleStartAutoscrolling=(({step:e})=>{sabaki.startAutoscrolling(e)}),this.handleStopAutoscrolling=(()=>{sabaki.stopAutoscrolling()}),this.handleCommentInput=(e=>{sabaki.setComment(this.props.gameTree,this.props.treePosition,e)}),this.componentWillReceiveProps(e)}shouldComponentUpdate(e){return e.showSidebar!=this.props.showSidebar||e.showSidebar}componentDidMount(){document.addEventListener("mouseup",()=>{(this.verticalResizerMouseDown||this.horizontalResizerMouseDown)&&(this.verticalResizerMouseDown=!1,this.horizontalResizerMouseDown=!1,a.set("view.properties_height",this.state.sidebarSplit),a.set("view.sidebar_width",this.props.sidebarWidth),this.setState({sidebarSplitTransition:!1}),window.dispatchEvent(new Event("resize")))}),document.addEventListener("mousemove",e=>{if(this.verticalResizerMouseDown){e.preventDefault();let{sidebarWidth:t}=this.props,n=[e.clientX,e.clientY].map((e,t)=>e-this.oldMousePosition[t]);t=Math.max(d,this.oldSidebarWidth-n[0]),sabaki.setSidebarWidth(t)}else if(this.horizontalResizerMouseDown){e.preventDefault();let{top:t,height:n}=this.horizontalSplitContainer.getBoundingClientRect(),i=Math.min(100-p,Math.max(p,100-100*(e.clientY-t)/n));this.setState({sidebarSplit:i,sidebarSplitTransition:!1})}})}componentWillReceiveProps({gameTree:e,gameCurrents:t,gameIndex:n}={}){let i=[...e.listCurrentNodes(t[n])].map(e=>e.data.SBKV&&e.data.SBKV[0]);this.setState({winrateData:i})}componentDidUpdate(e,{winrateData:t}){t.some(e=>null!=e)!==this.state.winrateData.some(e=>null!=e)&&this.gameGraph.remeasure()}render({mode:e,gameIndex:t,gameTree:n,gameCurrents:i,treePosition:o,showGameGraph:a,showCommentBox:d,sidebarWidth:p,graphGridSize:f,graphNodeSize:m},{winrateData:g,sidebarSplit:y,sidebarSplitTransition:v}){let b=n.get(o),w=Math.max(50*Math.ceil((n.getHeight()-1)/50),1),x=n.getLevel(o),k=g.some(e=>null!=e);return r("section",{ref:e=>this.element=e,id:"sidebar",class:s({showwinrate:k}),style:{width:p}},r("div",{class:"verticalresizer",onMouseDown:this.handleVerticalResizerMouseDown}),r(l,{width:w,data:g,currentIndex:x,onCurrentIndexChange:this.handleWinrateGraphChange}),r("div",{ref:e=>this.horizontalSplitContainer=e,class:"graphproperties"},r(u,{showSlider:a,text:x,percent:x/(n.getHeight()-1)*100,height:a?d?100-y:100:0,onChange:this.handleSliderChange,onStartAutoscrolling:this.handleStartAutoscrolling,onStopAutoscrolling:this.handleStopAutoscrolling}),r(h,{ref:e=>this.gameGraph=e,gameTree:n,gameCurrents:i[t],treePosition:o,showGameGraph:a,height:a?d?100-y:100:0,gridSize:f,nodeSize:m,onNodeClick:this.handleGraphNodeClick}),r(c,{mode:e,gameTree:n,treePosition:o,showCommentBox:d,moveAnnotation:null!=b.data.BM?[-1,b.data.BM[0]]:null!=b.data.DO?[0,1]:null!=b.data.IT?[1,1]:null!=b.data.TE?[2,b.data.TE[0]]:[null,1],positionAnnotation:null!=b.data.UC?[-2,b.data.UC[0]]:null!=b.data.GW?[-1,b.data.GW[0]]:null!=b.data.DM?[0,b.data.DM[0]]:null!=b.data.GB?[1,b.data.GB[0]]:[null,1],title:null!=b.data.N?b.data.N[0]:"",comment:null!=b.data.C?b.data.C[0]:"",height:d?a?y:100:0,sidebarSplitTransition:v,onResizerMouseDown:this.handleHorizontalResizerMouseDown,onCommentInput:this.handleCommentInput})))}}},function(e,t,n){const{remote:i}=n(4),{h:r,Component:o}=n(0);n(1),n(3).context("WinrateGraph");i.require("./setting").get("view.winrategraph_minheight");e.exports=class extends o{constructor(){super()}shouldComponentUpdate({width:e,currentIndex:t,data:n}){}componentDidMount(){}render({width:e,currentIndex:t,data:n}){return r("section",{ref:e=>this.element=e,id:"winrategraph",style:{height:0},onMouseDown:this.handleMouseDown})}}},function(e,t,n){const{remote:i}=n(4),{h:r,Component:o}=n(0),s=n(1),a=i.require("./setting");e.exports=class extends o{constructor(){super(),this.handleSliderAreaMouseDown=(e=>{0===e.button&&(this.sliderAreaMouseDown=!0,document.dispatchEvent(new MouseEvent("mousemove",e)))}),this.handleButtonMouseDown=(e=>{if(0!==e.button)return;let t=e.currentTarget.className,{onStartAutoscrolling:n=s.noop}=this.props;this.buttonMouseDown=t,n({step:"prev"===t?-1:1})})}componentDidMount(){document.addEventListener("mouseup",()=>{if(this.sliderAreaMouseDown=!1,null!=this.buttonMouseDown){let e=this.buttonMouseDown,{onStopAutoscrolling:t=s.noop}=this.props;this.buttonMouseDown=null,t({step:"prev"===e?-1:1})}}),document.addEventListener("mousemove",e=>{if(!this.sliderAreaMouseDown)return;let{onChange:t=s.noop}=this.props,{top:n,height:i}=this.slidingAreaElement.getBoundingClientRect();t({percent:Math.min(1,Math.max(0,(e.clientY-n)/i))})})}shouldComponentUpdate({showSlider:e,height:t}){return e&&(t!==this.props.height||this.sliderAreaMouseDown||this.buttonMouseDown||!this.dirty)}componentWillReceiveProps(){this.dirty=!0,clearTimeout(this.renderId),this.renderId=setTimeout(()=>{this.dirty=!1,this.setState(this.state)},a.get("graph.delay"))}render({height:e,text:t,percent:n}){return r("section",{id:"slider",style:{height:`${e}%`}},r("a",{href:"#",class:"prev",onMouseDown:this.handleButtonMouseDown},"▲"),r("a",{href:"#",class:"next",onMouseDown:this.handleButtonMouseDown},"▼"),r("div",{ref:e=>this.slidingAreaElement=e,class:"inner",onMouseDown:this.handleSliderAreaMouseDown},r("span",{style:{top:n+"%"}},t)))}}},function(e,t,n){const{remote:i}=n(4),{h:r,Component:o}=n(0),s=n(2),a=n(6),l=n(1),u=i.require("./setting");let h=u.get("graph.delay"),c=u.get("sgf.comment_properties");class d extends o{constructor(){super(),this.state={hover:!1},this.handleMouseMove=(e=>{if(!this.element)return;let{clientX:t,clientY:n}=e,{position:i,mouseShift:[r,o],gridSize:s}=this.props,a=!1;[t+r,n+o].every((e,t)=>Math.ceil(i[t]-s/2)<=e&&e<=Math.floor(i[t]+s/2)-1)&&(a=!0),a!==this.state.hover&&this.setState({hover:a})})}componentDidMount(){document.addEventListener("mousemove",this.handleMouseMove)}componentWillUnmount(){document.removeEventListener("mousemove",this.handleMouseMove)}shouldComponentUpdate({type:e,current:t,fill:n,nodeSize:i,gridSize:r},{hover:o}){return e!==this.props.type||t!==this.props.current||n!==this.props.fill||i!==this.props.nodeSize||r!==this.props.gridSize||o!==this.state.hover}render({position:[e,t],type:n,current:i,fill:o,nodeSize:a},{hover:l}){return r("path",{ref:e=>this.element=e,d:(()=>{let i=2*a;if("square"===n)return`M ${e-a} ${t-a}\n                        h ${i} v ${i} h ${-i} Z`;if("circle"===n)return`M ${e} ${t} m ${-a} 0\n                        a ${a} ${a} 0 1 0 ${i} 0\n                        a ${a} ${a} 0 1 0 ${-i} 0`;if("diamond"===n){let n=Math.round(Math.sqrt(2)*a);return`M ${e} ${t-n}\n                        L ${e-n} ${t} L ${e} ${t+n}\n                        L ${e+n} ${t} Z`}return"bookmark"===n?`M ${e-a} ${t-1.3*a}\n                        h ${i} v ${1.3*i}\n                        l ${-a} ${-a} l ${-a} ${a} Z`:""})(),class:s({hover:l,current:i},"node"),fill:o})}}class p extends o{shouldComponentUpdate({positionAbove:e,positionBelow:t,current:n,length:i,gridSize:r}){return i!==this.props.length||n!==this.props.current||r!==this.props.gridSize||!l.vertexEquals(e,this.props.positionAbove)||!l.vertexEquals(t,this.props.positionBelow)}render({positionAbove:[e,t],positionBelow:[n,i],length:o,gridSize:s,current:a}){let l;return r("polyline",{points:l=e===n?`${e},${t} ${e},${i+o}`:`${e},${t} ${n-s},${i-s}\n                ${n},${i} ${n},${i+o}`,fill:"none",stroke:a?"#ccc":"#777","stroke-width":a?2:1})}}e.exports=class extends o{constructor(e){super(e),this.state={cameraPosition:[-e.gridSize,-e.gridSize],viewportSize:[0,0],viewportPosition:[0,0],matrixDict:null},this.mousePosition=[-100,-100],this.matrixDictHash=null,this.matrixDictCache={},this.handleNodeClick=this.handleNodeClick.bind(this),this.handleGraphMouseDown=this.handleGraphMouseDown.bind(this)}componentDidMount(){document.addEventListener("mousemove",e=>{if(!this.svgElement)return;let{clientX:t,clientY:n,movementX:i,movementY:r}=e,{cameraPosition:[o,s],viewportPosition:[a,l]}=this.state;0===this.mouseDown?this.drag=!0:(i=r=0,this.drag=!1),this.mousePosition=[t-a,n-l],this.drag&&(e.preventDefault(),this.setState({cameraPosition:[o-i,s-r]}))}),document.addEventListener("mouseup",()=>{this.mouseDown=null}),window.addEventListener("resize",()=>{clearTimeout(this.remeasureId),this.remeasureId=setTimeout(()=>this.remeasure(),500)}),this.remeasure(),this.componentWillReceiveProps()}shouldComponentUpdate({showGameGraph:e,height:t}){return t!==this.props.height||e}componentWillReceiveProps({treePosition:e,gameTree:t}={}){if(null!=e){if(t!==this.props.gameTree){let[e,n]=this.getMatrixDict(t);this.setState({matrixDict:[e,n]})}e!==this.props.treePosition&&(clearTimeout(this.updateCameraPositionId),this.updateCameraPositionId=setTimeout(()=>this.updateCameraPosition(),h))}}componentDidUpdate({height:e,showGameGraph:t}){e!==this.props.height&&setTimeout(()=>this.remeasure(),200),t!==this.props.showGameGraph&&setTimeout(()=>this.updateCameraPosition(),200)}getMatrixDict(e){return e!==this.matrixDictTree&&(this.matrixDictTree=e,this.matrixDictCache=a.getMatrixDict(e)),this.matrixDictCache}updateCameraPosition(){let{gridSize:e,treePosition:t}=this.props,{matrixDict:[n,i]}=this.state,[r,o]=i[t],[s,l]=a.getMatrixWidth(o,n),u=1===s?0:1-2*(r-l)/(s-1),h=(s-1)*e/2;h=Math.min(h,this.state.viewportSize[0]/2-e),this.setState({cameraPosition:[r*e+u*h-this.state.viewportSize[0]/2,o*e-this.state.viewportSize[1]/2].map(e=>Math.round(e))})}remeasure(){if(!this.props.showGameGraph)return;let{left:e,top:t,width:n,height:i}=this.element.getBoundingClientRect();this.setState({viewportSize:[n,i],viewportPosition:[e,t]})}handleGraphMouseDown(e){this.mouseDown=e.button}handleNodeClick(e){if(this.drag)return void(this.drag=!1);let{onNodeClick:t=l.noop,gameTree:n,gridSize:i}=this.props,{matrixDict:[r],cameraPosition:[o,s]}=this.state,[a,u]=this.mousePosition,[h,c]=[a+o,u+s].map(e=>Math.round(e/i));r[c]&&r[c][h]&&t(Object.assign(e,{gameTree:n,treePosition:r[c][h]}))}renderNodes({gameTree:e,gameCurrents:t,gridSize:n,nodeSize:i},{matrixDict:[o,s],cameraPosition:[a,l],viewportSize:[u,h],viewportPosition:[f,m]}){let g=[],y=[],[v,b]=[a,l].map(e=>Math.max(Math.ceil(e/n)-2,0)),[w,x]=[a,l].map((e,t)=>(e+[u,h][t])/n+2);b-=3,x+=3;let k=[],C=[...e.listCurrentNodes(t)];for(let t=v;t<=w;t++){let u=[];for(let h=b;h<=x;h++){if(null==o[h]||null==o[h][t])continue;let g=o[h][t],v=e.get(g),b=e.get(v.parentId),w=C.includes(v),x=this.props.treePosition===g,_=w?1:.5,S=null!=v.data.BM?[240,35,17]:null!=v.data.DO?[146,39,143]:null!=v.data.IT?[72,134,213]:null!=v.data.TE?[89,168,15]:c.some(e=>null!=v.data[e])?[255,174,61]:[238,238,238],M=t*n,T=h*n;if(u.push(r(d,{key:h,mouseShift:[a-f,l-m],position:[M,T],type:null!=v.data.HO?"bookmark":null!=v.data.B&&""===v.data.B[0]||null!=v.data.W&&""===v.data.W[0]?"square":null==v.data.B&&null==v.data.W?"diamond":"circle",current:x,fill:`rgb(${S.map(e=>e*_).join(",")})`,nodeSize:i+1,gridSize:n})),!k.includes(g)){let t,i;if(null!=b){let[e,r]=s[b.id];t=[e*n,r*n],i=[M,T]}else i=t=[M,T];let o=[...e.getSequence(g)];null!=t&&null!=i&&(y[w?"push":"unshift"](r(p,{key:g,positionAbove:t,positionBelow:i,length:(o.length-1)*n,current:w,gridSize:n})),k.push(...o.map(e=>e.id)))}if(v.children.length>1)for(let t of v.children){let i=w&&C.includes(t),[o,a]=s[t.id],l=[...e.getSequence(t.id)];y[i?"push":"unshift"](r(p,{key:t.id,positionAbove:[M,T],positionBelow:[o*n,a*n],length:(l.length-1)*n,current:i,gridSize:n})),k.push(...l.map(e=>e.id))}}u.length>0&&g.push(r("g",{key:t},u))}return[r("g",{},y),r("g",{},g)]}render({height:e,showGameGraph:t},{matrixDict:n,viewportSize:i,cameraPosition:[o,s]}){return r("section",{ref:e=>this.element=e,id:"graph",style:{height:`${e}%`}},r("style",{},`#graph svg > * {\n                transform: translate(${-o}px, ${-s}px);\n            }`),t&&n&&i&&r("svg",{ref:e=>this.svgElement=e,width:i[0],height:i[1],onClick:this.handleNodeClick,onContextMenu:this.handleNodeClick,onMouseDown:this.handleGraphMouseDown,onMouseUp:this.handleGraphMouseUp},this.renderNodes(this.props,this.state)))}}},function(e,t,n){const{remote:i,shell:r}=n(4),{h:o,Component:s}=n(0),a=n(2),l=n(73),u=n(8),h=n(74),c=n(3).context("CommentBox"),d=n(6),p=n(1),f=i.require("./setting");let m=f.get("comments.commit_delay");class g extends s{constructor(){super(),this.handleEditButtonClick=(()=>sabaki.setMode("edit")),this.handleMoveNameHelpClick=(e=>{e.preventDefault(),r.openExternal(e.currentTarget.href)}),this.handleMoveNameHelpMouseEnter=(e=>{let t=JSON.parse(e.currentTarget.dataset.vertices);sabaki.setState({highlightVertices:t})}),this.handleMoveNameHelpMouseLeave=(e=>{sabaki.setState({highlightVertices:[]})})}shouldComponentUpdate({gameTree:e,treePosition:t,moveAnnotation:n,positionAnnotation:i,title:r}){return r!==this.props.title||e!==this.props.gameTree||t!==this.props.treePosition||!p.vertexEquals(n,this.props.moveAnnotation)||!p.vertexEquals(i,this.props.positionAnnotation)}getCurrentMoveInterpretation(){let e,t,{gameTree:n,treePosition:i}=this.props,r=n.get(i);if(null==r.parentId){let e=[];if(null!=r.data.EV&&e.push(r.data.EV[0]),null!=r.data.GN&&e.push(r.data.GN[0]),""!==(e=e.filter(e=>""!==e.trim()).join(" — ")))return p.typographer(e);let t=new Date;return 25===t.getDate()&&3===t.getMonth()?c("Happy Birthday, Sabaki!"):""}if(0===r.children.length&&n.onMainLine(i)){let e=d.getRootProperty(n,"RE","");if(""!==e.trim())return c(e=>`Result: ${e.result}`,{result:e})}if(null!=r.data.B)t=1,e=u.parseVertex(r.data.B[0]);else{if(null==r.data.W)return null;t=-1,e=u.parseVertex(r.data.W[0])}let s=d.getBoard(n,r.parentId),a=l.findPatternInMove(s.arrangement,t,e);if(null==a){let t=e.map((e,t)=>Math.min(e+1,[s.width,s.height][t]-e)).sort((e,t)=>e-t);return t[0]>6?null:c(e=>`${e.a}-${e.b} Point`,{a:t[0],b:t[1]})}let h=d.getBoard(n,i),f=[...a.match.anchors,...a.match.vertices].filter(e=>0!==h.get(e));return[c(a.pattern.name)," ",a.pattern.url&&o("a",{class:"help",href:a.pattern.url,title:c("View article on Sensei’s Library"),"data-vertices":JSON.stringify(f),onClick:this.handleMoveNameHelpClick,onMouseEnter:this.handleMoveNameHelpMouseEnter,onMouseLeave:this.handleMoveNameHelpMouseLeave},o("img",{src:"/static/node_modules/octicons/build/svg/question.svg",width:16,height:16}))]}render({moveAnnotation:[e,t],positionAnnotation:[n,i],title:r}){let s={"-1":[c("Bad move"),"badmove"],0:[c("Doubtful move"),"doubtfulmove"],1:[c("Interesting move"),"interestingmove"],2:[c("Good move"),"goodmove"]};if(t>1)for(let e in s)s[e][0]=c("Very "+s[e][0].toLowerCase());let l={"-1":[c("Good for white"),"white"],0:[c("Even position"),"balance"],1:[c("Good for black"),"black"],"-2":[c("Unclear position"),"unclear"]};if(i>1)for(let e in l)l[e][0]=c("Very "+l[e][0].toLowerCase());let u=f.get("comments.show_move_interpretation");return o("p",{class:a({header:!0,movestatus:null!==e,positionstatus:null!==n})},o("img",{width:16,height:16,class:"positionstatus",title:n in l?l[n][0]:"",src:n in l?`./img/ui/${l[n][1]}.svg`:""}),o("img",{width:16,height:16,class:"movestatus",title:e in s?s[e][0]:"",src:e in s?`./img/ui/${s[e][1]}.svg`:""}),o("img",{src:"/static/node_modules/octicons/build/svg/pencil.svg",class:"edit-button",title:c("Edit"),width:16,height:16,onClick:this.handleEditButtonClick}),o("span",{},""!==r?p.typographer(r):u?this.getCurrentMoveInterpretation():""))}}class y extends s{shouldComponentUpdate({comment:e}){return e!==this.props.comment}render({comment:e}){return o("div",{ref:e=>this.element=e,class:"comment"},o(h,{source:e}))}}e.exports=class extends s{constructor(e){super(e),this.state={title:"",comment:""},this.handleCommentInput=(()=>{let{onCommentInput:e=p.noop}=this.props;this.setState({title:this.titleInputElement.value,comment:this.textareaElement.value}),clearTimeout(this.commentInputTimeout),this.commentInputTimeout=setTimeout(()=>{e({title:this.titleInputElement.value,comment:this.textareaElement.value})},m)}),this.handleMenuButtonClick=(()=>{let{left:e,bottom:t}=this.menuButtonElement.getBoundingClientRect(),{gameTree:n,treePosition:i}=this.props;sabaki.openCommentMenu(n,i,{x:e,y:t})})}shouldComponentUpdate({showCommentBox:e,height:t}){return t!==this.props.height||e&&!this.dirty}componentWillReceiveProps({treePosition:e,mode:t,title:n,comment:i}){let r=e!==this.props.treePosition;if("edit"===t)return this.element.scrollTop=0,r&&(this.textareaElement.scrollTop=0),void this.setState({title:n,comment:i});this.dirty=!0,clearTimeout(this.updateId),this.updateId=setTimeout(()=>{this.dirty=!1,r&&(this.element.scrollTop=0),this.setState({title:n,comment:i})},f.get("graph.delay"))}render({gameTree:e,treePosition:t,height:n,sidebarSplitTransition:i,moveAnnotation:r,positionAnnotation:s,onResizerMouseDown:a=p.noop,onLinkClick:l=p.noop,onCoordinateMouseEnter:u=p.noop,onCoordinateMouseLeave:h=p.noop},{title:d,comment:f}){return o("section",{ref:e=>this.element=e,id:"properties",style:{transition:i?null:"none",height:n+"%"}},o("div",{class:"horizontalresizer",onMouseDown:a}),o("div",{class:"inner"},o(g,{gameTree:e,treePosition:t,moveAnnotation:r,positionAnnotation:s,title:d}),o(y,{comment:f,onLinkClick:l,onCoordinateMouseEnter:u,onCoordinateMouseLeave:h})),o("div",{class:"edit"},o("div",{class:"header"},o("img",{ref:e=>this.menuButtonElement=e,src:"/static/node_modules/octicons/build/svg/chevron-down.svg",width:16,height:16,onClick:this.handleMenuButtonClick}),o("div",{},o("input",{ref:e=>this.titleInputElement=e,type:"text",name:"title",value:d,placeholder:c("Title"),onInput:this.handleCommentInput}))),o("textarea",{ref:e=>this.textareaElement=e,placeholder:c("Comment"),value:f,onInput:this.handleCommentInput})))}}},function(e,t,n){const i=n(7);e.exports={findPatternInMove:i}},function(e,t,n){const{h:i,Component:r}=n(0),o=n(75),s=n(1),a=n(76),l=n(154);function u(e){return Array.isArray(e)?e.map(e=>"string"!=typeof e?e:s.typographer(e)):u([e])[0]}function h(e){return e.map(e=>"string"!=typeof e?e:i(l,{tag:"span",content:u(e)}))}const c=e=>({children:t})=>i(e,{},h(t)),d=c("em"),p=c("strong"),f=c("del"),m=c("li");function g({children:e}){return i("p",{},h(e))}function y({href:e,title:t,children:n}){return null==e.match(/^((ht|f)tps?:\/\/|mailto:)/)?i("span",{},u(n)):i(l,{},i("a",{class:"external",href:e,title:t},u(n)))}function v({src:e,alt:t}){return i(y,{href:e},u(t))}function b({level:e,children:t}){return i(`h${e}`,{},u(t))}function w({isBlock:e,value:t}){return i(e?g:"span",{},t)}e.exports=class extends r{render({source:e}){return i(a,{source:e,plugins:[o],renderers:{paragraph:g,emphasis:d,strong:p,delete:f,link:y,image:v,linkReference:y,imageReference:v,table:null,listItem:m,heading:b,code:g,html:w}})}}},function(e,t,n){"use strict";e.exports=function(){var e,t=this.Parser;if(!function(e){return Boolean(e&&e.prototype&&e.prototype.inlineTokenizers&&e.prototype.inlineTokenizers.break&&e.prototype.inlineTokenizers.break.locator)}(t))throw new Error("Missing parser to attach `remark-breaks` to");function n(e,t,n){for(var i,r=t.length,o=-1,s="";++o<r;){if("\n"===(i=t.charAt(o)))return!!n||e(s+=i)({type:"break"});if(" "!==i)return;s+=i}}e=t.prototype.inlineTokenizers,n.locator=e.break.locator,e.break=n}},function(e,t,n){"use strict";var i=n(9),r=n(77),o=n(90),s=n(144),a=n(145),l=n(147),u=n(148),h=n(149),c=n(150),d=n(151),p=n(152),f=n(153),m=Object.keys(f),g=function(e){var t=e.source||e.children||"";if(e.allowedTypes&&e.disallowedTypes)throw new Error("Only one of `allowedTypes` and `disallowedTypes` should be defined");var n=i(f,e.renderers),s=[o].concat(e.plugins||[]).reduce(y,r()).parse(t),p=i(e,{renderers:n,definitions:d(s)}),g=function(e){var t=[c,a()],n=e.disallowedTypes;e.allowedTypes&&(n=m.filter(function(t){return"root"!==t&&-1===e.allowedTypes.indexOf(t)}));var i=e.unwrapDisallowed?"unwrap":"remove";n&&n.length>0&&t.push(u.ofType(n,i));e.allowNode&&t.push(u.ifNotMatch(e.allowNode,i));e.escapeHtml||e.skipHtml||t.push(l);return e.astPlugins?t.concat(e.astPlugins):t}(e).reduce(function(e,t){return t(e,p)},s);return h(g,p)};function y(e,t){return Array.isArray(t)?e.use.apply(e,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t)):e.use(t)}g.defaultProps={renderers:{},escapeHtml:!0,skipHtml:!1,sourcePos:!1,rawSourcePos:!1,transformLinkUri:p,astPlugins:[],plugins:[]},g.propTypes={className:s.string,source:s.string,children:s.string,sourcePos:s.bool,rawSourcePos:s.bool,escapeHtml:s.bool,skipHtml:s.bool,allowNode:s.func,allowedTypes:s.arrayOf(s.oneOf(m)),disallowedTypes:s.arrayOf(s.oneOf(m)),transformLinkUri:s.oneOfType([s.func,s.bool]),linkTarget:s.oneOfType([s.func,s.string]),transformImageUri:s.func,astPlugins:s.arrayOf(s.func),unwrapDisallowed:s.bool,renderers:s.object,plugins:s.array},g.types=m,g.renderers=f,g.uriTransformer=p,e.exports=g},function(e,t,n){"use strict";var i=n(78),r=n(79),o=n(80),s=n(86),a=n(88),l=n(89);e.exports=function e(){var t=[];var n=s();var v={};var b=!1;var w=-1;x.data=function(e,t){if(a(e))return 2===arguments.length?(m("data",b),v[e]=t,x):h.call(v,e)&&v[e]||null;if(e)return m("data",b),v=e,x;return v};x.freeze=k;x.attachers=t;x.use=function(e){var n;if(m("use",b),null==e);else if("function"==typeof e)a.apply(null,arguments);else{if("object"!=typeof e)throw new Error("Expected usable value, not `"+e+"`");"length"in e?s(e):r(e)}n&&(v.settings=i(v.settings||{},n));return x;function r(e){s(e.plugins),e.settings&&(n=i(n||{},e.settings))}function o(e){if("function"==typeof e)a(e);else{if("object"!=typeof e)throw new Error("Expected usable value, not `"+e+"`");"length"in e?a.apply(null,e):r(e)}}function s(e){var t,n;if(null==e);else{if(!("object"==typeof e&&"length"in e))throw new Error("Expected a list of plugins, not `"+e+"`");for(t=e.length,n=-1;++n<t;)o(e[n])}}function a(e,n){var r=function(e){var n,i=t.length,r=-1;for(;++r<i;)if((n=t[r])[0]===e)return n}(e);r?(l(r[1])&&l(n)&&(n=i(r[1],n)),r[1]=n):t.push(u.call(arguments))}};x.parse=function(e){var t,n=o(e);if(k(),p("parse",t=x.Parser),d(t))return new t(String(n),n).parse();return t(String(n),n)};x.stringify=function(e,t){var n,i=o(t);if(k(),f("stringify",n=x.Compiler),g(e),d(n))return new n(e,i).compile();return n(e,i)};x.run=C;x.runSync=function(e,t){var n,i=!1;return C(e,t,function(e,t){i=!0,r(e),n=t}),y("runSync","run",i),n};x.process=_;x.processSync=function(e){var t,n=!1;return k(),p("processSync",x.Parser),f("processSync",x.Compiler),_(t=o(e),function(e){n=!0,r(e)}),y("processSync","process",n),t};return x;function x(){for(var n=e(),r=t.length,o=-1;++o<r;)n.use.apply(null,t[o]);return n.data(i(!0,{},v)),n}function k(){var e,i,r,o;if(b)return x;for(;++w<t.length;)e=t[w],i=e[0],r=e[1],o=null,!1!==r&&(!0===r&&(e[1]=void 0),"function"==typeof(o=i.apply(x,e.slice(1)))&&n.use(o));return b=!0,w=1/0,x}function C(e,t,i){if(g(e),k(),i||"function"!=typeof t||(i=t,t=null),!i)return new Promise(r);function r(r,s){n.run(e,o(t),function(t,n,o){n=n||e,t?s(t):r?r(n):i(null,n,o)})}r(null,i)}function _(e,t){if(k(),p("process",x.Parser),f("process",x.Compiler),!t)return new Promise(n);function n(n,i){var r=o(e);c.run(x,{file:r},function(e){e?i(e):n?n(r):t(null,r)})}n(null,t)}}().freeze();var u=[].slice,h={}.hasOwnProperty,c=s().use(function(e,t){t.tree=e.parse(t.file)}).use(function(e,t,n){e.run(t.tree,t.file,function(e,i,r){e?n(e):(t.tree=i,t.file=r,n())})}).use(function(e,t){t.file.contents=e.stringify(t.tree,t.file)});function d(e){return"function"==typeof e&&function(e){var t;for(t in e)return!0;return!1}(e.prototype)}function p(e,t){if("function"!=typeof t)throw new Error("Cannot `"+e+"` without `Parser`")}function f(e,t){if("function"!=typeof t)throw new Error("Cannot `"+e+"` without `Compiler`")}function m(e,t){if(t)throw new Error(["Cannot invoke `"+e+"` on a frozen processor.\nCreate a new ","processor first, by invoking it: use `processor()` instead of ","`processor`."].join(""))}function g(e){if(!e||!a(e.type))throw new Error("Expected node, got `"+e+"`")}function y(e,t,n){if(!n)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}},function(e,t,n){"use strict";var i=Object.prototype.hasOwnProperty,r=Object.prototype.toString,o=Object.defineProperty,s=Object.getOwnPropertyDescriptor,a=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===r.call(e)},l=function(e){if(!e||"[object Object]"!==r.call(e))return!1;var t,n=i.call(e,"constructor"),o=e.constructor&&e.constructor.prototype&&i.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!o)return!1;for(t in e);return void 0===t||i.call(e,t)},u=function(e,t){o&&"__proto__"===t.name?o(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},h=function(e,t){if("__proto__"===t){if(!i.call(e,t))return;if(s)return s(e,t).value}return e[t]};e.exports=function e(){var t,n,i,r,o,s,c=arguments[0],d=1,p=arguments.length,f=!1;for("boolean"==typeof c&&(f=c,c=arguments[1]||{},d=2),(null==c||"object"!=typeof c&&"function"!=typeof c)&&(c={});d<p;++d)if(null!=(t=arguments[d]))for(n in t)i=h(c,n),c!==(r=h(t,n))&&(f&&r&&(l(r)||(o=a(r)))?(o?(o=!1,s=i&&a(i)?i:[]):s=i&&l(i)?i:{},u(c,{name:n,newValue:e(f,s,r)})):void 0!==r&&u(c,{name:n,newValue:r}));return c}},function(e,t,n){"use strict";e.exports=function(e){if(e)throw e}},function(e,t,n){"use strict";var i=n(81),r=n(83);e.exports=r;var o=r.prototype;function s(e,t,n){var r=this.path,o=new i(e,t,n);return r&&(o.name=r+":"+o.name,o.file=r),o.fatal=!1,this.messages.push(o),o}o.message=s,o.info=function(){var e=this.message.apply(this,arguments);return e.fatal=null,e},o.fail=function(){var e=this.message.apply(this,arguments);throw e.fatal=!0,e},o.warn=s},function(e,t,n){"use strict";var i=n(82);function r(){}e.exports=s,r.prototype=Error.prototype,s.prototype=new r;var o=s.prototype;function s(e,t,n){var r,o,s;"string"==typeof t&&(n=t,t=null),r=function(e){var t,n=[null,null];"string"==typeof e&&(-1===(t=e.indexOf(":"))?n[1]=e:(n[0]=e.slice(0,t),n[1]=e.slice(t+1)));return n}(n),o=i(t)||"1:1",s={start:{line:null,column:null},end:{line:null,column:null}},t&&t.position&&(t=t.position),t&&(t.start?(s=t,t=t.start):s.start=t),e.stack&&(this.stack=e.stack,e=e.message),this.message=e,this.name=o,this.reason=e,this.line=t?t.line:null,this.column=t?t.column:null,this.location=s,this.source=r[0],this.ruleId=r[1]}o.file="",o.name="",o.reason="",o.message="",o.stack="",o.fatal=null,o.column=null,o.line=null},function(e,t,n){"use strict";var i={}.hasOwnProperty;function r(e){return e&&"object"==typeof e||(e={}),s(e.line)+":"+s(e.column)}function o(e){return e&&"object"==typeof e||(e={}),r(e.start)+"-"+r(e.end)}function s(e){return e&&"number"==typeof e?e:1}e.exports=function(e){if(!e||"object"!=typeof e)return null;if(i.call(e,"position")||i.call(e,"type"))return o(e.position);if(i.call(e,"start")||i.call(e,"end"))return o(e);if(i.call(e,"line")||i.call(e,"column"))return r(e);return null}},function(e,t,n){"use strict";(function(t){var i=n(11),r=n(84),o=n(85);e.exports=u;var s={}.hasOwnProperty,a=u.prototype;a.toString=function(e){var t=this.contents||"";return o(t)?t.toString(e):String(t)};var l=["history","path","basename","stem","extname","dirname"];function u(e){var n,i,r;if(e){if("string"==typeof e||o(e))e={contents:e};else if("message"in e&&"messages"in e)return e}else e={};if(!(this instanceof u))return new u(e);for(this.data={},this.messages=[],this.history=[],this.cwd=t.cwd(),i=-1,r=l.length;++i<r;)n=l[i],s.call(e,n)&&(this[n]=e[n]);for(n in e)-1===l.indexOf(n)&&(this[n]=e[n])}function h(e,t){if(-1!==e.indexOf(i.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+i.sep+"`")}function c(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function d(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}Object.defineProperty(a,"path",{get:function(){return this.history[this.history.length-1]},set:function(e){c(e,"path"),e!==this.path&&this.history.push(e)}}),Object.defineProperty(a,"dirname",{get:function(){return"string"==typeof this.path?i.dirname(this.path):void 0},set:function(e){d(this.path,"dirname"),this.path=i.join(e||"",this.basename)}}),Object.defineProperty(a,"basename",{get:function(){return"string"==typeof this.path?i.basename(this.path):void 0},set:function(e){c(e,"basename"),h(e,"basename"),this.path=i.join(this.dirname||"",e)}}),Object.defineProperty(a,"extname",{get:function(){return"string"==typeof this.path?i.extname(this.path):void 0},set:function(e){var t=e||"";if(h(t,"extname"),d(this.path,"extname"),t){if("."!==t.charAt(0))throw new Error("`extname` must start with `.`");if(-1!==t.indexOf(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=r(this.path,t)}}),Object.defineProperty(a,"stem",{get:function(){return"string"==typeof this.path?i.basename(this.path,this.extname):void 0},set:function(e){c(e,"stem"),h(e,"stem"),this.path=i.join(this.dirname||"",e+(this.extname||""))}})}).call(this,n(14))},function(e,t,n){"use strict";var i=n(11);e.exports=function(e,t){if("string"!=typeof e)return e;if(0===e.length)return e;var n=i.basename(e,i.extname(e))+t;return i.join(i.dirname(e),n)}},function(e,t){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&(n(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}(e)||!!e._isBuffer)}},function(e,t,n){"use strict";var i=n(87);e.exports=o,o.wrap=i;var r=[].slice;function o(){var e=[],t={run:function(){var t=-1,n=r.call(arguments,0,-1),o=arguments[arguments.length-1];if("function"!=typeof o)throw new Error("Expected function as last argument, not "+o);(function s(a){var l=e[++t];var u=r.call(arguments,0);var h=u.slice(1);var c=n.length;var d=-1;if(a)return void o(a);for(;++d<c;)null!==h[d]&&void 0!==h[d]||(h[d]=n[d]);n=h;l?i(l,s).apply(null,n):o.apply(null,[null].concat(n))}).apply(null,[null].concat(n))},use:function(n){if("function"!=typeof n)throw new Error("Expected `fn` to be a function, not "+n);return e.push(n),t}};return t}},function(e,t,n){"use strict";var i=[].slice;e.exports=function(e,t){var n;return function(){var t,s=i.call(arguments,0),a=e.length>s.length;a&&s.push(r);try{t=e.apply(null,s)}catch(e){if(a&&n)throw e;return r(e)}a||(t&&"function"==typeof t.then?t.then(o,r):t instanceof Error?r(t):o(t))};function r(){n||(n=!0,t.apply(null,arguments))}function o(e){r(null,e)}}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return"[object String]"===n.call(e)}},function(e,t,n){"use strict";var i=Object.prototype.toString;e.exports=function(e){var t;return"[object Object]"===i.call(e)&&(null===(t=Object.getPrototypeOf(e))||t===Object.getPrototypeOf({}))}},function(e,t,n){"use strict";var i=n(91),r=n(9),o=n(93);function s(e){var t=i(o);t.prototype.options=r(t.prototype.options,this.data("settings"),e),this.Parser=t}e.exports=s,s.Parser=o},function(e,t,n){"use strict";var i=n(9),r=n(92);e.exports=function(e){var t,n,o;for(n in r(a,e),r(s,a),t=a.prototype)(o=t[n])&&"object"==typeof o&&(t[n]="concat"in o?o.concat():i(o));return a;function s(t){return e.apply(this,t)}function a(){return this instanceof a?e.apply(this,arguments):new s(arguments)}}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";var i=n(9),r=n(94),o=n(95),s=n(96),a=n(97),l=n(101);function u(e,t){this.file=t,this.offset={},this.options=i(this.options),this.setOptions({}),this.inList=!1,this.inBlock=!1,this.inLink=!1,this.atStart=!0,this.toOffset=o(t).toOffset,this.unescape=s(this,"escape"),this.decode=a(this)}e.exports=u;var h=u.prototype;function c(e){var t,n=[];for(t in e)n.push(t);return n}h.setOptions=n(102),h.parse=n(105),h.options=n(33),h.exitStart=r("atStart",!0),h.enterList=r("inList",!1),h.enterLink=r("inLink",!1),h.enterBlock=r("inBlock",!1),h.interruptParagraph=[["thematicBreak"],["atxHeading"],["fencedCode"],["blockquote"],["html"],["setextHeading",{commonmark:!1}],["definition",{commonmark:!1}],["footnote",{commonmark:!1}]],h.interruptList=[["atxHeading",{pedantic:!1}],["fencedCode",{pedantic:!1}],["thematicBreak",{pedantic:!1}],["definition",{commonmark:!1}],["footnote",{commonmark:!1}]],h.interruptBlockquote=[["indentedCode",{commonmark:!0}],["fencedCode",{commonmark:!0}],["atxHeading",{commonmark:!0}],["setextHeading",{commonmark:!0}],["thematicBreak",{commonmark:!0}],["html",{commonmark:!0}],["list",{commonmark:!0}],["definition",{commonmark:!1}],["footnote",{commonmark:!1}]],h.blockTokenizers={newline:n(109),indentedCode:n(110),fencedCode:n(111),blockquote:n(112),atxHeading:n(113),thematicBreak:n(114),list:n(115),setextHeading:n(117),html:n(118),footnote:n(119),definition:n(121),table:n(122),paragraph:n(123)},h.inlineTokenizers={escape:n(124),autoLink:n(126),url:n(127),html:n(129),link:n(130),reference:n(131),strong:n(132),emphasis:n(134),deletion:n(137),code:n(139),break:n(141),text:n(143)},h.blockMethods=c(h.blockTokenizers),h.inlineMethods=c(h.inlineTokenizers),h.tokenizeBlock=l("block"),h.tokenizeInline=l("inline"),h.tokenizeFactory=l},function(e,t,n){"use strict";e.exports=function(e,t,n){return function(){var i=n||this,r=i[e];return i[e]=!t,function(){i[e]=r}}}},function(e,t,n){"use strict";function i(e){return function(t){var n=-1,i=e.length;if(t<0)return{};for(;++n<i;)if(e[n]>t)return{line:n+1,column:t-(e[n-1]||0)+1,offset:t};return{}}}function r(e){return function(t){var n=t&&t.line,i=t&&t.column;if(!isNaN(n)&&!isNaN(i)&&n-1 in e)return(e[n-2]||0)+i-1||0;return-1}}e.exports=function(e){var t=function(e){var t=[],n=e.indexOf("\n");for(;-1!==n;)t.push(n+1),n=e.indexOf("\n",n+1);return t.push(e.length+1),t}(String(e));return{toPosition:i(t),toOffset:r(t)}}},function(e,t,n){"use strict";e.exports=function(e,t){return function(n){var i,r=0,o=n.indexOf("\\"),s=e[t],a=[];for(;-1!==o;)a.push(n.slice(r,o)),r=o+1,(i=n.charAt(r))&&-1!==s.indexOf(i)||a.push("\\"),o=n.indexOf("\\",r);return a.push(n.slice(r)),a.join("")}}},function(e,t,n){"use strict";var i=n(9),r=n(21);e.exports=function(e){return o.raw=function(e,o,s){return r(e,i(s,{position:t(o),warning:n}))},o;function t(t){for(var n=e.offset,i=t.line,r=[];++i&&i in n;)r.push((n[i]||0)+1);return{start:t,indent:r}}function n(t,n,i){3!==i&&e.file.message(t,n)}function o(i,o,s){r(i,{position:t(o),warning:n,text:s,reference:s,textContext:e,referenceContext:e})}}},function(e,t,n){"use strict";e.exports=function(e){var t="string"==typeof e?e.charCodeAt(0):e;return t>=97&&t<=102||t>=65&&t<=70||t>=48&&t<=57}},function(e,t,n){"use strict";var i=n(32),r=n(18);e.exports=function(e){return i(e)||r(e)}},function(e,t,n){"use strict";var i;e.exports=function(e){var t,n="&"+e+";";if((i=i||document.createElement("i")).innerHTML=n,";"===(t=i.textContent).slice(-1)&&"semi"!==e)return!1;return t!==n&&t}},function(e,t,n){"use strict";e.exports=function(e){return function(t,n){var o,s,a,l,u,h,c=this,d=c.offset,p=[],f=c[e+"Methods"],m=c[e+"Tokenizers"],g=n.line,y=n.column;if(!t)return p;x.now=b,x.file=c.file,v("");for(;t;){for(o=-1,s=f.length,u=!1;++o<s&&(l=f[o],!(a=m[l])||a.onlyAtStart&&!c.atStart||a.notInList&&c.inList||a.notInBlock&&c.inBlock||a.notInLink&&c.inLink||(h=t.length,a.apply(c,[x,t]),!(u=h!==t.length))););u||c.file.fail(new Error("Infinite loop"),x.now())}return c.eof=b(),p;function v(e){for(var t=-1,n=e.indexOf("\n");-1!==n;)g++,t=n,n=e.indexOf("\n",n+1);-1===t?y+=e.length:y=e.length-t,g in d&&(-1!==t?y+=d[g]:y<=d[g]&&(y=d[g]+1))}function b(){var e={line:g,column:y};return e.offset=c.toOffset(e),e}function w(e){this.start=e,this.end=b()}function x(e){var n=function(){var e=[],t=g+1;return function(){for(var n=g+1;t<n;)e.push((d[t]||0)+1),t++;return e}}(),o=function(){var e=b();return function(t,n){var i=t.position,r=i?i.start:e,o=[],s=i&&i.end.line,a=e.line;if(t.position=new w(r),i&&n&&i.indent){if(o=i.indent,s<a){for(;++s<a;)o.push((d[s]||0)+1);o.push(e.column)}n=o.concat(n)}return t.position.indent=n||[],t}}(),s=b();return function(e){t.substring(0,e.length)!==e&&c.file.fail(new Error("Incorrectly eaten value: please report this warning on http://git.io/vg5Ft"),b())}(e),a.reset=l,l.test=u,a.test=u,t=t.substring(e.length),v(e),n=n(),a;function a(e,t){return o(function(e,t){var n=t?t.children:p,o=n[n.length-1];o&&e.type===o.type&&e.type in i&&r(o)&&r(e)&&(e=i[e.type].call(c,o,e));e!==o&&n.push(e);c.atStart&&0!==p.length&&c.exitStart();return e}(o(e),t),n)}function l(){var n=a.apply(null,arguments);return g=s.line,y=s.column,t=e+t,n}function u(){var n=o({});return g=s.line,y=s.column,t=e+t,n.position}}}};var i={text:function(e,t){return e.value+=t.value,e},blockquote:function(e,t){if(this.options.commonmark)return t;return e.children=e.children.concat(t.children),e}};function r(e){var t,n;return"text"!==e.type||!e.position||(t=e.position.start,n=e.position.end,t.line!==n.line||n.column-t.column===e.value.length)}},function(e,t,n){"use strict";var i=n(9),r=n(103),o=n(33);e.exports=function(e){var t,n,s=this.options;if(null==e)e={};else{if("object"!=typeof e)throw new Error("Invalid value `"+e+"` for setting `options`");e=i(e)}for(t in o){if(null==(n=e[t])&&(n=s[t]),"blocks"!==t&&"boolean"!=typeof n||"blocks"===t&&"object"!=typeof n)throw new Error("Invalid value `"+n+"` for setting `options."+t+"`");e[t]=n}return this.options=e,this.escape=r(e),this}},function(e,t,n){"use strict";e.exports=s;var i=["\\","`","*","{","}","[","]","(",")","#","+","-",".","!","_",">"],r=i.concat(["~","|"]),o=r.concat(["\n",'"',"$","%","&","'",",","/",":",";","<","=","?","@","^"]);function s(e){var t=e||{};return t.commonmark?o:t.gfm?r:i}s.default=i,s.gfm=r,s.commonmark=o},function(e){e.exports=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","legend","li","link","main","menu","menuitem","meta","nav","noframes","ol","optgroup","option","p","param","pre","section","source","title","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"]},function(e,t,n){"use strict";var i=n(9),r=n(106);e.exports=function(){var e,t=String(this.file),n={line:1,column:1,offset:0},a=i(n);65279===(t=t.replace(s,o)).charCodeAt(0)&&(t=t.slice(1),a.column++,a.offset++);e={type:"root",children:this.tokenizeBlock(t,a),position:{start:n,end:this.eof||i(n)}},this.options.position||r(e,!0);return e};var o="\n",s=/\r\n|\r/g},function(e,t,n){"use strict";var i=n(19);function r(e){delete e.position}function o(e){e.position=void 0}e.exports=function(e,t){return i(e,t?r:o),e}},function(e,t,n){"use strict";e.exports=s;var i=n(108),r="skip",o=!1;function s(e,t,n,s){function a(e,l,u){var h;return(t&&!i(t,e,l,u[u.length-1]||null)||(h=n(e,u))!==o)&&e.children&&h!==r&&function(e,t){var n,i,r=s?-1:1,l=(s?e.length:-1)+r;for(;l>-1&&l<e.length;){if(n=e[l],(i=n&&a(n,l,t))===o)return i;l="number"==typeof i?i:l+r}}(e.children,u.concat(e))===o?o:h}"function"==typeof t&&"function"!=typeof n&&(s=n,n=t,t=null),a(e,null,[])}s.CONTINUE=!0,s.SKIP=r,s.EXIT=o},function(e,t,n){"use strict";function i(e){if("string"==typeof e)return function(e){return function(t){return Boolean(t&&t.type===e)}}(e);if(null==e)return r;if("object"==typeof e)return("length"in e?function(e){var t=function(e){var t=[],n=e.length,r=-1;for(;++r<n;)t[r]=i(e[r]);return t}(e),n=t.length;return function(){var e=-1;for(;++e<n;)if(t[e].apply(this,arguments))return!0;return!1}}:function(e){return function(t){var n;for(n in e)if(t[n]!==e[n])return!1;return!0}})(e);if("function"==typeof e)return e;throw new Error("Expected function, string, or object as test")}function r(){return!0}e.exports=function e(t,n,r,o,s){var a=null!=o;var l=null!=r;var u=i(t);if(l&&("number"!=typeof r||r<0||r===1/0))throw new Error("Expected positive finite index or child node");if(a&&(!e(null,o)||!o.children))throw new Error("Expected parent node");if(!n||!n.type||"string"!=typeof n.type)return!1;if(a!==l)throw new Error("Expected both parent and index");return Boolean(u.call(s,n,r,o))}},function(e,t,n){"use strict";var i=n(5);e.exports=function(e,t,n){var r,o,s,a,l=t.charAt(0);if("\n"!==l)return;if(n)return!0;a=1,r=t.length,o=l,s="";for(;a<r&&(l=t.charAt(a),i(l));)s+=l,"\n"===l&&(o+=s,s=""),a++;e(o)}},function(e,t,n){"use strict";var i=n(22),r=n(23);e.exports=function(e,t,n){var i,u,h,c=-1,d=t.length,p="",f="",m="",g="";for(;++c<d;)if(i=t.charAt(c),h)if(h=!1,p+=m,f+=g,m="",g="",i===o)m=i,g=i;else for(p+=i,f+=i;++c<d;){if(!(i=t.charAt(c))||i===o){g=i,m=i;break}p+=i,f+=i}else if(i===a&&t.charAt(c+1)===i&&t.charAt(c+2)===i&&t.charAt(c+3)===i)m+=l,c+=3,h=!0;else if(i===s)m+=i,h=!0;else{for(u="";i===s||i===a;)u+=i,i=t.charAt(++c);if(i!==o)break;m+=u+i,g+=i}if(f)return!!n||e(p)({type:"code",lang:null,value:r(f)})};var o="\n",s="\t",a=" ",l=i(a,4)},function(e,t,n){"use strict";var i=n(23);e.exports=function(e,t,n){var c,d,p,f,m,g,y,v,b,w,x,k=this.options,C=t.length+1,_=0,S="";if(!k.gfm)return;for(;_<C&&((p=t.charAt(_))===s||p===o);)S+=p,_++;if(w=_,(p=t.charAt(_))!==a&&p!==l)return;_++,d=p,c=1,S+=p;for(;_<C&&(p=t.charAt(_))===d;)S+=p,c++,_++;if(c<u)return;for(;_<C&&((p=t.charAt(_))===s||p===o);)S+=p,_++;f="",m="";for(;_<C&&(p=t.charAt(_))!==r&&p!==a&&p!==l;)p===s||p===o?m+=p:(f+=m+p,m=""),_++;if((p=t.charAt(_))&&p!==r)return;if(n)return!0;(x=e.now()).column+=S.length,x.offset+=S.length,S+=f,f=this.decode.raw(this.unescape(f),x),m&&(S+=m);m="",v="",b="",g="",y="";for(;_<C;)if(p=t.charAt(_),g+=v,y+=b,v="",b="",p===r){for(g?(v+=p,b+=p):S+=p,m="",_++;_<C&&(p=t.charAt(_))===s;)m+=p,_++;if(v+=m,b+=m.slice(w),!(m.length>=h)){for(m="";_<C&&(p=t.charAt(_))===d;)m+=p,_++;if(v+=m,b+=m,!(m.length<c)){for(m="";_<C&&((p=t.charAt(_))===s||p===o);)v+=p,b+=p,_++;if(!p||p===r)break}}}else g+=p,b+=p,_++;return e(S+=g+v)({type:"code",lang:f||null,value:i(y)})};var r="\n",o="\t",s=" ",a="~",l="`",u=3,h=4},function(e,t,n){"use strict";var i=n(12),r=n(24);e.exports=function(e,t,n){var u,h,c,d,p,f,m,g,y,v=this.offset,b=this.blockTokenizers,w=this.interruptBlockquote,x=e.now(),k=x.line,C=t.length,_=[],S=[],M=[],T=0;for(;T<C&&((h=t.charAt(T))===a||h===s);)T++;if(t.charAt(T)!==l)return;if(n)return!0;T=0;for(;T<C;){for(d=t.indexOf(o,T),m=T,g=!1,-1===d&&(d=C);T<C&&((h=t.charAt(T))===a||h===s);)T++;if(t.charAt(T)===l?(T++,g=!0,t.charAt(T)===a&&T++):T=m,p=t.slice(T,d),!g&&!i(p)){T=m;break}if(!g&&(c=t.slice(T),r(w,b,this,[e,c,!0])))break;f=m===T?p:t.slice(m,d),M.push(T-m),_.push(f),S.push(p),T=d+1}T=-1,C=M.length,u=e(_.join(o));for(;++T<C;)v[k]=(v[k]||0)+M[T],k++;return y=this.enterBlock(),S=this.tokenizeBlock(S.join(o),x),y(),u({type:"blockquote",children:S})};var o="\n",s="\t",a=" ",l=">"},function(e,t,n){"use strict";e.exports=function(e,t,n){var l,u,h,c=this.options,d=t.length+1,p=-1,f=e.now(),m="",g="";for(;++p<d;){if((l=t.charAt(p))!==o&&l!==r){p--;break}m+=l}h=0;for(;++p<=d;){if((l=t.charAt(p))!==s){p--;break}m+=l,h++}if(h>a)return;if(!h||!c.pedantic&&t.charAt(p+1)===s)return;d=t.length+1,u="";for(;++p<d;){if((l=t.charAt(p))!==o&&l!==r){p--;break}u+=l}if(!c.pedantic&&0===u.length&&l&&l!==i)return;if(n)return!0;m+=u,u="",g="";for(;++p<d&&(l=t.charAt(p))&&l!==i;)if(l===o||l===r||l===s){for(;l===o||l===r;)u+=l,l=t.charAt(++p);for(;l===s;)u+=l,l=t.charAt(++p);for(;l===o||l===r;)u+=l,l=t.charAt(++p);p--}else g+=u+l,u="";return f.column+=m.length,f.offset+=m.length,e(m+=g+u)({type:"heading",depth:h,children:this.tokenizeInline(g,f)})};var i="\n",r="\t",o=" ",s="#",a=6},function(e,t,n){"use strict";e.exports=function(e,t,n){var h,c,d,p,f=-1,m=t.length+1,g="";for(;++f<m&&((h=t.charAt(f))===r||h===o);)g+=h;if(h!==s&&h!==l&&h!==a)return;c=h,g+=h,d=1,p="";for(;++f<m;)if((h=t.charAt(f))===c)d++,g+=p+c,p="";else{if(h!==o)return d>=u&&(!h||h===i)?(g+=p,!!n||e(g)({type:"thematicBreak"})):void 0;p+=h}};var i="\n",r="\t",o=" ",s="*",a="_",l="-",u=3},function(e,t,n){"use strict";var i=n(12),r=n(22),o=n(18),s=n(34),a=n(116),l=n(24);e.exports=function(e,t,n){var r,s,a,m,y,v,b,w,x,M,T,P,A,D,I,E,N,B,O,L,R,z,V,j,W=this.options.commonmark,F=this.options.pedantic,H=this.blockTokenizers,$=this.interruptList,G=0,U=t.length,q=null,Y=0;for(;G<U;){if((m=t.charAt(G))===f)Y+=g-Y%g;else{if(m!==d)break;Y++}G++}if(Y>=g)return;if(m=t.charAt(G),r=W?_:C,!0===k[m])y=m,a=!1;else{for(a=!0,s="";G<U&&(m=t.charAt(G),o(m));)s+=m,G++;if(m=t.charAt(G),!s||!0!==r[m])return;q=parseInt(s,10),y=m}if((m=t.charAt(++G))!==d&&m!==f)return;if(n)return!0;G=0,D=[],I=[],E=[];for(;G<U;){for(v=t.indexOf(p,G),b=G,w=!1,j=!1,-1===v&&(v=U),V=G+g,Y=0;G<U;){if((m=t.charAt(G))===f)Y+=g-Y%g;else{if(m!==d)break;Y++}G++}if(Y>=g&&(j=!0),N&&Y>=N.indent&&(j=!0),m=t.charAt(G),x=null,!j){if(!0===k[m])x=m,G++,Y++;else{for(s="";G<U&&(m=t.charAt(G),o(m));)s+=m,G++;m=t.charAt(G),G++,s&&!0===r[m]&&(x=m,Y+=s.length+1)}if(x)if((m=t.charAt(G))===f)Y+=g-Y%g,G++;else if(m===d){for(V=G+g;G<V&&t.charAt(G)===d;)G++,Y++;G===V&&t.charAt(G)===d&&(G-=g-1,Y-=g-1)}else m!==p&&""!==m&&(x=null)}if(x){if(!F&&y!==x)break;w=!0}else W||j||t.charAt(b)!==d?W&&N&&(j=Y>=N.indent||Y>g):j=!0,w=!1,G=b;if(T=t.slice(b,v),M=b===G?T:t.slice(G,v),(x===u||x===h||x===c)&&H.thematicBreak.call(this,e,T,!0))break;if(P=A,A=!i(M).length,j&&N)N.value=N.value.concat(E,T),I=I.concat(E,T),E=[];else if(w)0!==E.length&&(N.value.push(""),N.trail=E.concat()),N={value:[T],indent:Y,trail:[]},D.push(N),I=I.concat(E,T),E=[];else if(A){if(P)break;E.push(T)}else{if(P)break;if(l($,H,this,[e,T,!0]))break;N.value=N.value.concat(E,T),I=I.concat(E,T),E=[]}G=v+1}R=e(I.join(p)).reset({type:"list",ordered:a,start:q,loose:null,children:[]}),B=this.enterList(),O=this.enterBlock(),L=!1,G=-1,U=D.length;for(;++G<U;)N=D[G].value.join(p),z=e.now(),(N=e(N)(S(this,N,z),R)).loose&&(L=!0),N=D[G].trail.join(p),G!==U-1&&(N+=p),e(N);return B(),O(),R.loose=L,R};var u="*",h="_",c="-",d=" ",p="\n",f="\t",m="x",g=4,y=/\n\n(?!\s*$)/,v=/^\[([ \t]|x|X)][ \t]/,b=/^([ \t]*)([*+-]|\d+[.)])( {1,4}(?! )| |\t|$|(?=\n))([^\n]*)/,w=/^([ \t]*)([*+-]|\d+[.)])([ \t]+)/,x=/^( {1,4}|\t)?/gm,k={};k[u]=!0,k["+"]=!0,k[c]=!0;var C={".":!0},_={};function S(e,t,n){var i,r,o=e.offset,s=null;return t=(e.options.pedantic?M:T).apply(null,arguments),e.options.gfm&&(i=t.match(v))&&(r=i[0].length,s=i[1].toLowerCase()===m,o[n.line]+=r,t=t.slice(r)),{type:"listItem",loose:y.test(t)||t.charAt(t.length-1)===p,checked:s,children:e.tokenizeBlock(t,n)}}function M(e,t,n){var i=e.offset,r=n.line;return t=t.replace(w,o),r=n.line,t.replace(x,o);function o(e){return i[r]=(i[r]||0)+e.length,r++,""}}function T(e,t,n){var i,o,l,u,h,c,f,m=e.offset,g=n.line;for(u=(t=t.replace(b,function(e,t,n,s,a){o=t+n+s,l=a,Number(n)<10&&o.length%2==1&&(n=d+n);return(i=t+r(d,n.length)+s)+l})).split(p),(h=a(t,s(i).indent).split(p))[0]=l,m[g]=(m[g]||0)+o.length,g++,c=0,f=u.length;++c<f;)m[g]=(m[g]||0)+u[c].length-h[c].length,g++;return h.join(p)}_["."]=!0,_[")"]=!0},function(e,t,n){"use strict";var i=n(12),r=n(22),o=n(34);e.exports=function(e,t){var n,u,h,c,d=e.split(a),p=d.length+1,f=1/0,m=[];d.unshift(r(s,t)+"!");for(;p--;)if(u=o(d[p]),m[p]=u.stops,0!==i(d[p]).length){if(!u.indent){f=1/0;break}u.indent>0&&u.indent<f&&(f=u.indent)}if(f!==1/0)for(p=d.length;p--;){for(h=m[p],n=f;n&&!(n in h);)n--;c=0!==i(d[p]).length&&f&&n!==f?l:"",d[p]=c+d[p].slice(n in h?h[n]+1:0)}return d.shift(),d.join(a)};var s=" ",a="\n",l="\t"},function(e,t,n){"use strict";e.exports=function(e,t,n){var l,u,h,c,d,p=e.now(),f=t.length,m=-1,g="";for(;++m<f;){if((h=t.charAt(m))!==o||m>=s){m--;break}g+=h}l="",u="";for(;++m<f;){if((h=t.charAt(m))===i){m--;break}h===o||h===r?u+=h:(l+=u+h,u="")}if(p.column+=g.length,p.offset+=g.length,g+=l+u,h=t.charAt(++m),c=t.charAt(++m),h!==i||!a[c])return;g+=h,u=c,d=a[c];for(;++m<f;){if((h=t.charAt(m))!==c){if(h!==i)return;m--;break}u+=h}if(n)return!0;return e(g+u)({type:"heading",depth:d,children:this.tokenizeInline(l,p)})};var i="\n",r="\t",o=" ",s=3,a={};a["="]=1,a["-"]=2},function(e,t,n){"use strict";var i=n(35).openCloseTag;e.exports=function(e,t,n){var l,u,h,c,d,p,f,m=this.options.blocks,g=t.length,y=0,v=[[/^<(script|pre|style)(?=(\s|>|$))/i,/<\/(script|pre|style)>/i,!0],[/^<!--/,/-->/,!0],[/^<\?/,/\?>/,!0],[/^<![A-Za-z]/,/>/,!0],[/^<!\[CDATA\[/,/\]\]>/,!0],[new RegExp("^</?("+m.join("|")+")(?=(\\s|/?>|$))","i"),/^$/,!0],[new RegExp(i.source+"\\s*$"),/^$/,!1]];for(;y<g&&((c=t.charAt(y))===r||c===o);)y++;if(t.charAt(y)!==a)return;l=-1===(l=t.indexOf(s,y+1))?g:l,u=t.slice(y,l),h=-1,d=v.length;for(;++h<d;)if(v[h][0].test(u)){p=v[h];break}if(!p)return;if(n)return p[2];if(y=l,!p[1].test(u))for(;y<g;){if(l=-1===(l=t.indexOf(s,y+1))?g:l,u=t.slice(y+1,l),p[1].test(u)){u&&(y=l);break}y=l}return f=t.slice(0,y),e(f)({type:"html",value:f})};var r="\t",o=" ",s="\n",a="<"},function(e,t,n){"use strict";var i=n(5),r=n(25);e.exports=f,f.notInList=!0,f.notInBlock=!0;var o="\\",s="\n",a="\t",l=" ",u="[",h="]",c="^",d=":",p=/^( {4}|\t)?/gm;function f(e,t,n){var f,m,g,y,v,b,w,x,k,C,_,S,M=this.offset;if(this.options.footnotes){for(f=0,m=t.length,g="",y=e.now(),v=y.line;f<m&&(k=t.charAt(f),i(k));)g+=k,f++;if(t.charAt(f)===u&&t.charAt(f+1)===c){for(f=(g+=u+c).length,w="";f<m&&(k=t.charAt(f))!==h;)k===o&&(w+=k,f++,k=t.charAt(f)),w+=k,f++;if(w&&t.charAt(f)===h&&t.charAt(f+1)===d){if(n)return!0;for(C=r(w),f=(g+=w+h+d).length;f<m&&((k=t.charAt(f))===a||k===l);)g+=k,f++;for(y.column+=g.length,y.offset+=g.length,w="",b="",x="";f<m;){if((k=t.charAt(f))===s){for(x=k,f++;f<m&&(k=t.charAt(f))===s;)x+=k,f++;for(w+=x,x="";f<m&&(k=t.charAt(f))===l;)x+=k,f++;if(0===x.length)break;w+=x}w&&(b+=w,w=""),b+=k,f++}return g+=b,b=b.replace(p,function(e){return M[v]=(M[v]||0)+e.length,v++,""}),_=e(g),S=this.enterBlock(),b=this.tokenizeBlock(b,y),S(),_({type:"footnoteDefinition",identifier:C,children:b})}}}}},function(e,t,n){"use strict";e.exports=function(e){return String(e).replace(/\s+/g," ")}},function(e,t,n){"use strict";var i=n(5),r=n(25);e.exports=v,v.notInList=!0,v.notInBlock=!0;var o='"',s="'",a="\\",l="\n",u="\t",h=" ",c="[",d="]",p="(",f=")",m=":",g="<",y=">";function v(e,t,n){for(var i,y,v,x,k,C,_,S,M=this.options.commonmark,T=0,P=t.length,A="";T<P&&((x=t.charAt(T))===h||x===u);)A+=x,T++;if((x=t.charAt(T))===c){for(T++,A+=x,v="";T<P&&(x=t.charAt(T))!==d;)x===a&&(v+=x,T++,x=t.charAt(T)),v+=x,T++;if(v&&t.charAt(T)===d&&t.charAt(T+1)===m){for(C=v,T=(A+=v+d+m).length,v="";T<P&&((x=t.charAt(T))===u||x===h||x===l);)A+=x,T++;if(v="",i=A,(x=t.charAt(T))===g){for(T++;T<P&&b(x=t.charAt(T));)v+=x,T++;if((x=t.charAt(T))===b.delimiter)A+=g+v+x,T++;else{if(M)return;T-=v.length+1,v=""}}if(!v){for(;T<P&&w(x=t.charAt(T));)v+=x,T++;A+=v}if(v){for(_=v,v="";T<P&&((x=t.charAt(T))===u||x===h||x===l);)v+=x,T++;if(k=null,(x=t.charAt(T))===o?k=o:x===s?k=s:x===p&&(k=f),k){if(!v)return;for(T=(A+=v+x).length,v="";T<P&&(x=t.charAt(T))!==k;){if(x===l){if(T++,(x=t.charAt(T))===l||x===k)return;v+=l}v+=x,T++}if((x=t.charAt(T))!==k)return;y=A,A+=v+x,T++,S=v,v=""}else v="",T=A.length;for(;T<P&&((x=t.charAt(T))===u||x===h);)A+=x,T++;return(x=t.charAt(T))&&x!==l?void 0:!!n||(i=e(i).test().end,_=this.decode.raw(this.unescape(_),i,{nonTerminated:!1}),S&&(y=e(y).test().end,S=this.decode.raw(this.unescape(S),y)),e(A)({type:"definition",identifier:r(C),title:S||null,url:_}))}}}}function b(e){return e!==y&&e!==c&&e!==d}function w(e){return e!==c&&e!==d&&!i(e)}b.delimiter=y},function(e,t,n){"use strict";var i=n(5);e.exports=function(e,t,n){var v,b,w,x,k,C,_,S,M,T,P,A,D,I,E,N,B,O,L,R,z,V,j,W;if(!this.options.gfm)return;v=0,O=0,C=t.length+1,_=[];for(;v<C;){if(V=t.indexOf(h,v),j=t.indexOf(a,v+1),-1===V&&(V=t.length),-1===j||j>V){if(O<p)return;break}_.push(t.slice(v,V)),O++,v=V+1}x=_.join(h),b=_.splice(1,1)[0]||[],v=0,C=b.length,O--,w=!1,P=[];for(;v<C;){if((M=b.charAt(v))===a){if(T=null,!1===w){if(!1===W)return}else P.push(w),w=!1;W=!1}else if(M===s)T=!0,w=w||y;else if(M===l)w=w===f?m:T&&w===y?g:f;else if(!i(M))return;v++}!1!==w&&P.push(w);if(P.length<d)return;if(n)return!0;B=-1,R=[],z=e(x).reset({type:"table",align:P,children:R});for(;++B<O;){for(L=_[B],k={type:"tableRow",children:[]},B&&e(h),e(L).reset(k,z),C=L.length+1,v=0,S="",A="",D=!0,I=null,E=null;v<C;)if((M=L.charAt(v))!==c&&M!==u){if(""===M||M===a)if(D)e(M);else{if(M&&E){S+=M,v++;continue}!A&&!M||D||(x=A,S.length>1&&(M?(x+=S.slice(0,S.length-1),S=S.charAt(S.length-1)):(x+=S,S="")),N=e.now(),e(x)({type:"tableCell",children:this.tokenizeInline(A,N)},k)),e(S+M),S="",A=""}else if(S&&(A+=S,S=""),A+=M,M===r&&v!==C-2&&(A+=L.charAt(v+1),v++),M===o){for(I=1;L.charAt(v+1)===M;)A+=M,v++,I++;E?I>=E&&(E=0):E=I}D=!1,v++}else A?S+=M:e(M),v++;B||e(h+b)}return z};var r="\\",o="`",s="-",a="|",l=":",u=" ",h="\n",c="\t",d=1,p=2,f="left",m="center",g="right",y=null},function(e,t,n){"use strict";var i=n(12),r=n(18),o=n(23),s=n(24);e.exports=function(e,t,n){var c,d,p,f,m,g=this.options,y=g.commonmark,v=g.gfm,b=this.blockTokenizers,w=this.interruptParagraph,x=t.indexOf(a),k=t.length;for(;x<k;){if(-1===x){x=k;break}if(t.charAt(x+1)===a)break;if(y){for(f=0,c=x+1;c<k;){if((p=t.charAt(c))===l){f=h;break}if(p!==u)break;f++,c++}if(f>=h){x=t.indexOf(a,x+1);continue}}if(d=t.slice(x+1),s(w,b,this,[e,d,!0]))break;if(b.list.call(this,e,d,!0)&&(this.inList||y||v&&!r(i.left(d).charAt(0))))break;if(c=x,-1!==(x=t.indexOf(a,x+1))&&""===i(t.slice(c,x))){x=c;break}}if(d=t.slice(0,x),""===i(d))return e(d),null;if(n)return!0;return m=e.now(),d=o(d),e(d)({type:"paragraph",children:this.tokenizeInline(d,m)})};var a="\n",l="\t",u=" ",h=4},function(e,t,n){"use strict";var i=n(125);function r(e,t,n){var i,r;if("\\"===t.charAt(0)&&(i=t.charAt(1),-1!==this.escape.indexOf(i)))return!!n||(r="\n"===i?{type:"break"}:{type:"text",value:i},e("\\"+i)(r))}e.exports=r,r.locator=i},function(e,t,n){"use strict";e.exports=function(e,t){return e.indexOf("\\",t)}},function(e,t,n){"use strict";var i=n(5),r=n(21),o=n(36);e.exports=d,d.locator=o,d.notInLink=!0;var s="<",a=">",l="@",u="/",h="mailto:",c=h.length;function d(e,t,n){var o,d,p,f,m,g,y,v,b,w,x;if(t.charAt(0)===s){for(this,o="",d=t.length,p=0,f="",g=!1,y="",p++,o=s;p<d&&(m=t.charAt(p),!(i(m)||m===a||m===l||":"===m&&t.charAt(p+1)===u));)f+=m,p++;if(f){if(y+=f,f="",y+=m=t.charAt(p),p++,m===l)g=!0;else{if(":"!==m||t.charAt(p+1)!==u)return;y+=u,p++}for(;p<d&&(m=t.charAt(p),!i(m)&&m!==a);)f+=m,p++;if(m=t.charAt(p),f&&m===a)return!!n||(b=y+=f,o+=y+m,(v=e.now()).column++,v.offset++,g&&(y.slice(0,c).toLowerCase()===h?(b=b.substr(c),v.column+=c,v.offset+=c):y=h+y),w=this.inlineTokenizers,this.inlineTokenizers={text:w.text},x=this.enterLink(),b=this.tokenizeInline(b,v),this.inlineTokenizers=w,x(),e(o)({type:"link",title:null,url:r(y,{nonTerminated:!1}),children:b}))}}}},function(e,t,n){"use strict";var i=n(21),r=n(5),o=n(128);e.exports=m,m.locator=o,m.notInLink=!0;var s="[",a="]",l="(",u=")",h="<",c="@",d="mailto:",p=["http://","https://",d],f=p.length;function m(e,t,n){var o,m,g,y,v,b,w,x,k,C,_,S;if(this.options.gfm){for(o="",y=-1,x=f;++y<x;)if(b=p[y],(w=t.slice(0,b.length)).toLowerCase()===b){o=w;break}if(o){for(y=o.length,x=t.length,k="",C=0;y<x&&(g=t.charAt(y),!r(g)&&g!==h)&&("."!==g&&","!==g&&":"!==g&&";"!==g&&'"'!==g&&"'"!==g&&")"!==g&&"]"!==g||(_=t.charAt(y+1))&&!r(_))&&(g!==l&&g!==s||C++,g!==u&&g!==a||!(--C<0));)k+=g,y++;if(k){if(m=o+=k,b===d){if(-1===(v=k.indexOf(c))||v===x-1)return;m=m.substr(d.length)}return!!n||(S=this.enterLink(),m=this.tokenizeInline(m,e.now()),S(),e(o)({type:"link",title:null,url:i(o,{nonTerminated:!1}),children:m}))}}}}},function(e,t,n){"use strict";e.exports=function(e,t){var n,r=i.length,o=-1,s=-1;if(!this.options.gfm)return-1;for(;++o<r;)-1!==(n=e.indexOf(i[o],t))&&(n<s||-1===s)&&(s=n);return s};var i=["https://","http://","mailto:"]},function(e,t,n){"use strict";var i=n(32),r=n(36),o=n(35).tag;e.exports=l,l.locator=r;var s=/^<a /i,a=/^<\/a>/i;function l(e,t,n){var r,l,u=t.length;if(!("<"!==t.charAt(0)||u<3)&&(r=t.charAt(1),(i(r)||"?"===r||"!"===r||"/"===r)&&(l=t.match(o))))return!!n||(l=l[0],!this.inLink&&s.test(l)?this.inLink=!0:this.inLink&&a.test(l)&&(this.inLink=!1),e(l)({type:"html",value:l}))}},function(e,t,n){"use strict";var i=n(5),r=n(37);e.exports=g,g.locator=r;var o={}.hasOwnProperty,s="\\",a="[",l="]",u="(",h=")",c="<",d=">",p="`",f={'"':'"',"'":"'"},m={};function g(e,t,n){var r,g,y,v,b,w,x,k,C,_,S,M,T,P,A,D,I,E,N,B="",O=0,L=t.charAt(0),R=this.options.pedantic,z=this.options.commonmark,V=this.options.gfm;if("!"===L&&(C=!0,B=L,L=t.charAt(++O)),L===a&&(C||!this.inLink)){for(B+=L,A="",O++,M=t.length,P=0,(I=e.now()).column+=O,I.offset+=O;O<M;){if(w=L=t.charAt(O),L===p){for(g=1;t.charAt(O+1)===p;)w+=L,O++,g++;y?g>=y&&(y=0):y=g}else if(L===s)O++,w+=t.charAt(O);else if(y&&!V||L!==a){if((!y||V)&&L===l){if(!P){if(!R)for(;O<M&&(L=t.charAt(O+1),i(L));)w+=L,O++;if(t.charAt(O+1)!==u)return;w+=u,r=!0,O++;break}P--}}else P++;A+=w,w="",O++}if(r){for(_=A,B+=A+w,O++;O<M&&(L=t.charAt(O),i(L));)B+=L,O++;if(L=t.charAt(O),k=z?m:f,A="",v=B,L===c){for(O++,v+=c;O<M&&(L=t.charAt(O))!==d;){if(z&&"\n"===L)return;A+=L,O++}if(t.charAt(O)!==d)return;B+=c+A+d,D=A,O++}else{for(L=null,w="";O<M&&(L=t.charAt(O),!w||!o.call(k,L));){if(i(L)){if(!R)break;w+=L}else{if(L===u)P++;else if(L===h){if(0===P)break;P--}A+=w,w="",L===s&&(A+=s,L=t.charAt(++O)),A+=L}O++}D=A,O=(B+=A).length}for(A="";O<M&&(L=t.charAt(O),i(L));)A+=L,O++;if(L=t.charAt(O),B+=A,A&&o.call(k,L))if(O++,B+=L,A="",S=k[L],b=B,z){for(;O<M&&(L=t.charAt(O))!==S;)L===s&&(A+=s,L=t.charAt(++O)),O++,A+=L;if((L=t.charAt(O))!==S)return;for(T=A,B+=A+L,O++;O<M&&(L=t.charAt(O),i(L));)B+=L,O++}else for(w="";O<M;){if((L=t.charAt(O))===S)x&&(A+=S+w,w=""),x=!0;else if(x){if(L===h){B+=A+S+w,T=A;break}i(L)?w+=L:(A+=S+w+L,w="",x=!1)}else A+=L;O++}if(t.charAt(O)===h)return!!n||(B+=h,D=this.decode.raw(this.unescape(D),e(v).test().end,{nonTerminated:!1}),T&&(b=e(b).test().end,T=this.decode.raw(this.unescape(T),b)),N={type:C?"image":"link",title:T||null,url:D},C?N.alt=this.decode.raw(this.unescape(_),I)||null:(E=this.enterLink(),N.children=this.tokenizeInline(_,I),E()),e(B)(N))}}}m['"']='"',m["'"]="'",m[u]=h},function(e,t,n){"use strict";var i=n(5),r=n(37),o=n(25);e.exports=g,g.locator=r;var s="link",a="image",l="footnote",u="shortcut",h="collapsed",c="full",d="^",p="\\",f="[",m="]";function g(e,t,n){var r,g,y,v,b,w,x,k,C=t.charAt(0),_=0,S=t.length,M="",T="",P=s,A=u;if("!"===C&&(P=a,T=C,C=t.charAt(++_)),C===f){if(_++,T+=C,w="",this.options.footnotes&&t.charAt(_)===d){if(P===a)return;T+=d,_++,P=l}for(k=0;_<S;){if((C=t.charAt(_))===f)x=!0,k++;else if(C===m){if(!k)break;k--}C===p&&(w+=p,C=t.charAt(++_)),w+=C,_++}if(M=w,r=w,(C=t.charAt(_))===m){for(_++,M+=C,w="";_<S&&(C=t.charAt(_),i(C));)w+=C,_++;if(C=t.charAt(_),P!==l&&C===f){for(g="",w+=C,_++;_<S&&(C=t.charAt(_))!==f&&C!==m;)C===p&&(g+=p,C=t.charAt(++_)),g+=C,_++;(C=t.charAt(_))===m?(A=g?c:h,w+=g+C,_++):g="",M+=w,w=""}else{if(!r)return;g=r}if(A===c||!x)return M=T+M,P===s&&this.inLink?null:!!n||(P===l&&-1!==r.indexOf(" ")?e(M)({type:"footnote",children:this.tokenizeInline(r,e.now())}):((y=e.now()).column+=T.length,y.offset+=T.length,v={type:P+"Reference",identifier:o(g=A===c?g:r)},P!==s&&P!==a||(v.referenceType=A),P===s?(b=this.enterLink(),v.children=this.tokenizeInline(r,y),b()):P===a&&(v.alt=this.decode.raw(this.unescape(r),y)||null),e(M)(v)))}}}},function(e,t,n){"use strict";var i=n(12),r=n(5),o=n(133);e.exports=l,l.locator=o;var s="*",a="_";function l(e,t,n){var o,l,u,h,c,d,p,f=0,m=t.charAt(f);if(!(m!==s&&m!==a||t.charAt(++f)!==m||(l=this.options.pedantic,c=(u=m)+u,d=t.length,f++,h="",m="",l&&r(t.charAt(f)))))for(;f<d;){if(p=m,!((m=t.charAt(f))!==u||t.charAt(f+1)!==u||l&&r(p))&&(m=t.charAt(f+2))!==u){if(!i(h))return;return!!n||((o=e.now()).column+=2,o.offset+=2,e(c+h+c)({type:"strong",children:this.tokenizeInline(h,o)}))}l||"\\"!==m||(h+=m,m=t.charAt(++f)),h+=m,f++}}},function(e,t,n){"use strict";e.exports=function(e,t){var n=e.indexOf("**",t),i=e.indexOf("__",t);if(-1===i)return n;if(-1===n)return i;return i<n?i:n}},function(e,t,n){"use strict";var i=n(12),r=n(135),o=n(5),s=n(136);e.exports=u,u.locator=s;var a="*",l="_";function u(e,t,n){var s,u,h,c,d,p,f,m=0,g=t.charAt(m);if(!(g!==a&&g!==l||(u=this.options.pedantic,d=g,h=g,p=t.length,m++,c="",g="",u&&o(t.charAt(m)))))for(;m<p;){if(f=g,!((g=t.charAt(m))!==h||u&&o(f))){if((g=t.charAt(++m))!==h){if(!i(c)||f===h)return;if(!u&&h===l&&r(g)){c+=h;continue}return!!n||((s=e.now()).column++,s.offset++,e(d+c+h)({type:"emphasis",children:this.tokenizeInline(c,s)}))}c+=h}u||"\\"!==g||(c+=g,g=t.charAt(++m)),c+=g,m++}}},function(e,t,n){"use strict";e.exports=function(e){return r.test("number"==typeof e?i(e):e.charAt(0))};var i=String.fromCharCode,r=/\w/},function(e,t,n){"use strict";e.exports=function(e,t){var n=e.indexOf("*",t),i=e.indexOf("_",t);if(-1===i)return n;if(-1===n)return i;return i<n?i:n}},function(e,t,n){"use strict";var i=n(5),r=n(138);e.exports=a,a.locator=r;var o="~",s="~~";function a(e,t,n){var r,a,l,u="",h="",c="",d="";if(this.options.gfm&&t.charAt(0)===o&&t.charAt(1)===o&&!i(t.charAt(2)))for(r=1,a=t.length,(l=e.now()).column+=2,l.offset+=2;++r<a;){if(!((u=t.charAt(r))!==o||h!==o||c&&i(c)))return!!n||e(s+d+s)({type:"delete",children:this.tokenizeInline(d,l)});d+=h,c=h,h=u}}},function(e,t,n){"use strict";e.exports=function(e,t){return e.indexOf("~~",t)}},function(e,t,n){"use strict";var i=n(5),r=n(140);e.exports=s,s.locator=r;var o="`";function s(e,t,n){for(var r,s,a,l,u,h,c,d,p=t.length,f=0,m="",g="";f<p&&t.charAt(f)===o;)m+=o,f++;if(m){for(u=m,l=f,m="",d=t.charAt(f),a=0;f<p;){if(h=d,d=t.charAt(f+1),h===o?(a++,g+=h):(a=0,m+=h),a&&d!==o){if(a===l){u+=m+g,c=!0;break}m+=g,g=""}f++}if(!c){if(l%2!=0)return;m=""}if(n)return!0;for(r="",s="",p=m.length,f=-1;++f<p;)h=m.charAt(f),i(h)?s+=h:(s&&(r&&(r+=s),s=""),r+=h);return e(u)({type:"inlineCode",value:r})}}},function(e,t,n){"use strict";e.exports=function(e,t){return e.indexOf("`",t)}},function(e,t,n){"use strict";var i=n(142);e.exports=o,o.locator=i;var r=2;function o(e,t,n){for(var i,o=t.length,s=-1,a="";++s<o;){if("\n"===(i=t.charAt(s))){if(s<r)return;return!!n||e(a+=i)({type:"break"})}if(" "!==i)return;a+=i}}},function(e,t,n){"use strict";e.exports=function(e,t){var n=e.indexOf("\n",t);for(;n>t&&" "===e.charAt(n-1);)n--;return n}},function(e,t,n){"use strict";e.exports=function(e,t,n){var i,r,o,s,a,l,u,h,c,d;if(n)return!0;i=this.inlineMethods,s=i.length,r=this.inlineTokenizers,o=-1,c=t.length;for(;++o<s;)"text"!==(h=i[o])&&r[h]&&((u=r[h].locator)||e.file.fail("Missing locator: `"+h+"`"),-1!==(l=u.call(this,t,1))&&l<c&&(c=l));a=t.slice(0,c),d=e.now(),this.decode(a,d,function(t,n,i){e(i||t)({type:"text",value:t})})}},function(e,t,n){const{noop:i}=n(1);e.exports={arrayOf:i,oneOf:i,oneOfType:i}},function(e,t,n){var i=n(146);e.exports=function(){return function(e){return i(e,"list",function(e,t){var n,i,r=0;for(n=0,i=t.length;n<i;n++)"list"===t[n].type&&(r+=1);for(n=0,i=e.children.length;n<i;n++){var o=e.children[n];o.index=n,o.ordered=e.ordered}e.depth=r}),e}}},function(e,t,n){"use strict";e.exports=function(e,t,n){var i=[];"function"==typeof t&&(n=t,t=null);function r(e){var o;return t&&e.type!==t||(o=n(e,i.concat())),e.children&&!1!==o?function(e,t){var n,o=e.length,s=-1;i.push(t);for(;++s<o;)if((n=e[s])&&!1===r(n))return!1;return i.pop(),!0}(e.children,e):o}r(e)}},function(e,t,n){"use strict";var i=n(19),r="virtualHtml",o=/^<(area|base|br|col|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)\s*\/?>$/i,s=/^<(\/?)([a-z]+)\s*>$/;e.exports=function(e){var t=void 0,n=void 0;return i(e,"html",function(e,i,a){n!==a&&(t=[],n=a);var l=function(e){var t=e.value.match(o);return!!t&&t[1]}(e);if(l)return a.children.splice(i,1,{type:r,tag:l,position:e.position}),!0;var u=function(e,t){var n=e.value.match(s);return!!n&&{tag:n[2],opening:!n[1],node:e}}(e);if(!u)return!0;var h=function(e,t){var n=e.length;for(;n--;)if(e[n].tag===t)return e.splice(n,1)[0];return!1}(t,u.tag);return h?a.children.splice(i,0,function(e,t,n){var i=n.children.indexOf(e.node),o=n.children.indexOf(t.node),s=n.children.splice(i,o-i+1).slice(1,-1);return{type:r,children:s,tag:e.tag,position:{start:e.node.position.start,end:t.node.position.end,indent:[]}}}(u,h,a)):u.opening||t.push(u),!0},!0),e}},function(e,t,n){"use strict";var i=n(19);function r(e,t,n,i){if("remove"===i)n.children.splice(t,1);else if("unwrap"===i){var r=[t,1];e.children&&(r=r.concat(e.children)),Array.prototype.splice.apply(n.children,r)}}t.ofType=function(e,t){return function(t){return e.forEach(function(e){return i(t,e,n,!0)}),t};function n(e,n,i){i&&r(e,n,i,t)}},t.ifNotMatch=function(e,t){return function(e){return i(e,n,!0),e};function n(n,i,o){o&&!e(n,i,o)&&r(n,i,o,t)}}},function(e,t,n){"use strict";var i=n(0),r=n(9);function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=t.renderers[e.type],u=e.position.start,h=[e.type,u.line,u.column].join("-");if("text"===e.type)return l?l(e.value,h):e.value;if("function"!=typeof l&&"string"!=typeof l&&!function(e){return i.Fragment&&i.Fragment===e}(l))throw new Error("Renderer for type `"+e.type+"` not defined or is not renderable");var c=function(e,t,n,i,a,l){var u={key:t},h="string"==typeof i;n.sourcePos&&e.position&&(u["data-sourcepos"]=[(c=e.position).start.line,":",c.start.column,"-",c.end.line,":",c.end.column].map(String).join(""));var c;n.rawSourcePos&&!h&&(u.sourcePosition=e.position);n.includeNodeIndex&&a.node&&a.node.children&&!h&&(u.index=a.node.children.indexOf(e),u.parentChildCount=a.node.children.length);var d=null!==e.identifier&&void 0!==e.identifier?n.definitions[e.identifier]||{}:null;switch(e.type){case"root":s(u,{className:n.className});break;case"heading":u.level=e.depth;break;case"list":u.start=e.start,u.ordered=e.ordered,u.tight=!e.loose,u.depth=e.depth;break;case"listItem":u.checked=e.checked,u.tight=!e.loose,u.ordered=e.ordered,u.index=e.index,u.children=(u.tight?function(e){return e.children.reduce(function(e,t){return e.concat("paragraph"===t.type?t.children||[]:[t])},[])}(e):e.children).map(function(t,i){return o(t,n,{node:e,props:u},i)});break;case"definition":s(u,{identifier:e.identifier,title:e.title,url:e.url});break;case"code":s(u,{language:e.lang&&e.lang.split(/\s/,1)[0]});break;case"inlineCode":u.children=e.value,u.inline=!0;break;case"link":s(u,{title:e.title||void 0,target:"function"==typeof n.linkTarget?n.linkTarget(e.url,e.children,e.title):n.linkTarget,href:n.transformLinkUri?n.transformLinkUri(e.url,e.children,e.title):e.url});break;case"image":s(u,{alt:e.alt||void 0,title:e.title||void 0,src:n.transformImageUri?n.transformImageUri(e.url,e.children,e.title,e.alt):e.url});break;case"linkReference":s(u,r(d,{href:n.transformLinkUri?n.transformLinkUri(d.href):d.href}));break;case"imageReference":s(u,{src:n.transformImageUri&&d.href?n.transformImageUri(d.href,e.children,d.title,e.alt):d.href,title:d.title||void 0,alt:e.alt||void 0});break;case"table":case"tableHead":case"tableBody":u.columnAlignment=e.align;break;case"tableRow":u.isHeader="tableHead"===a.node.type,u.columnAlignment=a.props.columnAlignment;break;case"tableCell":s(u,{isHeader:a.props.isHeader,align:a.props.columnAlignment[l]});break;case"virtualHtml":u.tag=e.tag;break;case"html":u.isBlock=e.position.start.line!==e.position.end.line,u.escapeHtml=n.escapeHtml,u.skipHtml=n.skipHtml;break;default:s(u,r(e,{type:void 0,position:void 0,children:void 0}))}!h&&e.value&&(u.value=e.value);return u}(e,h,t,l,n,a);return i.createElement(l,c,c.children||e.children&&e.children.map(function(n,i){return o(n,t,{node:e,props:c},i)})||void 0)}function s(e,t){for(var n in t)void 0!==t[n]&&(e[n]=t[n])}e.exports=o},function(e,t,n){"use strict";var i=n(19);function r(e){var t=e.children;e.children=[{type:"tableHead",align:e.align,children:[t[0]],position:t[0].position}],t.length>1&&e.children.push({type:"tableBody",align:e.align,children:t.slice(1),position:{start:t[1].position.start,end:t[t.length-1].position.end}})}e.exports=function(e){return i(e,"table",r),e}},function(e,t,n){"use strict";e.exports=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(t.children||[]).reduce(function(t,n){return"definition"===n.type&&(t[n.identifier]={href:n.url,title:n.title}),e(n,t)},n)}},function(e,t,n){"use strict";var i=["http","https","mailto","tel"];e.exports=function(e){var t=(e||"").trim(),n=t.charAt(0);if("#"===n||"/"===n)return t;var r=t.indexOf(":");if(-1===r)return t;for(var o=i.length,s=-1;++s<o;){var a=i[s];if(r===a.length&&t.slice(0,a.length)===a)return t}return-1!==(s=t.indexOf("?"))&&r>s?t:-1!==(s=t.indexOf("#"))&&r>s?t:"javascript:void(0)"}},function(e,t,n){"use strict";var i=n(9),r=n(0).createElement;function o(e,t){return r(e,s(t),t.children)}function s(e){return e["data-sourcepos"]?{"data-sourcepos":e["data-sourcepos"]}:{}}e.exports={root:"div",break:"br",paragraph:"p",emphasis:"em",strong:"strong",thematicBreak:"hr",blockquote:"blockquote",delete:"del",link:"a",image:"img",linkReference:"a",imageReference:"img",table:o.bind(null,"table"),tableHead:o.bind(null,"thead"),tableBody:o.bind(null,"tbody"),tableRow:o.bind(null,"tr"),tableCell:function(e){var t=e.align?{textAlign:e.align}:void 0,n=s(e);return r(e.isHeader?"th":"td",t?i({style:t},n):n,e.children)},list:function(e){var t=s(e);null!==e.start&&1!==e.start&&(t.start=e.start.toString());return r(e.ordered?"ol":"ul",t,e.children)},listItem:function(e){var t=null;if(null!==e.checked){var n=e.checked;t=r("input",{type:"checkbox",checked:n,readOnly:!0})}return r("li",s(e),t,e.children)},definition:function(){return null},heading:function(e){return r("h"+e.level,s(e),e.children)},inlineCode:function(e){return r("code",s(e),e.children)},code:function(e){var t=e.language&&"language-"+e.language,n=r("code",t?{className:t}:null,e.value);return r("pre",s(e),n)},html:function(e){if(e.skipHtml)return null;var t=e.isBlock?"div":"span";if(e.escapeHtml)return r(t,null,e.value);var n={dangerouslySetInnerHTML:{__html:e.value}};return r(t,n)},virtualHtml:function(e){return r(e.tag,s(e),e.children)}}},function(e,t,n){const{remote:i,shell:r}=n(4),{h:o,Component:s}=n(0),a=n(3).context("ContentDisplay"),l=n(6),u=i.require("./setting");function h(e){let t="\\b(ht|f)tps?:\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s](\\/\\B|\\b)",n="\\b[^\\s@<]+@[^\\s@<]+\\b",i="\\b(black\\s+?|white\\s+?|[bw]\\s*)(([a-hj-z]\\d+[ ]+)+[a-hj-z]\\d+)\\b",r="\\b[a-hj-z]\\d+\\b",o="(\\B#|\\bmove[ ]+)(\\d+)\\b",s="("+[t,n,i,r,o].join("|")+")";return e=e.replace(new RegExp(s,"gi"),e=>{let s;return new RegExp(t,"i").test(e)?`<a href="${e}" class="comment-external">${e}</a>`:new RegExp(n,"i").test(e)?`<a href="mailto:${e}" class="comment-external">${e}</a>`:(s=new RegExp(i,"i").exec(e))?`<span\n                class="comment-variation"\n                data-color="${s[1]?s[1][0].toLowerCase():""}"\n                data-variation="${s[2]}"\n            >${e}</span>`:new RegExp(r,"i").test(e)?`<span class="comment-coord">${e}</span>`:(s=new RegExp(o,"i").exec(e))?`<a\n                href="#"\n                class="comment-movenumber"\n                title="${a("Jump to Move Number")}"\n                data-movenumber="${s[2]}"\n            >${e}</a>`:void 0})}e.exports=class extends s{constructor(e){super(e),this.handleLinkClick=(e=>{let t=e.currentTarget;if(t.classList.contains("comment-external"))e.preventDefault(),r.openExternal(t.href);else if(t.classList.contains("comment-movenumber")){e.preventDefault();let n=+t.dataset.movenumber;sabaki.goToMainVariation(),sabaki.goToMoveNumber(n)}});let t=e=>{let{gameTrees:t,gameIndex:n,treePosition:i}=sabaki.state,r=l.getBoard(t[n],i),o=r.currentVertex,s=o&&r.get(o),{color:a}=e.dataset,u=""===a?sabaki.getPlayer(...i):"b"===a?1:-1;return{sign:u,variation:e.dataset.variation.split(/\s+/).map(e=>r.coord2vertex(e)),sibling:s===u}};this.handleVariationMouseEnter=(e=>{let{currentTarget:n}=e,{sign:i,variation:r,sibling:o}=t(n),s=1;sabaki.setState({playVariation:{sign:i,variation:r,sibling:o}}),u.get("board.variation_instant_replay")?n.style.backgroundSize="100% 100%":(clearInterval(this.variationIntervalId),this.variationIntervalId=setInterval(()=>{if(s>=r.length)return void clearInterval(this.variationIntervalId);let e=100*s/(r.length-1);n.style.backgroundSize=`${e}% 100%`,s++},u.get("board.variation_replay_interval")))}),this.handleVariationMouseLeave=(e=>{sabaki.setState({playVariation:null}),clearInterval(this.variationIntervalId),e.currentTarget.style.backgroundSize=""}),this.handleVariationMouseUp=(e=>{if(2!==e.button)return;let{sign:n,variation:i,sibling:r}=t(e.currentTarget);sabaki.openVariationMenu(n,i,{x:e.clientX,y:e.clientY,appendSibling:r})}),this.handleCoordMouseEnter=(e=>{let{gameTrees:t,gameIndex:n,treePosition:i}=sabaki.state,r=l.getBoard(t[n],i).coord2vertex(e.currentTarget.innerText);sabaki.setState({highlightVertices:[r]})}),this.handleCoordMouseLeave=(e=>{sabaki.setState({highlightVertices:[]})})}componentDidMount(){this.componentDidUpdate()}componentDidUpdate(){for(let e of this.element.querySelectorAll("a"))e.addEventListener("click",this.handleLinkClick);for(let e of this.element.querySelectorAll(".comment-variation"))e.addEventListener("mouseenter",this.handleVariationMouseEnter),e.addEventListener("mouseleave",this.handleVariationMouseLeave),e.addEventListener("mouseup",this.handleVariationMouseUp);for(let e of this.element.querySelectorAll(".comment-coord"))e.addEventListener("mouseenter",this.handleCoordMouseEnter),e.addEventListener("mouseleave",this.handleCoordMouseLeave)}render({tag:e,content:t,children:n}){return null!=t?o(e,Object.assign({ref:e=>this.element=e,dangerouslySetInnerHTML:{__html:h(t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))}},this.props)):o(e,Object.assign({ref:e=>this.element=e},this.props),n)}}},function(e,t,n){const{h:i,Component:r}=n(0),o=n(6),s=n(156),a=n(158),l=n(7),u=n(159),h=n(7),c=n(7);e.exports=class extends r{constructor(){super(),this.handleScoreSubmit=(({resultString:e})=>{this.props.rootTree.nodes[0].RE=[e],sabaki.closeDrawer(),setTimeout(()=>sabaki.setMode("play"),500)}),this.handleGameSelect=(({selectedTree:e})=>{sabaki.closeDrawer(),sabaki.setMode("play"),sabaki.setCurrentTreePosition(e,e.root.id)}),this.handleGameTreesChange=(e=>{let t=e.gameTrees,{gameTrees:n,gameCurrents:i,gameIndex:r}=this.props,o=n[r],s=t.findIndex(e=>e.root.id===o.root.id);s<0&&(0===t.length&&(t=[sabaki.getEmptyGameTree()]),s=Math.min(Math.max(r-1,0),t.length-1),o=t[s]),sabaki.setState({gameTrees:t,gameCurrents:t.map((e,t)=>{let r=n.findIndex(t=>t.root.id===e.root.id);return r<0?{}:i[r]})}),sabaki.setCurrentTreePosition(o,o.root.id)})}render({mode:e,openDrawer:t,gameTree:n,gameTrees:r,gameIndex:d,treePosition:p,gameInfo:f,currentPlayer:m,scoringMethod:g,scoreBoard:y,areaMap:v,engines:b,attachedEngines:w,graphGridSize:x,preferencesTab:k}){return i("section",{},i(s,{show:"info"===t,engines:w,gameTree:n,gameInfo:f,currentPlayer:m}),i(l,{show:"preferences"===t,tab:k,engines:b,graphGridSize:x}),i(u,{show:"gamechooser"===t,gameTrees:r,gameIndex:d,onItemClick:this.handleGameSelect,onChange:this.handleGameTreesChange}),i(h,{show:"cleanmarkup"===t,gameTree:n,treePosition:p}),i(c,{show:"advancedproperties"===t,gameTree:n,treePosition:p}),i(a,{show:"score"===t,estimating:"estimator"===e,areaMap:v,board:y,method:g,komi:+o.getRootProperty(n,"KM",0),handicap:+o.getRootProperty(n,"HA",0),onSubmitButtonClick:this.handleScoreSubmit}))}}},function(e,t,n){const{remote:i}=n(4),{h:r,Component:o}=n(0),s=(n(2),n(157)),a=n(8),l=n(26),u=n(3).context("InfoDrawer"),h=n(1),c=i.require("./setting");class d extends o{render({title:e,children:t}){return r("li",{},r("label",{},r("span",{},e+":"),t[0]),t.slice(1))}}e.exports=class extends o{constructor(){super(),this.handleSubmitButtonClick=(async e=>{e.preventDefault();let t=0===this.props.gameTree.root.children.length,n=["blackName","blackRank","whiteName","whiteRank","gameName","eventName","date","result","komi"].reduce((e,t)=>(e[t]=Array.isArray(this.state[t])&&this.state[t].every(e=>null==e)?null:this.state[t],e),{});t&&(n.handicap=this.state.handicap,n.size=this.state.size),sabaki.setGameInfo(this.props.gameTree,n),sabaki.closeDrawer(),sabaki.attachEngines(...this.state.engines),await sabaki.waitForRender();let i=this.props.currentPlayer>0?0:1;c.get("gtp.start_game_after_attach")&&null!=sabaki.attachedEngineSyncers[i]&&sabaki.generateMove({followUp:!0})}),this.handleCancelButtonClick=(e=>{e.preventDefault(),sabaki.closeDrawer()}),this.handleBoardWidthFocus=(()=>{this.combinedSizeFields=this.state.size[0]===this.state.size[1]}),this.handleBoardWidthChange=(e=>{let{value:t}=e.currentTarget;t=""===t||isNaN(t)?null:+t,this.setState(({size:[,e]})=>({size:[t,this.combinedSizeFields?t:e]}))}),this.handleBoardHeightChange=(e=>{let{value:t}=e.currentTarget;t=""===t||isNaN(t)?null:+t,this.setState(({size:[e]})=>({size:[e,t]}))}),this.handleSizeSwapButtonClick=(()=>{this.setState(({size:e})=>({size:e.reverse()}))}),this.handleSwapPlayers=(()=>{this.setState(({engines:e,blackName:t,blackRank:n,whiteName:i,whiteRank:r})=>({engines:(e||[null,null]).reverse(),blackName:i,whiteName:t,blackRank:r,whiteRank:n}))}),this.handleDateInputChange=(e=>{this.setState({date:e.currentTarget.value}),this.markDates()}),this.handleDateInputFocus=(()=>{this.pikaday.show()}),this.handleDateInputBlur=(()=>{setTimeout(()=>{this.elementInPikaday(document.activeElement)||this.pikaday.hide()},50)}),this.handleShowResultClick=(()=>{this.setState({showResult:!0})}),this.handleInputChange=["blackRank","blackName","whiteRank","whiteName","gameName","eventName","komi","result","handicap"].reduce((e,t)=>(e[t]=(({currentTarget:e})=>{this.setState({[t]:""===e.value?null:e.value})}),e),{}),this.handleEngineMenuClick=[0,1].map(e=>t=>{let n=c.get("engines.list"),i=["blackName","whiteName"][e],r=null==this.state.engines[e]?null==this.state[i]:this.state[i]===this.state.engines[e].name.trim(),o=[{label:u("Manual"),type:"checkbox",checked:null==this.state.engines[e],click:()=>{let{engines:t}=this.state;null!=t[e]&&(t[e]=null,this.setState({engines:t,[i]:r?null:this.state[i]}))}},{type:"separator"},...n.map(t=>({label:t.name.trim()||u("(Unnamed Engine)"),type:"checkbox",checked:t===this.state.engines[e],click:()=>{let{engines:n}=this.state;n[e]=t,this.setState({engines:n,[i]:r?t.name.trim():this.state[i]})}})),n.length>0&&{type:"separator"},{label:u("Manage Engines…"),click:()=>{sabaki.setState({preferencesTab:"engines"}),sabaki.openDrawer("preferences")}}].filter(e=>!!e),{left:s,bottom:a}=t.currentTarget.getBoundingClientRect();h.popupMenu(o,s,a)})}componentWillReceiveProps({gameInfo:e,engines:t,show:n}){!this.props.show&&n&&this.setState(Object.assign({},e,{engines:[...t],showResult:!e.result||""===e.result.trim()||!0===c.get("app.always_show_result")}))}componentDidMount(){this.preparePikaday()}componentDidUpdate(e){!e.show&&this.props.show&&this.firstFocusElement.focus()}shouldComponentUpdate({show:e}){return e!==this.props.show||e}markDates(){let e=(a.parseDates(this.state.date||"")||[]).filter(e=>3===e.length);for(let t of this.pikaday.el.querySelectorAll(".pika-button")){let n=+t.dataset.pikaYear,i=+t.dataset.pikaMonth,r=+t.dataset.pikaDay;t.parentElement.classList.toggle("is-multi-selected",e.some(e=>h.shallowEquals(e,[n,i+1,r])))}}adjustPikadayPosition(){let{left:e,top:t}=this.dateInputElement.getBoundingClientRect(),{el:n}=this.pikaday,{height:i}=n.getBoundingClientRect();n.style.position="absolute",n.style.left=Math.round(e)+"px",n.style.top=Math.round(t-i)+"px"}elementInPikaday(e){for(;e.parentElement;){if(e===this.pikaday.el)return!0;e=e.parentElement}return!1}preparePikaday(){this.pikaday=new s({position:"top left",firstDay:1,yearRange:6,keyboardInput:!1,i18n:{previousMonth:u("Previous Month"),nextMonth:u("Next Month"),months:[u("January"),u("February"),u("March"),u("April"),u("May"),u("June"),u("July"),u("August"),u("September"),u("October"),u("November"),u("December")],weekdays:[u("Sunday"),u("Monday"),u("Tuesday"),u("Wednesday"),u("Thursday"),u("Friday"),u("Saturday")],weekdaysShort:[u("Sun"),u("Mon"),u("Tue"),u("Wed"),u("Thu"),u("Fri"),u("Sat")]},onOpen:()=>{if(!this.pikaday)return;let e=(a.parseDates(this.state.date||"")||[]).filter(e=>3===e.length);e.length>0?this.pikaday.setDate(e[0].join("-"),!0):this.pikaday.gotoToday(),this.adjustPikadayPosition()},onDraw:()=>{this.pikaday&&this.pikaday.isVisible()&&(this.adjustPikadayPosition(),this.markDates(),this.dateInputElement.focus())},onSelect:e=>{if(!this.pikaday)return;let t=a.parseDates(this.state.date||"")||[];e=[e.getFullYear(),e.getMonth()+1,e.getDate()],t.some(t=>h.shallowEquals(t,e))?t=t.filter(t=>!h.shallowEquals(t,e)):t.push(e),this.setState({date:a.stringifyDates(t.sort(h.lexicalCompare))}),this.markDates()}}),document.removeEventListener("keydown",this.pikaday._onKeyChange),this.pikaday.hide(),document.body.appendChild(this.pikaday.el),document.body.addEventListener("click",e=>{this.pikaday.isVisible()&&document.activeElement!==this.dateInputElement&&e.target!==this.dateInputElement&&!this.elementInPikaday(e.target)&&this.pikaday.hide()}),window.addEventListener("resize",()=>this.adjustPikadayPosition())}render({gameTree:e,currentPlayer:t,show:n},{showResult:i=!1,engines:o=[null,null],blackName:s=null,blackRank:a=null,whiteName:c=null,whiteRank:p=null,gameName:f=null,eventName:m=null,date:g=null,result:y=null,komi:v=null,handicap:b=0,size:w=[null,null]}){let x=0===e.root.children.length;return r(l,{type:"info",show:n},r("form",{},r("section",{},r("span",{},r("input",{type:"text",name:"rank_1",placeholder:u("Rank"),value:a,onInput:this.handleInputChange.blackRank}),r("input",{ref:e=>this.firstFocusElement=e,type:"text",name:"name_1",placeholder:u("Black"),value:s,onInput:this.handleInputChange.blackName})),r("img",{class:"current-player",src:`/static/img/ui/player_${t}.svg`,height:31,title:u("Swap"),onClick:this.handleSwapPlayers}),r("span",{},r("input",{type:"text",name:"name_-1",placeholder:u("White"),value:c,onInput:this.handleInputChange.whiteName}),r("input",{type:"text",name:"rank_-1",placeholder:u("Rank"),value:p,onInput:this.handleInputChange.whiteRank})," ")),r("ul",{},r(d,{title:u("Name")},r("input",{type:"text",placeholder:u("(Unnamed)"),value:f,onInput:this.handleInputChange.gameName})),r(d,{title:u("Event")},r("input",{type:"text",placeholder:u("None"),value:m,onInput:this.handleInputChange.eventName})),r(d,{title:u("Date")},r("input",{ref:e=>this.dateInputElement=e,type:"text",placeholder:u("None"),value:g,onFocus:this.handleDateInputFocus,onBlur:this.handleDateInputBlur,onInput:this.handleDateInputChange})),r(d,{title:u("Komi")},r("input",{type:"number",name:"komi",step:.5,placeholder:0,value:null==v?"":v,onInput:this.handleInputChange.komi})),r(d,{title:u("Result")},i?r("input",{type:"text",placeholder:u("None"),value:y,onInput:this.handleInputChange.result}):r("button",{type:"button",onClick:this.handleShowResultClick},u("Show"))),r(d,{title:u("Handicap")},r("select",{selectedIndex:Math.max(0,b-1),disabled:!x,onChange:this.handleInputChange.handicap},r("option",{value:0},u("No stones")),[...Array(8)].map((e,t)=>r("option",{value:t+2},u(e=>`${e.stones} stones`,{stones:t+2}))))),r(d,{title:u("Board Size")},r("input",{type:"number",name:"size-width",placeholder:19,max:25,min:2,value:w[0],disabled:!x,onFocus:this.handleBoardWidthFocus,onInput:this.handleBoardWidthChange})," ",r("span",{title:u("Swap"),style:{cursor:x?"pointer":"default"},onClick:x?this.handleSizeSwapButtonClick:h.noop},"×")," ",r("input",{type:"number",name:"size-height",placeholder:19,max:25,min:3,value:w[1],disabled:!x,onInput:this.handleBoardHeightChange}))),r("p",{},r("button",{type:"submit",onClick:this.handleSubmitButtonClick},u("OK"))," ",r("button",{type:"reset",onClick:this.handleCancelButtonClick},u("Cancel")))))}}},function(e,t,n){
/*!
 * Pikaday
 *
 * Copyright © 2014 David Bushell | BSD & MIT license | https://github.com/Pikaday/Pikaday
 */
!function(t,i){"use strict";var r;try{r=n(13)}catch(e){}e.exports=function(e){var t="function"==typeof e,n=!!window.addEventListener,i=window.document,r=window.setTimeout,o=function(e,t,i,r){n?e.addEventListener(t,i,!!r):e.attachEvent("on"+t,i)},s=function(e,t,i,r){n?e.removeEventListener(t,i,!!r):e.detachEvent("on"+t,i)},a=function(e,t){return-1!==(" "+e.className+" ").indexOf(" "+t+" ")},l=function(e,t){a(e,t)||(e.className=""===e.className?t:e.className+" "+t)},u=function(e,t){var n;e.className=(n=(" "+e.className+" ").replace(" "+t+" "," ")).trim?n.trim():n.replace(/^\s+|\s+$/g,"")},h=function(e){return/Array/.test(Object.prototype.toString.call(e))},c=function(e){return/Date/.test(Object.prototype.toString.call(e))&&!isNaN(e.getTime())},d=function(e){var t=e.getDay();return 0===t||6===t},p=function(e){return e%4==0&&e%100!=0||e%400==0},f=function(e,t){return[31,p(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},m=function(e){c(e)&&e.setHours(0,0,0,0)},g=function(e,t){return e.getTime()===t.getTime()},y=function(e,t,n){var i,r;for(i in t)(r=void 0!==e[i])&&"object"==typeof t[i]&&null!==t[i]&&void 0===t[i].nodeName?c(t[i])?n&&(e[i]=new Date(t[i].getTime())):h(t[i])?n&&(e[i]=t[i].slice(0)):e[i]=y({},t[i],n):!n&&r||(e[i]=t[i]);return e},v=function(e,t,n){var r;i.createEvent?((r=i.createEvent("HTMLEvents")).initEvent(t,!0,!1),r=y(r,n),e.dispatchEvent(r)):i.createEventObject&&(r=i.createEventObject(),r=y(r,n),e.fireEvent("on"+t,r))},b=function(e){return e.month<0&&(e.year-=Math.ceil(Math.abs(e.month)/12),e.month+=12),e.month>11&&(e.year+=Math.floor(Math.abs(e.month)/12),e.month-=12),e},w={field:null,bound:void 0,ariaLabel:"Use the arrow keys to pick a date",position:"bottom left",reposition:!0,format:"YYYY-MM-DD",toString:null,parse:null,defaultDate:null,setDefaultDate:!1,firstDay:0,formatStrict:!1,minDate:null,maxDate:null,yearRange:10,showWeekNumber:!1,pickWholeWeek:!1,minYear:0,maxYear:9999,minMonth:void 0,maxMonth:void 0,startRange:null,endRange:null,isRTL:!1,yearSuffix:"",showMonthAfterYear:!1,showDaysInNextAndPreviousMonths:!1,enableSelectionDaysInNextAndPreviousMonths:!1,numberOfMonths:1,mainCalendar:"left",container:void 0,blurFieldOnSelect:!0,i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},theme:null,events:[],onSelect:null,onOpen:null,onClose:null,onDraw:null,keyboardInput:!0},x=function(e,t,n){for(t+=e.firstDay;t>=7;)t-=7;return n?e.i18n.weekdaysShort[t]:e.i18n.weekdays[t]},k=function(e){var t=[],n="false";if(e.isEmpty){if(!e.showDaysInNextAndPreviousMonths)return'<td class="is-empty"></td>';t.push("is-outside-current-month"),e.enableSelectionDaysInNextAndPreviousMonths||t.push("is-selection-disabled")}return e.isDisabled&&t.push("is-disabled"),e.isToday&&t.push("is-today"),e.isSelected&&(t.push("is-selected"),n="true"),e.hasEvent&&t.push("has-event"),e.isInRange&&t.push("is-inrange"),e.isStartRange&&t.push("is-startrange"),e.isEndRange&&t.push("is-endrange"),'<td data-day="'+e.day+'" class="'+t.join(" ")+'" aria-selected="'+n+'"><button class="pika-button pika-day" type="button" data-pika-year="'+e.year+'" data-pika-month="'+e.month+'" data-pika-day="'+e.day+'">'+e.day+"</button></td>"},C=function(e,t,n,i){return'<tr class="pika-row'+(n?" pick-whole-week":"")+(i?" is-selected":"")+'">'+(t?e.reverse():e).join("")+"</tr>"},_=function(e,t,n,i,r,o){var s,a,l,u,c,d=e._o,p=n===d.minYear,f=n===d.maxYear,m='<div id="'+o+'" class="pika-title" role="heading" aria-live="assertive">',g=!0,y=!0;for(l=[],s=0;s<12;s++)l.push('<option value="'+(n===r?s-t:12+s-t)+'"'+(s===i?' selected="selected"':"")+(p&&s<d.minMonth||f&&s>d.maxMonth?'disabled="disabled"':"")+">"+d.i18n.months[s]+"</option>");for(u='<div class="pika-label">'+d.i18n.months[i]+'<select class="pika-select pika-select-month" tabindex="-1">'+l.join("")+"</select></div>",h(d.yearRange)?(s=d.yearRange[0],a=d.yearRange[1]+1):(s=n-d.yearRange,a=1+n+d.yearRange),l=[];s<a&&s<=d.maxYear;s++)s>=d.minYear&&l.push('<option value="'+s+'"'+(s===n?' selected="selected"':"")+">"+s+"</option>");return c='<div class="pika-label">'+n+d.yearSuffix+'<select class="pika-select pika-select-year" tabindex="-1">'+l.join("")+"</select></div>",d.showMonthAfterYear?m+=c+u:m+=u+c,p&&(0===i||d.minMonth>=i)&&(g=!1),f&&(11===i||d.maxMonth<=i)&&(y=!1),0===t&&(m+='<button class="pika-prev'+(g?"":" is-disabled")+'" type="button">'+d.i18n.previousMonth+"</button>"),t===e._o.numberOfMonths-1&&(m+='<button class="pika-next'+(y?"":" is-disabled")+'" type="button">'+d.i18n.nextMonth+"</button>"),m+="</div>"},S=function(s){var l=this,u=l.config(s);l._onMouseDown=function(e){if(l._v){var t=(e=e||window.event).target||e.srcElement;if(t)if(a(t,"is-disabled")||(!a(t,"pika-button")||a(t,"is-empty")||a(t.parentNode,"is-disabled")?a(t,"pika-prev")?l.prevMonth():a(t,"pika-next")&&l.nextMonth():(l.setDate(new Date(t.getAttribute("data-pika-year"),t.getAttribute("data-pika-month"),t.getAttribute("data-pika-day"))),u.bound&&r(function(){l.hide(),u.blurFieldOnSelect&&u.field&&u.field.blur()},100))),a(t,"pika-select"))l._c=!0;else{if(!e.preventDefault)return e.returnValue=!1,!1;e.preventDefault()}}},l._onChange=function(e){var t=(e=e||window.event).target||e.srcElement;t&&(a(t,"pika-select-month")?l.gotoMonth(t.value):a(t,"pika-select-year")&&l.gotoYear(t.value))},l._onKeyChange=function(e){if(e=e||window.event,l.isVisible())switch(e.keyCode){case 13:case 27:u.field&&u.field.blur();break;case 37:e.preventDefault(),l.adjustDate("subtract",1);break;case 38:l.adjustDate("subtract",7);break;case 39:l.adjustDate("add",1);break;case 40:l.adjustDate("add",7)}},l._onInputChange=function(n){var i;n.firedBy!==l&&(i=u.parse?u.parse(u.field.value,u.format):t?(i=e(u.field.value,u.format,u.formatStrict))&&i.isValid()?i.toDate():null:new Date(Date.parse(u.field.value)),c(i)&&l.setDate(i),l._v||l.show())},l._onInputFocus=function(){l.show()},l._onInputClick=function(){l.show()},l._onInputBlur=function(){var e=i.activeElement;do{if(a(e,"pika-single"))return}while(e=e.parentNode);l._c||(l._b=r(function(){l.hide()},50)),l._c=!1},l._onClick=function(e){var t=(e=e||window.event).target||e.srcElement,i=t;if(t){!n&&a(t,"pika-select")&&(t.onchange||(t.setAttribute("onchange","return;"),o(t,"change",l._onChange)));do{if(a(i,"pika-single")||i===u.trigger)return}while(i=i.parentNode);l._v&&t!==u.trigger&&i!==u.trigger&&l.hide()}},l.el=i.createElement("div"),l.el.className="pika-single"+(u.isRTL?" is-rtl":"")+(u.theme?" "+u.theme:""),o(l.el,"mousedown",l._onMouseDown,!0),o(l.el,"touchend",l._onMouseDown,!0),o(l.el,"change",l._onChange),u.keyboardInput&&o(i,"keydown",l._onKeyChange),u.field&&(u.container?u.container.appendChild(l.el):u.bound?i.body.appendChild(l.el):u.field.parentNode.insertBefore(l.el,u.field.nextSibling),o(u.field,"change",l._onInputChange),u.defaultDate||(t&&u.field.value?u.defaultDate=e(u.field.value,u.format).toDate():u.defaultDate=new Date(Date.parse(u.field.value)),u.setDefaultDate=!0));var h=u.defaultDate;c(h)?u.setDefaultDate?l.setDate(h,!0):l.gotoDate(h):l.gotoDate(new Date),u.bound?(this.hide(),l.el.className+=" is-bound",o(u.trigger,"click",l._onInputClick),o(u.trigger,"focus",l._onInputFocus),o(u.trigger,"blur",l._onInputBlur)):this.show()};return S.prototype={config:function(e){this._o||(this._o=y({},w,!0));var t=y(this._o,e,!0);t.isRTL=!!t.isRTL,t.field=t.field&&t.field.nodeName?t.field:null,t.theme="string"==typeof t.theme&&t.theme?t.theme:null,t.bound=!!(void 0!==t.bound?t.field&&t.bound:t.field),t.trigger=t.trigger&&t.trigger.nodeName?t.trigger:t.field,t.disableWeekends=!!t.disableWeekends,t.disableDayFn="function"==typeof t.disableDayFn?t.disableDayFn:null;var n=parseInt(t.numberOfMonths,10)||1;if(t.numberOfMonths=n>4?4:n,c(t.minDate)||(t.minDate=!1),c(t.maxDate)||(t.maxDate=!1),t.minDate&&t.maxDate&&t.maxDate<t.minDate&&(t.maxDate=t.minDate=!1),t.minDate&&this.setMinDate(t.minDate),t.maxDate&&this.setMaxDate(t.maxDate),h(t.yearRange)){var i=(new Date).getFullYear()-10;t.yearRange[0]=parseInt(t.yearRange[0],10)||i,t.yearRange[1]=parseInt(t.yearRange[1],10)||i}else t.yearRange=Math.abs(parseInt(t.yearRange,10))||w.yearRange,t.yearRange>100&&(t.yearRange=100);return t},toString:function(n){return n=n||this._o.format,c(this._d)?this._o.toString?this._o.toString(this._d,n):t?e(this._d).format(n):this._d.toDateString():""},getMoment:function(){return t?e(this._d):null},setMoment:function(n,i){t&&e.isMoment(n)&&this.setDate(n.toDate(),i)},getDate:function(){return c(this._d)?new Date(this._d.getTime()):null},setDate:function(e,t){if(!e)return this._d=null,this._o.field&&(this._o.field.value="",v(this._o.field,"change",{firedBy:this})),this.draw();if("string"==typeof e&&(e=new Date(Date.parse(e))),c(e)){var n=this._o.minDate,i=this._o.maxDate;c(n)&&e<n?e=n:c(i)&&e>i&&(e=i),this._d=new Date(e.getTime()),m(this._d),this.gotoDate(this._d),this._o.field&&(this._o.field.value=this.toString(),v(this._o.field,"change",{firedBy:this})),t||"function"!=typeof this._o.onSelect||this._o.onSelect.call(this,this.getDate())}},gotoDate:function(e){var t=!0;if(c(e)){if(this.calendars){var n=new Date(this.calendars[0].year,this.calendars[0].month,1),i=new Date(this.calendars[this.calendars.length-1].year,this.calendars[this.calendars.length-1].month,1),r=e.getTime();i.setMonth(i.getMonth()+1),i.setDate(i.getDate()-1),t=r<n.getTime()||i.getTime()<r}t&&(this.calendars=[{month:e.getMonth(),year:e.getFullYear()}],"right"===this._o.mainCalendar&&(this.calendars[0].month+=1-this._o.numberOfMonths)),this.adjustCalendars()}},adjustDate:function(e,t){var n,i=this.getDate()||new Date,r=24*parseInt(t)*60*60*1e3;"add"===e?n=new Date(i.valueOf()+r):"subtract"===e&&(n=new Date(i.valueOf()-r)),this.setDate(n)},adjustCalendars:function(){this.calendars[0]=b(this.calendars[0]);for(var e=1;e<this._o.numberOfMonths;e++)this.calendars[e]=b({month:this.calendars[0].month+e,year:this.calendars[0].year});this.draw()},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(e){isNaN(e)||(this.calendars[0].month=parseInt(e,10),this.adjustCalendars())},nextMonth:function(){this.calendars[0].month++,this.adjustCalendars()},prevMonth:function(){this.calendars[0].month--,this.adjustCalendars()},gotoYear:function(e){isNaN(e)||(this.calendars[0].year=parseInt(e,10),this.adjustCalendars())},setMinDate:function(e){e instanceof Date?(m(e),this._o.minDate=e,this._o.minYear=e.getFullYear(),this._o.minMonth=e.getMonth()):(this._o.minDate=w.minDate,this._o.minYear=w.minYear,this._o.minMonth=w.minMonth,this._o.startRange=w.startRange),this.draw()},setMaxDate:function(e){e instanceof Date?(m(e),this._o.maxDate=e,this._o.maxYear=e.getFullYear(),this._o.maxMonth=e.getMonth()):(this._o.maxDate=w.maxDate,this._o.maxYear=w.maxYear,this._o.maxMonth=w.maxMonth,this._o.endRange=w.endRange),this.draw()},setStartRange:function(e){this._o.startRange=e},setEndRange:function(e){this._o.endRange=e},draw:function(e){if(this._v||e){var t,n=this._o,i=n.minYear,o=n.maxYear,s=n.minMonth,a=n.maxMonth,l="";this._y<=i&&(this._y=i,!isNaN(s)&&this._m<s&&(this._m=s)),this._y>=o&&(this._y=o,!isNaN(a)&&this._m>a&&(this._m=a)),t="pika-title-"+Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,2);for(var u=0;u<n.numberOfMonths;u++)l+='<div class="pika-lendar">'+_(this,u,this.calendars[u].year,this.calendars[u].month,this.calendars[0].year,t)+this.render(this.calendars[u].year,this.calendars[u].month,t)+"</div>";this.el.innerHTML=l,n.bound&&"hidden"!==n.field.type&&r(function(){n.trigger.focus()},1),"function"==typeof this._o.onDraw&&this._o.onDraw(this),n.bound&&n.field.setAttribute("aria-label",n.ariaLabel)}},adjustPosition:function(){var e,t,n,r,o,s,a,h,c,d,p,f;if(!this._o.container){if(this.el.style.position="absolute",t=e=this._o.trigger,n=this.el.offsetWidth,r=this.el.offsetHeight,o=window.innerWidth||i.documentElement.clientWidth,s=window.innerHeight||i.documentElement.clientHeight,a=window.pageYOffset||i.body.scrollTop||i.documentElement.scrollTop,p=!0,f=!0,"function"==typeof e.getBoundingClientRect)h=(d=e.getBoundingClientRect()).left+window.pageXOffset,c=d.bottom+window.pageYOffset;else for(h=t.offsetLeft,c=t.offsetTop+t.offsetHeight;t=t.offsetParent;)h+=t.offsetLeft,c+=t.offsetTop;(this._o.reposition&&h+n>o||this._o.position.indexOf("right")>-1&&h-n+e.offsetWidth>0)&&(h=h-n+e.offsetWidth,p=!1),(this._o.reposition&&c+r>s+a||this._o.position.indexOf("top")>-1&&c-r-e.offsetHeight>0)&&(c=c-r-e.offsetHeight,f=!1),this.el.style.left=h+"px",this.el.style.top=c+"px",l(this.el,p?"left-aligned":"right-aligned"),l(this.el,f?"bottom-aligned":"top-aligned"),u(this.el,p?"right-aligned":"left-aligned"),u(this.el,f?"top-aligned":"bottom-aligned")}},render:function(e,t,n){var i=this._o,r=new Date,o=f(e,t),s=new Date(e,t,1).getDay(),a=[],l=[];m(r),i.firstDay>0&&(s-=i.firstDay)<0&&(s+=7);for(var u=0===t?11:t-1,h=11===t?0:t+1,p=0===t?e-1:e,y=11===t?e+1:e,v=f(p,u),b=o+s,w=b;w>7;)w-=7;b+=7-w;for(var _,S,M,T,P=!1,A=0,D=0;A<b;A++){var I=new Date(e,t,A-s+1),E=!!c(this._d)&&g(I,this._d),N=g(I,r),B=-1!==i.events.indexOf(I.toDateString()),O=A<s||A>=o+s,L=A-s+1,R=t,z=e,V=i.startRange&&g(i.startRange,I),j=i.endRange&&g(i.endRange,I),W=i.startRange&&i.endRange&&i.startRange<I&&I<i.endRange;O&&(A<s?(L=v+L,R=u,z=p):(L-=o,R=h,z=y));var F={day:L,month:R,year:z,hasEvent:B,isSelected:E,isToday:N,isDisabled:i.minDate&&I<i.minDate||i.maxDate&&I>i.maxDate||i.disableWeekends&&d(I)||i.disableDayFn&&i.disableDayFn(I),isEmpty:O,isStartRange:V,isEndRange:j,isInRange:W,showDaysInNextAndPreviousMonths:i.showDaysInNextAndPreviousMonths,enableSelectionDaysInNextAndPreviousMonths:i.enableSelectionDaysInNextAndPreviousMonths};i.pickWholeWeek&&E&&(P=!0),l.push(k(F)),7==++D&&(i.showWeekNumber&&l.unshift((_=A-s,S=t,M=e,T=void 0,T=new Date(M,0,1),'<td class="pika-week">'+Math.ceil(((new Date(M,S,_)-T)/864e5+T.getDay()+1)/7)+"</td>")),a.push(C(l,i.isRTL,i.pickWholeWeek,P)),l=[],D=0,P=!1)}return function(e,t,n){return'<table cellpadding="0" cellspacing="0" class="pika-table" role="grid" aria-labelledby="'+n+'">'+function(e){var t,n=[];for(e.showWeekNumber&&n.push("<th></th>"),t=0;t<7;t++)n.push('<th scope="col"><abbr title="'+x(e,t)+'">'+x(e,t,!0)+"</abbr></th>");return"<thead><tr>"+(e.isRTL?n.reverse():n).join("")+"</tr></thead>"}(e)+("<tbody>"+t.join("")+"</tbody>")+"</table>"}(i,a,n)},isVisible:function(){return this._v},show:function(){this.isVisible()||(this._v=!0,this.draw(),u(this.el,"is-hidden"),this._o.bound&&(o(i,"click",this._onClick),this.adjustPosition()),"function"==typeof this._o.onOpen&&this._o.onOpen.call(this))},hide:function(){var e=this._v;!1!==e&&(this._o.bound&&s(i,"click",this._onClick),this.el.style.position="static",this.el.style.left="auto",this.el.style.top="auto",l(this.el,"is-hidden"),this._v=!1,void 0!==e&&"function"==typeof this._o.onClose&&this._o.onClose.call(this))},destroy:function(){var e=this._o;this.hide(),s(this.el,"mousedown",this._onMouseDown,!0),s(this.el,"touchend",this._onMouseDown,!0),s(this.el,"change",this._onChange),e.keyboardInput&&s(i,"keydown",this._onKeyChange),e.field&&(s(e.field,"change",this._onInputChange),e.bound&&(s(e.trigger,"click",this._onInputClick),s(e.trigger,"focus",this._onInputFocus),s(e.trigger,"blur",this._onInputBlur))),this.el.parentNode&&this.el.parentNode.removeChild(this.el)}},S}(r)}()},function(e,t,n){const{remote:i}=n(4),{h:r,Component:o}=n(0),s=n(2),a=n(26),l=n(3).context("ScoreDrawer"),u=n(1),h=i.require("./setting");class c extends o{render({method:e,score:t,komi:n,handicap:i,sign:o}){let a=o>0?0:1,u=t?"area"===e?t.area[a]:t.territory[a]+t.captures[a]:0;return o<0&&(u+=n),"area"===e&&o<0&&(u+=i),r("tr",{},r("th",{},r("img",{src:`/static/node_modules/@sabaki/shudan/css/stone_${o}.png`,alt:l(o>0?"Black":"White"),width:24,height:24})),r("td",{class:s({disabled:"territory"===e})},t?t.area[a]:"-"),r("td",{class:s({disabled:"area"===e})},t?t.territory[a]:"-"),r("td",{class:s({disabled:"area"===e})},t?t.captures[a]:"-"),r("td",{},o<0?n:"-"),r("td",{class:s({disabled:"territory"===e})},o<0?i:"-"),r("td",{},u))}}e.exports=class extends o{constructor(){super(),this.handleTerritoryButtonClick=(()=>h.set("scoring.method","territory")),this.handleAreaButtonClick=(()=>h.set("scoring.method","area")),this.handleCloseButtonClick=(()=>sabaki.closeDrawer()),this.handleSubmitButtonClick=(e=>{e.preventDefault();let{onSubmitButtonClick:t=u.noop}=this.props;e.resultString=this.resultString,t(e)})}shouldComponentUpdate({areaMap:e}){return null!=e}render({show:e,estimating:t,method:n,areaMap:i,board:o,komi:u,handicap:h}){isNaN(u)&&(u=0),isNaN(h)&&(h=0);let d=o&&o.getScore(i,{handicap:h,komi:u}),p=d&&("area"===n?d.areaScore:d.territoryScore);return this.resultString=p>0?l(e=>`B+${e.result}`,{result:p}):p<0?l(e=>`W+${e.result}`,{result:-p}):l("Draw"),r(a,{type:"score",show:e},r("h2",{},"Score"),r("ul",{class:"tabs"},r("li",{class:s({current:"area"===n})},r("a",{href:"#",onClick:this.handleAreaButtonClick},l("Area"))),r("li",{class:s({current:"territory"===n})},r("a",{href:"#",onClick:this.handleTerritoryButtonClick},l("Territory")))),r("table",{},r("thead",{},r("tr",{},r("th"),r("th",{disabled:"territory"===n},l("Area")),r("th",{disabled:"area"===n},l("Territory")),r("th",{disabled:"area"===n},l("Captures")),r("th",{},l("Komi")),r("th",{disabled:"territory"===n},l("Handicap")),r("th",{},l("Total")))),r("tbody",{},r(c,{method:n,score:d,komi:u,handicap:0,sign:1}),r(c,{method:n,score:d,komi:u,handicap:h,sign:-1}))),r("form",{},r("p",{},l("Result:")," ",r("span",{class:"result"},this.resultString)," ",!t&&r("button",{type:"submit",onClick:this.handleSubmitButtonClick},l("Update Result"))," ",r("button",{type:"reset",onClick:this.handleCloseButtonClick},l("Close")))))}}},function(e,t,n){const{remote:i}=n(4),{h:r,Component:o}=n(0),s=n(2),a=n(160),l=n(26),u=n(3).context("GameChooserDrawer"),h=n(38),c=n(39),d=n(6),p=n(164),f=n(1);let m=i.require("./setting").get("gamechooser.thumbnail_size"),g=m+12+20,y=283,v=e=>{let t=e.navigate(e.root.id,30,{});return t||(t=e.navigate(e.root.id,e.getCurrentHeight({})-1,{})),d.getBoard(e,t.id)};class b extends o{constructor(){super();let e=["Click","ContextMenu","DragStart","DragOver"];for(let t of e)this[`handle${t}`]=(e=>{let n=this.props[`on${t}`];e.tree=this.props.tree,n&&n(e)})}shouldComponentUpdate(e){for(let t in e)if(e[t]!==this.props[t])return!0;return!1}render({tree:e,left:t,top:n,draggable:i,showThumbnail:o,insertBefore:l,insertAfter:h}){let c=sabaki.getGameInfo(e),{gameName:d,eventName:p,blackName:f,blackRank:g,whiteName:y,whiteRank:b}=c,w=d||p||"";return r("li",{ref:e=>this.element=e,class:s({insertbefore:l,insertafter:h}),style:{left:t,top:n}},r("div",{draggable:i,onClick:this.handleClick,onContextMenu:this.handleContextMenu,onDragStart:this.handleDragStart,onDragOver:this.handleDragOver},r("span",{title:w},w),r(a,{board:v(e),maxSize:m,visible:o}),r("span",{class:"black",title:g},f||u("Black")),r("span",{class:"white",title:b},y||u("White"))))}}e.exports=class extends o{constructor(){super(),this.itemElements={},this.state={scrollTop:0,insertBefore:-1,animation:!1,filterText:""},this.handleFilterTextChange=(e=>this.setState({filterText:e.currentTarget.value.trim()})),this.handleCloseButtonClick=(()=>sabaki.closeDrawer()),this.handleListScroll=(e=>{this.setState({scrollTop:e.currentTarget.scrollTop})}),this.handleItemContextMenu=(e=>{f.popupMenu([{label:u("&Remove Game"),click:()=>{if(1===h.showMessageBox(u("Do you really want to remove this game permanently?"),"warning",[u("Remove Game"),u("Cancel")],1))return;let{gameTrees:t,onChange:n=f.noop}=this.props,i=t.indexOf(e.tree);n({gameTrees:t.filter((e,t)=>t!==i)})}},{label:u("Remove &Other Games"),click:()=>{if(1===h.showMessageBox(u("Do you really want to remove all other games permanently?"),"warning",[u("Remove Games"),u("Cancel")],1))return;let{onChange:t=f.noop}=this.props;t({gameTrees:[e.tree]})}}],e.clientX,e.clientY)}),this.handleItemDragStart=(e=>{this.dragData=this.props.gameTrees.indexOf(e.tree)}),this.handleItemDragOver=(e=>{if(null==this.dragData)return;e.preventDefault();let t=e.currentTarget,n=this.props.gameTrees.indexOf(e.tree),i=e.clientX,{left:r,width:o}=t.getBoundingClientRect(),s=r+o/2;i<=s-10?this.setState({insertBefore:n}):i>=s+10&&this.setState({insertBefore:n+1})}),this.handleItemDrop=(e=>{let{gameTrees:t,onChange:n=f.noop}=this.props,{insertBefore:i}=this.state,r=t.slice();if(null==this.dragData||i<0)return;i>this.dragData&&i--;let[o]=r.splice(this.dragData,1);r.splice(i,0,o),this.dragData=null,this.setState({insertBefore:-1}),n({gameTrees:r})}),this.handleCancelDrag=(()=>{this.dragData=null,this.setState({insertBefore:-1})}),this.handleItemClick=(e=>{let{onItemClick:t=f.noop}=this.props;e.selectedTree=e.tree,t(e)}),this.handleAddButtonClick=(e=>{let t=[{label:u("Add &New Game"),click:()=>{let e=sabaki.getEmptyGameTree(),{gameTrees:t,onChange:n=f.noop}=this.props;n({gameTrees:[...t,e]})}},{label:u("Add &Existing Files…"),click:()=>{h.showOpenDialog({properties:["openFile","multiSelections"],filters:[...c.meta,{name:u("All Files"),extensions:["*"]}]},({result:e})=>{let{onChange:t=f.noop}=this.props;if(sabaki.setBusy(!0),e)try{for(let n of e)c.parseFile(n,f.noop,({trees:e})=>{t({gameTrees:[...this.props.gameTrees,...e]})})}catch(e){h.showMessageBox(u("Some files are unreadable."),"warning")}sabaki.setBusy(!1)})}}],n=e.currentTarget,{left:i,bottom:r}=n.getBoundingClientRect();f.popupMenu(t,i,r)}),this.handleSortButtonClick=(e=>{let t=e=>()=>{sabaki.setBusy(!0);let{gameTrees:t,onChange:n=f.noop}=this.props;n({gameTrees:e(t.slice())}),sabaki.setBusy(!1)},n=[{label:u("&Black Player"),click:t(p.byPlayerBlack)},{label:u("&White Player"),click:t(p.byPlayerWhite)},{label:u("Black R&ank"),click:t(p.byBlackRank)},{label:u("White Ran&k"),click:t(p.byWhiteRank)},{label:u("Game &Name"),click:t(p.byGameName)},{label:u("Game &Event"),click:t(p.byEvent)},{label:u("&Date"),click:t(p.byDate)},{label:u("Number of &Moves"),click:t(p.byNumberOfMoves)},{type:"separator"},{label:u("&Reverse"),click:t(p.reverse)}],i=e.currentTarget,{left:r,bottom:o}=i.getBoundingClientRect();f.popupMenu(n,r,o)})}componentDidMount(){window.addEventListener("resize",()=>this.resize()),this.resize(),this.forceUpdate()}shouldComponentUpdate({show:e},{animation:t}){return t!==this.state.animation||e||e!==this.props.show}componentDidUpdate(e,t){if(this.state.scrollTop!==t.scrollTop&&this.state.scrollTop!==this.gamesListElement.scrollTop&&(this.gamesListElement.scrollTop=this.state.scrollTop,this.setState({scrollTop:this.gamesListElement.scrollTop})),this.props.show&&e.gameTrees.length<this.props.gameTrees.length&&(this.gamesListElement.scrollTop=this.gamesListElement.scrollHeight,this.setState({scrollTop:this.gamesListElement.scrollTop})),!e.show&&this.props.show){let e=this.shownGameTrees.findIndex(([,e])=>e===this.props.gameIndex),t=0;e>=0&&(t=this.getRowFromIndex(e)*y),this.gamesListElement.scrollTop=t,this.setState({scrollTop:this.gamesListElement.scrollTop})}if(e.show!==this.props.show){let e=document.getElementById("goban").getBoundingClientRect(),t=document.getElementById("gamechooser").getBoundingClientRect(),n=this.itemElements[this.props.gameIndex],i=null!=n?n.querySelector("svg"):null;if(null!=n&&null!=i){let{width:i,height:r,left:o,top:s}=n.querySelector("svg").getBoundingClientRect(),a={left:o-t.left,top:s-t.top,width:i,height:r},l=this.props.show?"reverse":"normal";this.setState({animation:[a,e,l]}),setTimeout(()=>this.setState({animation:null}),600)}}}resize(){let e=this.gamesListElement.offsetWidth-28,t=this.gamesListElement.offsetHeight,n=Math.floor(e/g);this.setState({innerWidth:e,height:t,rowCount:n})}getRowFromIndex(e){return(e-e%this.state.rowCount)/this.state.rowCount}render({show:e,gameTrees:t,gameIndex:n},{filterText:i,animation:o,scrollTop:s,insertBefore:h,rowCount:c,innerWidth:d,height:p}){let f=Math.floor(d/c);return this.shownGameTrees=t.map((e,t)=>[e,t]).filter(([e])=>{let t=sabaki.getGameInfo(e);return Object.keys(t).map(e=>t[e]).join(" ").toLowerCase().includes(i.toLowerCase())}),r("div",{onDrop:this.handleCancelDrag},r("style",{},`\n                #gamechooser .games-list .placeholder {\n                    height: ${(this.getRowFromIndex(this.shownGameTrees.length-1)+1)*y+20}px;\n                }\n\n                #gamechooser .games-list li {\n                    width: ${f-20}px;\n                }\n            `,o&&`\n                #gamechooser-animation {\n                    animation: gamechooser-animation .5s ${o[2]} forwards;\n                }\n\n                @keyframes gamechooser-animation {\n                    from {\n                        transform: translate(${o[0].left}px, ${o[0].top}px);\n                        opacity: 1;\n                    }\n                    to {\n                        transform: translate(${o[1].left}px, ${o[1].top}px)\n                            scale(${o[1].width/o[0].width},\n                            ${o[1].height/o[0].height});\n                        opacity: 0;\n                    }\n                }\n            `),r(l,{type:"gamechooser",show:e},r("h2",{},u("Manage Games")),r("input",{type:"search",name:"filter",placeholder:u("Filter"),value:i,onInput:this.handleFilterTextChange}),r("div",{ref:e=>this.gamesListElement=e,class:"games-list",onScroll:this.handleListScroll,onDrop:this.handleItemDrop},r("div",{class:"placeholder"}),r("ol",{},this.shownGameTrees.map(([e,t],a)=>{let l=this.getRowFromIndex(a),u=l*y+10,d=(a-l*c)*f+10;if(t===n||!(u+2*y<=s||u-y>=s+p))return r(b,{ref:e=>{null!=e&&(this.itemElements[t]=e.element)},key:e.id,tree:e,top:u,left:d,draggable:""===i,showThumbnail:t!==n||!o,insertBefore:h===t,insertAfter:a===this.shownGameTrees.length-1&&h===t+1,onClick:this.handleItemClick,onContextMenu:this.handleItemContextMenu,onDragStart:this.handleItemDragStart,onDragOver:this.handleItemDragOver})}))),r("p",{},r("button",{type:"button",class:"dropdown",onClick:this.handleAddButtonClick},u("Add")),r("button",{type:"button",class:"dropdown",onClick:this.handleSortButtonClick},u("Sort By")),r("button",{type:"button",onClick:this.handleCloseButtonClick},u("Close")))),r("div",{id:"gamechooser-animation",style:o?{}:{opacity:0,pointerEvents:"none"}},r(a,{board:v(t[n]),maxSize:m})))}}},function(e,t,n){const{h:i,Component:r}=n(0),o=e=>[...Array(e)].map((e,t)=>t);e.exports=class extends r{shouldComponentUpdate({board:e,maxSize:t,visible:n}){return n!==this.props.visible||t!==this.props.maxSize||e.getPositionHash()!==this.props.board.getPositionHash()}render({board:e,maxSize:t,visible:n=!0}){let r=(t-1)/Math.max(e.width,e.height),s=r/2,a=o(e.width),l=o(e.height);return i("svg",{width:r*e.width+1,height:r*e.height+1,style:{visibility:n?"visible":"hidden"}},e.getHandicapPlacement(9).map(([e,t])=>i("circle",{cx:e*r+s+1,cy:t*r+s+1,r:2,fill:"#5E2E0C"})),a.map(t=>l.map(n=>0!==e.get([t,n])&&i("circle",{cx:t*r+s+1,cy:n*r+s+2,r:s,fill:"rgba(0, 0, 0, .5)"}))),a.map(t=>l.map(n=>0!==e.get([t,n])&&i("circle",{cx:t*r+s+1,cy:n*r+s+1,r:s,fill:e.get([t,n])<0?"white":"black"}))))}}},function(e,t,n){n(31);const i=n(8),r=n(3).context("fileformats"),{getId:o}=n(1),s=n(6);t.meta={name:r("Smart Game Format"),extensions:["sgf","rsgf"]};let a=e=>e.map(e=>s.new({getId:o,root:e}));t.parse=function(e,t=(()=>{})){let n=i.parse(e,{getId:o,onProgress:t});return a(n)},t.parseFile=function(e,t=(()=>{})){let n=i.parseFile(e,{getId:o,onProgress:t});return a(n)}},function(e,t,n){n(40),n(10);const i=n(8),r=n(3).context("fileformats"),o=n(17),s=n(6);t.meta={name:r("wBaduk NGF"),extensions:["ngf"]},t.parse=function(e){return[s.new().mutate(t=>{let n=e.split("\n"),r=t.root.id;t.updateProperty(r,"CA",["UTF-8"]),t.updateProperty(r,"FF",["4"]),t.updateProperty(r,"GM",["1"]),t.updateProperty(r,"SZ",["19"]);let s=Math.floor(parseFloat(n[1])),a=Math.floor(parseFloat(n[5])),l=n[2].split(" ")[0],u=n[3].split(" ")[0],h=n[8].slice(0,8),c=Math.floor(parseFloat(n[7]));isNaN(s)&&(s=19),isNaN(a)&&(a=0),isNaN(c)&&(c=0);let d=n[2].trim().split(" ");if(d.length>1){let e=d[d.length-1];e=e.replace("DP","p").replace("K","k").replace("D","d"),t.updateProperty(r,"WR",[e])}let p=n[3].trim().split(" ");if(p.length>1){let e=p[p.length-1];e=e.replace("DP","p").replace("K","k").replace("D","d"),t.updateProperty(r,"BR",[e])}0===a&&c===Math.floor(c)&&(c+=.5);let f="",m="";if(n[10].includes("resign")&&(m="R"),n[10].includes("time")&&(m="T"),(n[10].includes("hite win")||n[10].includes("lack lose"))&&(f="W"),(n[10].includes("lack win")||n[10].includes("hite lose"))&&(f="B"),""===m){let e=null,t=n[10].split(" ");for(let n of t){let t=parseFloat(n);!1===isNaN(t)&&(e=t)}null!==e&&(m=e.toString())}if(""!==f&&t.updateProperty(r,"RE",[`${f}+${m}`]),t.updateProperty(r,"SZ",[s.toString()]),a>=2){t.updateProperty(r,"HA",[a.toString()]);let e=new o(s,s).getHandicapPlacement(a,!0);for(let[n,o]of e){let e=i.stringifyVertex([n,o]);t.addToProperty(r,"AB",e)}}if(c&&t.updateProperty(r,"KM",[c.toString()]),8===h.length){let e=!0;for(let t=0;t<8;t++){let n=parseFloat(h.charAt(t));if(isNaN(n)){e=!1;break}}if(e){let e="";e+=h.slice(0,4),e+="-"+h.slice(4,6),e+="-"+h.slice(6,8),t.updateProperty(r,"DT",[e])}}t.updateProperty(r,"PW",[l]),t.updateProperty(r,"PB",[u]);let g=r;for(let e=0;e<n.length;e++){let r=n[e].trim();if(r.length>=7&&"PM"===r.slice(0,2)){let e=r.charAt(4);if("B"===e||"W"===e){let n=r.charCodeAt(5)-66,o=r.charCodeAt(6)-66,s=i.stringifyVertex([n,o]);g=t.appendNode(g,{[e]:[s]})}}}})]},t.parseFile=function(e){}},function(e,t,n){n(40),n(10);const i=n(8),r=n(3).context("fileformats"),o=n(17),s=n(6);function a(e,t,n){let i="",r=t.exec(e);if(r){let t=parseFloat(r[1]);if(r=n.exec(e)){i=function(e,t){let n={3:"B+R",4:"W+R",7:"B+T",8:"W+T"};if(void 0!==n[e])return n[e];if(0===e||1===e)return(0===e?"B":"W")+"+"+(t/10).toString();return""}(t,parseFloat(r[1]))}}return i}function l(e){let t="",n="",i=e.split("(");return 2===i.length&&i[1].indexOf(")")===i[1].length-1&&(t=i[0].trim(),n=i[1].slice(0,i[1].length-1)),""===t?[e,""]:[t,n]}t.meta={name:r("Tygem GIB"),extensions:["gib"]},t.parse=function(e){return[s.new().mutate(t=>{let n=e.split("\n"),r=t.root.id,s=r;t.updateProperty(r,"CA",["UTF-8"]),t.updateProperty(r,"FF",["4"]),t.updateProperty(r,"GM",["1"]),t.updateProperty(r,"SZ",["19"]);for(let e=0;e<n.length;e++){let u=n[e].trim();if(u.startsWith("\\[GAMEBLACKNAME=")&&u.endsWith("\\]")){let e=u.slice(16,-2),[n,i]=l(e);n&&t.updateProperty(r,"PB",[n]),i&&t.updateProperty(r,"BR",[i])}else if(u.startsWith("\\[GAMEWHITENAME=")&&u.endsWith("\\]")){let e=u.slice(16,-2),[n,i]=l(e);n&&t.updateProperty(r,"PW",[n]),i&&t.updateProperty(r,"WR",[i])}else if(u.startsWith("\\[GAMEINFOMAIN=")){if(null==t.root.data.RE){let e=a(u,/GRLT:(\d+),/,/ZIPSU:(\d+),/);""!==e&&t.updateProperty(r,"RE",[e])}if(null==t.root.data.KM){let e=/GONGJE:(\d+),/.exec(u);if(e){let n=parseFloat(e[1])/10;t.updateProperty(r,"KM",[n.toString()])}}}else if(u.startsWith("\\[GAMETAG=")){if(null==t.root.data.DT){let e=/C(\d\d\d\d):(\d\d):(\d\d)/.exec(u);e&&t.updateProperty(r,"DT",[e.slice(1,4).join("-")])}if(null==t.root.data.RE){let e=a(u,/,W(\d+),/,/,Z(\d+),/);""!==e&&t.updateProperty(r,"RE",[e])}if(null==t.root.data.KM){let e=/,G(\d+),/.exec(u);if(e){let n=parseFloat(e[1])/10;t.updateProperty(r,"KM",[n.toString()])}}}else if("INI"===u.slice(0,3)){let e=u.split(" "),n=0,s=Math.floor(parseFloat(e[3]));if(isNaN(s)||(n=s),n>=2&&n<=9){t.updateProperty(r,"HA",[n.toString()]);let e=(new o).getHandicapPlacement(n,!0);for(let[n,o]of e){let e=i.stringifyVertex([n,o]);t.addToProperty(r,"AB",e)}}}else if("STO"===u.slice(0,3)){let e=u.split(" ");if(e.length<6)continue;let n="1"===e[3]?"B":"W",r=Math.floor(parseFloat(e[4])),o=Math.floor(parseFloat(e[5]));if(isNaN(r)||isNaN(o))continue;let a=i.stringifyVertex([r,o]);s=t.appendNode(s,{[n]:[a]})}}})]},t.parseFile=function(e){}},function(e,t,n){const i=n(165),r=n(8),o=n(1);function s(e,t){return t in e.root.data?e.root.data[t][0]:""}function a(e,t){return h(e,(e,n)=>{let[i,r]=[e,n].map(e=>(function(e){let t=parseFloat(e);if(isNaN(t))return-1/0;{let n=e.includes("k")?-1:e.includes("p")?10:1;return n*t}})(s(e,t)));return u(i,r)})}function l(e,t){return h(e,(e,n)=>{let[r,o]=[e,n].map(e=>s(e,t));return i({insensitive:!0})(r,o)})}function u(e,t){return e<t?-1:+(e!==t)}function h(e,t){return e.map((e,t)=>[e,t]).sort((e,n)=>{let i=t(e[0],n[0]);return 0===i?e[1]-n[1]:i}).map(e=>e[0])}t.reverse=function(e){return e.slice().reverse()},t.byBlackRank=function(e){return a(e,"BR")},t.byWhiteRank=function(e){return a(e,"WR")},t.byPlayerBlack=function(e){return l(e,"PB")},t.byPlayerWhite=function(e){return l(e,"PW")},t.byGameName=function(e){return l(e,"GN")},t.byEvent=function(e){return l(e,"EV")},t.byDate=function(e){return h(e,(e,t)=>{let[n,i]=[e,t].map(e=>s(e,"DT")).map(e=>r.parseDates(e)).map(e=>e?r.stringifyDates(e.sort(o.lexicalCompare)):"");return u(n,i)})},t.byNumberOfMoves=function(e){return h(e,(e,t)=>u(e.getHeight(),t.getHeight()))}},function(e,t,n){!function(){"use strict";e.exports=function(e){var t=(e=e||{}).desc?-1:1,n=-t,i=/^0/,r=/\s+/g,o=/^\s+|\s+$/g,s=/[^\x00-\x80]/,a=/^0x[0-9a-f]+$/i,l=/(0x[\da-fA-F]+|(^[\+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|\d+)/g,u=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,h=e.insensitive?function(e){return function(e){return e.toLocaleLowerCase?e.toLocaleLowerCase():e.toLowerCase()}(""+e).replace(o,"")}:function(e){return(""+e).replace(o,"")};function c(e){return e.replace(l,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0")}function d(e,t){return(!e.match(i)||1===t)&&parseFloat(e)||e.replace(r," ").replace(o,"")||0}return function(e,i){var r=h(e),o=h(i);if(!r&&!o)return 0;if(!r&&o)return n;if(r&&!o)return t;var l=c(r),p=c(o),f=parseInt(r.match(a),16)||1!==l.length&&Date.parse(r),m=parseInt(o.match(a),16)||f&&o.match(u)&&Date.parse(o)||null;if(m){if(f<m)return n;if(f>m)return t}for(var g=l.length,y=p.length,v=0,b=Math.max(g,y);v<b;v++){var w=d(l[v]||"",g),x=d(p[v]||"",y);if(isNaN(w)!==isNaN(x))return isNaN(w)?t:n;if(s.test(w+x)&&w.localeCompare){var k=w.localeCompare(x);if(k>0)return t;if(k<0)return n;if(v===b-1)return 0}else{if(w<x)return n;if(w>x)return t}}return 0}}}()},function(e,t,n){const{h:i,Component:r}=n(0),o=n(2),s=n(1);e.exports=class extends r{constructor(){super(),this.state={value:""},this.handleInput=(e=>this.setState({value:e.currentTarget.value})),this.stopPropagation=(e=>e.stopPropagation()),this.handleKeyUp=(e=>{if(this.props.show)if("Escape"===e.key)e.stopPropagation(),this.cancel();else if("Enter"==e.key){e.stopPropagation(),sabaki.setState({showInputBox:!1}),document.activeElement===this.inputElement&&this.inputElement.blur();let{onSubmit:t=s.noop}=this.props;t(this.state)}}),this.cancel=this.cancel.bind(this)}shouldComponentUpdate({show:e,text:t,onSubmit:n,onCancel:i}){return e!==this.props.show||t!==this.props.text||n!==this.props.onSubmit||i!==this.props.onCancel}componentWillReceiveProps(e){e.show&&!this.props.show&&this.setState({value:""})}componentDidUpdate(e){!e.show&&this.props.show&&this.inputElement.focus()}cancel(){if(!this.props.show)return;document.activeElement===this.inputElement&&this.inputElement.blur();let{onCancel:e=s.noop}=this.props;sabaki.setState({showInputBox:!1}),e()}render({show:e,text:t},{value:n}){return i("section",{id:"input-box",class:o({show:e}),onClick:this.cancel},i("div",{class:"inner",onClick:this.stopPropagation},i("input",{ref:e=>this.inputElement=e,type:"text",name:"input",value:n,placeholder:t,onInput:this.handleInput,onKeyUp:this.handleKeyUp,onBlur:this.cancel})))}}},function(e,t,n){const{remote:i,ipcRenderer:r}=n(4),{h:o,Component:s}=n(0),a=i.require("./setting");e.exports=class extends s{componentWillReceiveProps({show:e}){if(e!==this.props.show)if(clearTimeout(this.busyId),e)r.send("build-menu",!0),this.setState({show:!0}),document.activeElement.blur();else{r.send("build-menu");let e=a.get("app.hide_busy_delay");this.busyId=setTimeout(()=>this.setState({show:!1}),e)}}render(e,{show:t}){return o("section",{id:"busy",style:{display:t?"block":"none"}})}}},function(e,t,n){const{h:i,Component:r}=n(0),o=n(2);e.exports=class extends r{shouldComponentUpdate({text:e,show:t}){return e!==this.props.text||t!==this.props.show}render({text:e,show:t}){return i("section",{id:"info-overlay",class:o({show:t})},e)}}},function(e,t,n){const i=n(170),r=e=>({newData:[].concat(...e),width:e.length>0?e[0].length:0}),o=(e,t)=>[...e].map(e=>{let n=e%t;return[n,(e-n)/t]}),s=(e,t)=>[...Array(e.length/t)].map((n,i)=>{let r=i*t;return[...Array(t)].map((t,n)=>e[r+n])});t.useFetch=function(e){return i.fetchPath=e,t},t.guess=async function(e,{finished:t=!1,iterations:n=100}={}){let{newData:s,width:a}=r(e),l=(await i).guess(s,a,t,n,Date.now());return o(l,a)},t.playTillEnd=async function(e,t){let{newData:n,width:o}=r(e),a=(await i).play_till_end(n,o,t,Date.now());return s(a,o)},t.getProbabilityMap=async function(e,t){let{newData:n,width:o}=r(e),a=(await i).get_probability_map(n,o,t,Date.now());return s(a,o)},t.getFloatingStones=async function(e){let{newData:t,width:n}=r(e),s=(await i).get_floating_stones(t,n);return o(s,n)}},function(e,t,n){const i=e=>{let t={};let n=null;let i=0;function r(t){const r=e.__wbindgen_malloc(1*t.length);return(null!==n&&n.buffer===e.memory.buffer||(n=new Uint8Array(e.memory.buffer)),n).set(t,r/1),i=t.length,r}let o=null;function s(){return null!==o&&o.buffer===e.memory.buffer||(o=new Uint32Array(e.memory.buffer)),o}function a(e,t){return s().subarray(e/4,e/4+t)}let l=null;function u(){return null===l&&(l=e.__wbindgen_global_argument_ptr()),l}t.guess=function(t,n,o,l,h){const c=r(t),d=i,p=u();e.guess(p,c,d,n,o,l,h);const f=s(),m=f[p/4],g=f[p/4+1],y=a(m,g).slice();return e.__wbindgen_free(m,4*g),y};let h=null;function c(t,n){return(null!==h&&h.buffer===e.memory.buffer||(h=new Float32Array(e.memory.buffer)),h).subarray(t/4,t/4+n)}t.get_probability_map=function(t,n,o,a){const l=r(t),h=i,d=u();e.get_probability_map(d,l,h,n,o,a);const p=s(),f=p[d/4],m=p[d/4+1],g=c(f,m).slice();return e.__wbindgen_free(f,4*m),g};let d=null;function p(t,n){return(null!==d&&d.buffer===e.memory.buffer||(d=new Int8Array(e.memory.buffer)),d).subarray(t/1,t/1+n)}return t.play_till_end=function(t,n,o,a){const l=r(t),h=i,c=u();e.play_till_end(c,l,h,n,o,a);const d=s(),f=d[c/4],m=d[c/4+1],g=p(f,m).slice();return e.__wbindgen_free(f,1*m),g},t.get_floating_stones=function(t,n){const o=r(t),l=i,h=u();e.get_floating_stones(h,o,l,n);const c=s(),d=c[h/4],p=c[h/4+1],f=a(d,p).slice();return e.__wbindgen_free(d,4*p),f},t};let r={"./deadstones":i()};e.exports=t=new Promise((e,t)=>{const{join:i}=n(11),{readFile:o}=n(10);o(i(__dirname,"..","wasm","deadstones_bg.wasm"),(n,i)=>{if(n)return t(n);e(WebAssembly.instantiate(i,r))})}).catch(()=>fetch(t.fetchPath).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,r))).then(e=>i(e.instance.exports)),t.fetchPath=null},function(e,t,n){let i={};i.areaMap=n(41),i.nearestNeighborMap=n(42),i.radianceMap=n(43),i.map=n(172),e.exports=i},function(e,t,n){const i=n(41),r=n(42),o=n(43),{getNeighbors:s}=n(27);e.exports=function(e,{discrete:t=!1,maxDistance:n=6,minRadiance:a=2}={}){let l=e.length,u=0===l?0:e[0].length,h=i(e),c=r(e,1),d=r(e,-1),p=o(e,1),f=o(e,-1);for(let e=0;e<u;e++)for(let i=0;i<l;i++){if(0!==h[i][e])continue;let r=Math.sign(d[i][e]-c[i][e]),o=0===r||(r>0?c:d)[i][e]>n,s=0===r||Math.round((r>0?p:f)[i][e])<a;h[i][e]=o||s?0:r*(r>0?p[i][e]:f[i][e]),t&&(h[i][e]=Math.sign(h[i][e]))}for(let n=0;n<u;n++)for(let i=0;i<l;i++){if(0!==e[i][n])continue;let r=Math.sign(h[i][n]);if(0!==r){let t=s([n,i]).filter(([t,n])=>e[n]&&null!=e[n][t]);if(t.length>=2){let[e,o]=t[0];if(t.every(([e,t])=>Math.sign(h[t][e])!==r)){h[i][n]=0;continue}}}let o=Math.min(n,i,u-n-1,l-i-1);if(0!==r){let t=s([n,i]).filter(([e,t])=>h[t]&&Math.sign(h[t][e])===r);if(1===t.length){let[o,s]=t[0];e[s][o]===r&&(h[i][n]=0);continue}}if(o<=2&&0===r){let e=s([n,i]).filter(([e,t])=>h[t]&&0!==h[t][e]);if(e.length>=2){let[[r,o],[s,a]]=e,l=Math.sign(h[o][r]);if((e.length>=3||r===s||o===a)&&e.every(([e,t])=>Math.sign(h[t][e])===l)){h[i][n]=t?l:e.reduce((e,[t,n])=>e+h[n][t],0)/e.length;continue}}}}return i(h)}},function(e,t,n){const i=n(7);e.exports={write:i,updatePath:i,rotate:i,close:i}},function(e,t){const n=["AB","AW","AE","B","CR","DD","MA","SL","SQ","TB","TR","TW","VW","W"],i=["LB"],r=["AR","LN"],o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",s=[...o].reverse(),a={AB:"AW",AW:"AB",B:"W",W:"B"};function l(e,t){return e>="a"&&t<="Z"?e:e<="Z"&&t>="a"?t:e<t?e:t}function u(e,t){return e>="a"&&t<="Z"?t:e<="Z"&&t>="a"?e:e<t?t:e}function h(e,t,n){if("string"!=typeof e||2!==e.length)return[null,null];let i=o.indexOf(e[0]),r=o.indexOf(e[1]);return-1===i||-1===r||i>=t||r>=n?[null,null]:[i,r]}function c(e){return"string"!=typeof e||5!==e.length||":"!==e[2]?[null,null]:[e.slice(0,2),e.slice(3,5)]}function d(e,t){return l(e[0],t[0])+l(e[1],t[1])+":"+u(e[0],t[0])+u(e[1],t[1])}t.rotatePoint=function(e,t,n,i){let[r,o]=h(e,t,n);if(null===r||null===o)return null;if(i){let n=s.slice(52-t);return e[1]+n[r]}return s.slice(52-n)[o]+e[0]},t.rotateTwoPoints=function(e,n,i,r,o){let[s,a]=c(e);return s=t.rotatePoint(s,n,i,r),a=t.rotatePoint(a,n,i,r),null===s||null===a?null:o?d(s,a):s+":"+a},t.rotateRect=function(e,n,i,r){return t.rotateTwoPoints(e,n,i,r,!0)},t.rotateArrow=function(e,n,i,r){return t.rotateTwoPoints(e,n,i,r,!1)},t.rotateTree=function(e,o,s,a){return e.mutate(l=>{for(let u of e.listNodes()){for(let e of n)null!=u.data[e]&&l.updateProperty(u.id,e,u.data[e].map(e=>{if(2===e.length){let n=t.rotatePoint(e,o,s,a);if(n)return n}else if(5===e.length&&":"===e[2]){let n=t.rotateRect(e,o,s,a);if(n)return n}return e}));for(let e of i)null!=u.data[e]&&l.updateProperty(u.id,e,u.data[e].map(e=>{if(":"===e[2]){let n=e.slice(0,2);if(n=t.rotatePoint(n,o,s,a))return n+e.slice(2)}return e}));for(let e of r)null!=u.data[e]&&l.updateProperty(u.id,e,u.data[e].map(e=>{if(":"===e[2]){let n=t.rotateArrow(e,o,s,a);if(n)return n}return e}))}null!=l.root.data.SZ&&l.root.data.SZ[0].includes(":")&&l.updateProperty(l.root.id,"SZ",[l.root.data.SZ[0].split(":").reverse().join(":")])})},t.flipPoint=function(e,t,n,i){let[r,o]=h(e,t,n);if(null===r||null===o)return null;if(i){return s.slice(52-t)[r]+e[1]}{let t=s.slice(52-n);return e[0]+t[o]}},t.flipTwoPoints=function(e,n,i,r,o){let[s,a]=c(e);return s=t.flipPoint(s,n,i,r),a=t.flipPoint(a,n,i,r),null===s||null===a?null:o?d(s,a):s+":"+a},t.flipRect=function(e,n,i,r){return t.flipTwoPoints(e,n,i,r,!0)},t.flipArrow=function(e,n,i,r){return t.flipTwoPoints(e,n,i,r,!1)},t.flipTree=function(e,o,s,a){return e.mutate(l=>{for(let u of e.listNodes()){for(let e of n)null!=u.data[e]&&l.updateProperty(u.id,e,u.data[e].map(e=>{if(2===e.length){let n=t.flipPoint(e,o,s,a);if(n)return n}else if(5===e.length&&":"===e[2]){let n=t.flipRect(e,o,s,a);if(n)return n}return e}));for(let e of i)null!=u.data[e]&&l.updateProperty(u.id,e,u.data[e].map(e=>{if(":"===e[2]){let n=e.slice(0,2);if(n=t.flipPoint(n,o,s,a))return n+e.slice(2)}return e}));for(let e of r)null!=u.data[e]&&l.updateProperty(u.id,e,u.data[e].map(e=>{if(":"===e[2]){let n=t.flipArrow(e,o,s,a);if(n)return n}return e}))}})},t.invertTreeColors=function(e){return e.mutate(t=>{for(let n of e.listNodes()){let e={};for(let i of Object.keys(a)){let r=n.data[i];null!=r&&(e[a[i]]=r,t.removeProperty(n.id,i))}for(let i of Object.keys(e))t.updateProperty(n.id,i,e[i])}})}},function(e,t,n){const i=n(1);function r(e){let t=-1;return async function(n){let r=0;if(0!==e.length){if(e.length>1){for(r=t;r===t;)r=Math.floor(Math.random()*e.length);t=r}await i.wait(n),e[r].play().catch(i.noop)}}}t.playPachi=r([...Array(5)].map((e,t)=>new Audio(`./data/${t}.mp3`))),t.playCapture=r([...Array(5)].map((e,t)=>new Audio(`./data/capture${t}.mp3`))),t.playPass=r([new Audio("./data/pass.mp3")]),t.playNewGame=r([new Audio("./data/newgame.mp3")])}]);